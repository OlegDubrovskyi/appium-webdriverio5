"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.detectUdid = detectUdid;
exports.getAndCheckXcodeVersion = getAndCheckXcodeVersion;
exports.getAndCheckIosSdkVersion = getAndCheckIosSdkVersion;
exports.checkAppPresent = checkAppPresent;
exports.getDriverInfo = getDriverInfo;
exports.clearSystemFiles = clearSystemFiles;
exports.translateDeviceName = translateDeviceName;
exports.normalizeCommandTimeouts = normalizeCommandTimeouts;
exports.resetXCTestProcesses = resetXCTestProcesses;
exports.getPIDsUsingPattern = getPIDsUsingPattern;
exports.markSystemFilesForCleanup = markSystemFilesForCleanup;
exports.printUser = printUser;
exports.printLibimobiledeviceInfo = printLibimobiledeviceInfo;
exports.getPIDsListeningOnPort = getPIDsListeningOnPort;
exports.encodeBase64OrUpload = encodeBase64OrUpload;
exports.removeAllSessionWebSocketHandlers = removeAllSessionWebSocketHandlers;
exports.verifyApplicationPlatform = verifyApplicationPlatform;
exports.isTvOS = isTvOS;
exports.isLocalHost = isLocalHost;
exports.normalizePlatformVersion = normalizePlatformVersion;
exports.DEFAULT_TIMEOUT_KEY = void 0;

require("source-map-support/register");

var _bluebird = _interopRequireDefault(require("bluebird"));

var _appiumIosDevice = require("appium-ios-device");

var _appiumSupport = require("appium-support");

var _path = _interopRequireDefault(require("path"));

var _appiumIosDriver = require("appium-ios-driver");

var _teen_process = require("teen_process");

var _appiumXcode = _interopRequireDefault(require("appium-xcode"));

var _lodash = _interopRequireDefault(require("lodash"));

var _logger = _interopRequireDefault(require("./logger"));

var _fs2 = _interopRequireDefault(require("fs"));

var _url = _interopRequireDefault(require("url"));

var _v = _interopRequireDefault(require("v8"));

var _desiredCaps = require("./desired-caps");

var _semver = _interopRequireDefault(require("semver"));

const DEFAULT_TIMEOUT_KEY = 'default';
exports.DEFAULT_TIMEOUT_KEY = DEFAULT_TIMEOUT_KEY;

async function detectUdid() {
  _logger.default.debug('Auto-detecting real device udid...');

  const udids = await _appiumIosDevice.utilities.getConnectedDevices();

  if (_lodash.default.isEmpty(udids)) {
    throw new Error('No device is connected to the host');
  }

  const udid = _lodash.default.last(udids);

  if (udids.length > 1) {
    _logger.default.warn(`Multiple devices found: ${udids.join(', ')}`);

    _logger.default.warn(`Choosing '${udid}'. If this is wrong, manually set with 'udid' desired capability`);
  }

  _logger.default.debug(`Detected real device udid: '${udid}'`);

  return udid;
}

async function getAndCheckXcodeVersion() {
  let version;

  try {
    version = await _appiumXcode.default.getVersion(true);
  } catch (err) {
    _logger.default.debug(err);

    _logger.default.errorAndThrow(`Could not determine Xcode version: ${err.message}`);
  }

  if (version.versionFloat < 7.3) {
    _logger.default.errorAndThrow(`Xcode version '${version.versionString}'. Support for ` + `Xcode ${version.versionString} is not supported. ` + `Please upgrade to version 7.3 or higher`);
  }

  return version;
}

async function getAndCheckIosSdkVersion() {
  try {
    return await _appiumXcode.default.getMaxIOSSDK();
  } catch (err) {
    _logger.default.errorAndThrow(`Could not determine iOS SDK version: ${err.message}`);
  }
}

function translateDeviceName(platformVersion, devName = '') {
  let deviceName = devName;

  switch (devName.toLowerCase().trim()) {
    case 'iphone simulator':
      deviceName = 'iPhone 6';
      break;

    case 'ipad simulator':
      deviceName = platformVersion && _appiumSupport.util.compareVersions(platformVersion, '<', '10.3') ? 'iPad Retina' : 'iPad Air';
      break;
  }

  if (deviceName !== devName) {
    _logger.default.debug(`Changing deviceName from '${devName}' to '${deviceName}'`);
  }

  return deviceName;
}

const derivedDataCleanupMarkers = new Map();

async function markSystemFilesForCleanup(wda) {
  if (!wda || !(await wda.retrieveDerivedDataPath())) {
    _logger.default.warn('No WebDriverAgent derived data available, so unable to mark system files for cleanup');

    return;
  }

  const logsRoot = _path.default.resolve((await wda.retrieveDerivedDataPath()), 'Logs');

  let markersCount = 0;

  if (derivedDataCleanupMarkers.has(logsRoot)) {
    markersCount = derivedDataCleanupMarkers.get(logsRoot);
  }

  derivedDataCleanupMarkers.set(logsRoot, ++markersCount);
}

async function clearSystemFiles(wda) {
  if (!wda || !(await wda.retrieveDerivedDataPath())) {
    _logger.default.warn('No WebDriverAgent derived data available, so unable to clear system files');

    return;
  }

  const logsRoot = _path.default.resolve((await wda.retrieveDerivedDataPath()), 'Logs');

  if (derivedDataCleanupMarkers.has(logsRoot)) {
    let markersCount = derivedDataCleanupMarkers.get(logsRoot);
    derivedDataCleanupMarkers.set(logsRoot, --markersCount);

    if (markersCount > 0) {
      _logger.default.info(`Not cleaning '${logsRoot}' folder, because the other session does not expect it to be cleaned`);

      return;
    }
  }

  derivedDataCleanupMarkers.set(logsRoot, 0);
  const cleanupCmd = `find -E /private/var/folders ` + `-regex '.*/Session-WebDriverAgentRunner.*\\.log$|.*/StandardOutputAndStandardError\\.txt$' ` + `-type f -exec sh -c 'echo "" > "{}"' \\;`;
  const cleanupTask = new _teen_process.SubProcess('bash', ['-c', cleanupCmd], {
    detached: true,
    stdio: ['ignore', 'pipe', 'pipe']
  });
  await cleanupTask.start(0, true);

  _logger.default.debug(`Started background XCTest logs cleanup: ${cleanupCmd}`);

  if (await _appiumSupport.fs.exists(logsRoot)) {
    _logger.default.info(`Cleaning test logs in '${logsRoot}' folder`);

    await _appiumIosDriver.utils.clearLogs([logsRoot]);
    return;
  }

  _logger.default.info(`There is no ${logsRoot} folder, so not cleaning files`);
}

async function checkAppPresent(app) {
  _logger.default.debug(`Checking whether app '${app}' is actually present on file system`);

  if (!(await _appiumSupport.fs.exists(app))) {
    _logger.default.errorAndThrow(`Could not find app at '${app}'`);
  }

  _logger.default.debug('App is present');
}

async function getDriverInfo() {
  const stat = await _appiumSupport.fs.stat(_path.default.resolve(__dirname, '..'));
  const built = stat.mtime.getTime();

  const pkg = require(__filename.includes('build/lib/utils') ? '../../package.json' : '../package.json');

  const version = pkg.version;
  return {
    built,
    version
  };
}

function normalizeCommandTimeouts(value) {
  if (typeof value !== 'string') {
    return value;
  }

  let result = {};

  if (!isNaN(value)) {
    result[DEFAULT_TIMEOUT_KEY] = _lodash.default.toInteger(value);
    return result;
  }

  try {
    result = JSON.parse(value);

    if (!_lodash.default.isPlainObject(result)) {
      throw new Error();
    }
  } catch (err) {
    _logger.default.errorAndThrow(`"commandTimeouts" capability should be a valid JSON object. "${value}" was given instead`);
  }

  for (let [cmd, timeout] of _lodash.default.toPairs(result)) {
    if (!_lodash.default.isInteger(timeout) || timeout <= 0) {
      _logger.default.errorAndThrow(`The timeout for "${cmd}" should be a valid natural number of milliseconds. "${timeout}" was given instead`);
    }
  }

  return result;
}

async function getPIDsUsingPattern(pattern, opts = {}) {
  const {
    multi = false,
    ignoreCase = true
  } = opts;
  const args = [`-${ignoreCase ? 'i' : ''}f${multi ? '' : 'n'}`, pattern];

  try {
    const {
      stdout
    } = await (0, _teen_process.exec)('pgrep', args);

    if (multi) {
      const result = stdout.split('\n').filter(x => parseInt(x, 10)).map(x => `${parseInt(x, 10)}`);
      return _lodash.default.isEmpty(result) ? null : result;
    }

    const pid = parseInt(stdout, 10);
    return isNaN(pid) ? null : `${pid}`;
  } catch (err) {
    _logger.default.debug(`'pgrep ${args.join(' ')}' didn't detect any matching processes. Return code: ${err.code}`);

    return null;
  }
}

async function killAppUsingPattern(pgrepPattern) {
  for (const signal of [2, 15, 9]) {
    if (!(await getPIDsUsingPattern(pgrepPattern))) {
      return;
    }

    const args = [`-${signal}`, '-if', pgrepPattern];

    try {
      await (0, _teen_process.exec)('pkill', args);
    } catch (err) {
      _logger.default.debug(`pkill ${args.join(' ')} -> ${err.message}`);
    }

    await _bluebird.default.delay(100);
  }
}

async function resetXCTestProcesses(udid, isSimulator) {
  const processPatterns = [`xcodebuild.*${udid}`];

  if (isSimulator) {
    processPatterns.push(`${udid}.*XCTRunner`);
  }

  _logger.default.debug(`Killing running processes '${processPatterns.join(', ')}' for the device ${udid}...`);

  for (const pgrepPattern of processPatterns) {
    await killAppUsingPattern(pgrepPattern);
  }
}

async function printUser() {
  try {
    let {
      stdout
    } = await (0, _teen_process.exec)('whoami');

    _logger.default.debug(`Current user: '${stdout.trim()}'`);
  } catch (err) {
    _logger.default.debug(`Unable to get username running server: ${err.message}`);
  }
}

async function printLibimobiledeviceInfo() {
  try {
    let {
      stdout
    } = await (0, _teen_process.exec)('brew', ['info', 'libimobiledevice']);
    let match = /libimobiledevice:(.+)/.exec(stdout);

    if (match && match[1]) {
      _logger.default.debug(`Current version of libimobiledevice: ${match[1].trim()}`);
    }
  } catch (err) {
    _logger.default.debug(`Unable to get version of libimobiledevice: ${err.message}`);
  }
}

async function getPIDsListeningOnPort(port, filteringFunc = null) {
  const result = [];

  try {
    const {
      stdout
    } = await (0, _teen_process.exec)('lsof', ['-ti', `tcp:${port}`]);
    result.push(...stdout.trim().split(/\n+/));
  } catch (e) {
    return result;
  }

  if (!_lodash.default.isFunction(filteringFunc)) {
    return result;
  }

  return await _bluebird.default.filter(result, async x => {
    const {
      stdout
    } = await (0, _teen_process.exec)('ps', ['-p', x, '-o', 'command']);
    return await filteringFunc(stdout);
  });
}

async function encodeBase64OrUpload(localFile, remotePath = null, uploadOptions = {}) {
  if (!(await _appiumSupport.fs.exists(localFile))) {
    _logger.default.errorAndThrow(`The file at '${localFile}' does not exist or is not accessible`);
  }

  const {
    size
  } = await _appiumSupport.fs.stat(localFile);

  _logger.default.debug(`The size of the file is ${_appiumSupport.util.toReadableSizeString(size)}`);

  if (_lodash.default.isEmpty(remotePath)) {
    const maxMemoryLimit = _v.default.getHeapStatistics().total_available_size / 2;

    if (size >= maxMemoryLimit) {
      _logger.default.info(`The file might be too large to fit into the process memory ` + `(${_appiumSupport.util.toReadableSizeString(size)} >= ${_appiumSupport.util.toReadableSizeString(maxMemoryLimit)}). ` + `Provide a link to a remote writable location for video upload ` + `(http(s) and ftp protocols are supported) if you experience Out Of Memory errors`);
    }

    const content = await _appiumSupport.fs.readFile(localFile);
    return content.toString('base64');
  }

  const remoteUrl = _url.default.parse(remotePath);

  let options = {};
  const {
    user,
    pass,
    method
  } = uploadOptions;

  if (remoteUrl.protocol.startsWith('http')) {
    options = {
      url: remoteUrl.href,
      method: method || 'PUT',
      multipart: [{
        body: _fs2.default.createReadStream(localFile)
      }]
    };

    if (user && pass) {
      options.auth = {
        user,
        pass
      };
    }
  } else if (remoteUrl.protocol === 'ftp:') {
    options = {
      host: remoteUrl.hostname,
      port: remoteUrl.port || 21
    };

    if (user && pass) {
      options.user = user;
      options.pass = pass;
    }
  }

  await _appiumSupport.net.uploadFile(localFile, remotePath, options);
  return '';
}

async function removeAllSessionWebSocketHandlers(server, sessionId) {
  if (!server || !_lodash.default.isFunction(server.getWebSocketHandlers)) {
    return;
  }

  const activeHandlers = await server.getWebSocketHandlers(sessionId);

  for (const pathname of _lodash.default.keys(activeHandlers)) {
    await server.removeWebSocketHandler(pathname);
  }
}

async function verifyApplicationPlatform(app, isSimulator, isTvOS) {
  _logger.default.debug('Verifying application platform');

  const infoPlist = _path.default.resolve(app, 'Info.plist');

  if (!(await _appiumSupport.fs.exists(infoPlist))) {
    _logger.default.debug(`'${infoPlist}' does not exist`);

    return null;
  }

  const {
    CFBundleSupportedPlatforms
  } = await _appiumSupport.plist.parsePlistFile(infoPlist);

  _logger.default.debug(`CFBundleSupportedPlatforms: ${JSON.stringify(CFBundleSupportedPlatforms)}`);

  if (!_lodash.default.isArray(CFBundleSupportedPlatforms)) {
    _logger.default.debug(`CFBundleSupportedPlatforms key does not exist in '${infoPlist}'`);

    return null;
  }

  const expectedPlatform = isSimulator ? isTvOS ? 'AppleTVSimulator' : 'iPhoneSimulator' : isTvOS ? 'AppleTVOS' : 'iPhoneOS';
  const isAppSupported = CFBundleSupportedPlatforms.includes(expectedPlatform);

  if (isAppSupported) {
    return true;
  }

  throw new Error(`${isSimulator ? 'Simulator' : 'Real device'} architecture is unsupported by the '${app}' application. ` + `Make sure the correct deployment target has been selected for its compilation in Xcode.`);
}

function isTvOS(platformName) {
  return _lodash.default.toLower(platformName) === _lodash.default.toLower(_desiredCaps.PLATFORM_NAME_TVOS);
}

function isLocalHost(urlString) {
  try {
    const {
      hostname
    } = _url.default.parse(urlString);

    return ['localhost', '127.0.0.1', '::1', '::ffff:127.0.0.1'].includes(hostname);
  } catch (ign) {
    _logger.default.warn(`'${urlString}' cannot be parsed as a valid URL`);
  }

  return false;
}

function normalizePlatformVersion(originalVersion) {
  const normalizedVersion = _appiumSupport.util.coerceVersion(originalVersion, false);

  if (!normalizedVersion) {
    throw new Error(`The platform version '${originalVersion}' should be a valid version number`);
  }

  const {
    major,
    minor
  } = new _semver.default.SemVer(normalizedVersion);
  return `${major}.${minor}`;
}require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi91dGlscy5qcyJdLCJuYW1lcyI6WyJERUZBVUxUX1RJTUVPVVRfS0VZIiwiZGV0ZWN0VWRpZCIsImxvZyIsImRlYnVnIiwidWRpZHMiLCJ1dGlsaXRpZXMiLCJnZXRDb25uZWN0ZWREZXZpY2VzIiwiXyIsImlzRW1wdHkiLCJFcnJvciIsInVkaWQiLCJsYXN0IiwibGVuZ3RoIiwid2FybiIsImpvaW4iLCJnZXRBbmRDaGVja1hjb2RlVmVyc2lvbiIsInZlcnNpb24iLCJ4Y29kZSIsImdldFZlcnNpb24iLCJlcnIiLCJlcnJvckFuZFRocm93IiwibWVzc2FnZSIsInZlcnNpb25GbG9hdCIsInZlcnNpb25TdHJpbmciLCJnZXRBbmRDaGVja0lvc1Nka1ZlcnNpb24iLCJnZXRNYXhJT1NTREsiLCJ0cmFuc2xhdGVEZXZpY2VOYW1lIiwicGxhdGZvcm1WZXJzaW9uIiwiZGV2TmFtZSIsImRldmljZU5hbWUiLCJ0b0xvd2VyQ2FzZSIsInRyaW0iLCJ1dGlsIiwiY29tcGFyZVZlcnNpb25zIiwiZGVyaXZlZERhdGFDbGVhbnVwTWFya2VycyIsIk1hcCIsIm1hcmtTeXN0ZW1GaWxlc0ZvckNsZWFudXAiLCJ3ZGEiLCJyZXRyaWV2ZURlcml2ZWREYXRhUGF0aCIsImxvZ3NSb290IiwicGF0aCIsInJlc29sdmUiLCJtYXJrZXJzQ291bnQiLCJoYXMiLCJnZXQiLCJzZXQiLCJjbGVhclN5c3RlbUZpbGVzIiwiaW5mbyIsImNsZWFudXBDbWQiLCJjbGVhbnVwVGFzayIsIlN1YlByb2Nlc3MiLCJkZXRhY2hlZCIsInN0ZGlvIiwic3RhcnQiLCJmcyIsImV4aXN0cyIsImlvc1V0aWxzIiwiY2xlYXJMb2dzIiwiY2hlY2tBcHBQcmVzZW50IiwiYXBwIiwiZ2V0RHJpdmVySW5mbyIsInN0YXQiLCJfX2Rpcm5hbWUiLCJidWlsdCIsIm10aW1lIiwiZ2V0VGltZSIsInBrZyIsInJlcXVpcmUiLCJfX2ZpbGVuYW1lIiwiaW5jbHVkZXMiLCJub3JtYWxpemVDb21tYW5kVGltZW91dHMiLCJ2YWx1ZSIsInJlc3VsdCIsImlzTmFOIiwidG9JbnRlZ2VyIiwiSlNPTiIsInBhcnNlIiwiaXNQbGFpbk9iamVjdCIsImNtZCIsInRpbWVvdXQiLCJ0b1BhaXJzIiwiaXNJbnRlZ2VyIiwiZ2V0UElEc1VzaW5nUGF0dGVybiIsInBhdHRlcm4iLCJvcHRzIiwibXVsdGkiLCJpZ25vcmVDYXNlIiwiYXJncyIsInN0ZG91dCIsInNwbGl0IiwiZmlsdGVyIiwieCIsInBhcnNlSW50IiwibWFwIiwicGlkIiwiY29kZSIsImtpbGxBcHBVc2luZ1BhdHRlcm4iLCJwZ3JlcFBhdHRlcm4iLCJzaWduYWwiLCJCIiwiZGVsYXkiLCJyZXNldFhDVGVzdFByb2Nlc3NlcyIsImlzU2ltdWxhdG9yIiwicHJvY2Vzc1BhdHRlcm5zIiwicHVzaCIsInByaW50VXNlciIsInByaW50TGliaW1vYmlsZWRldmljZUluZm8iLCJtYXRjaCIsImV4ZWMiLCJnZXRQSURzTGlzdGVuaW5nT25Qb3J0IiwicG9ydCIsImZpbHRlcmluZ0Z1bmMiLCJlIiwiaXNGdW5jdGlvbiIsImVuY29kZUJhc2U2NE9yVXBsb2FkIiwibG9jYWxGaWxlIiwicmVtb3RlUGF0aCIsInVwbG9hZE9wdGlvbnMiLCJzaXplIiwidG9SZWFkYWJsZVNpemVTdHJpbmciLCJtYXhNZW1vcnlMaW1pdCIsInY4IiwiZ2V0SGVhcFN0YXRpc3RpY3MiLCJ0b3RhbF9hdmFpbGFibGVfc2l6ZSIsImNvbnRlbnQiLCJyZWFkRmlsZSIsInRvU3RyaW5nIiwicmVtb3RlVXJsIiwidXJsIiwib3B0aW9ucyIsInVzZXIiLCJwYXNzIiwibWV0aG9kIiwicHJvdG9jb2wiLCJzdGFydHNXaXRoIiwiaHJlZiIsIm11bHRpcGFydCIsImJvZHkiLCJfZnMiLCJjcmVhdGVSZWFkU3RyZWFtIiwiYXV0aCIsImhvc3QiLCJob3N0bmFtZSIsIm5ldCIsInVwbG9hZEZpbGUiLCJyZW1vdmVBbGxTZXNzaW9uV2ViU29ja2V0SGFuZGxlcnMiLCJzZXJ2ZXIiLCJzZXNzaW9uSWQiLCJnZXRXZWJTb2NrZXRIYW5kbGVycyIsImFjdGl2ZUhhbmRsZXJzIiwicGF0aG5hbWUiLCJrZXlzIiwicmVtb3ZlV2ViU29ja2V0SGFuZGxlciIsInZlcmlmeUFwcGxpY2F0aW9uUGxhdGZvcm0iLCJpc1R2T1MiLCJpbmZvUGxpc3QiLCJDRkJ1bmRsZVN1cHBvcnRlZFBsYXRmb3JtcyIsInBsaXN0IiwicGFyc2VQbGlzdEZpbGUiLCJzdHJpbmdpZnkiLCJpc0FycmF5IiwiZXhwZWN0ZWRQbGF0Zm9ybSIsImlzQXBwU3VwcG9ydGVkIiwicGxhdGZvcm1OYW1lIiwidG9Mb3dlciIsIlBMQVRGT1JNX05BTUVfVFZPUyIsImlzTG9jYWxIb3N0IiwidXJsU3RyaW5nIiwiaWduIiwibm9ybWFsaXplUGxhdGZvcm1WZXJzaW9uIiwib3JpZ2luYWxWZXJzaW9uIiwibm9ybWFsaXplZFZlcnNpb24iLCJjb2VyY2VWZXJzaW9uIiwibWFqb3IiLCJtaW5vciIsInNlbXZlciIsIlNlbVZlciJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBLE1BQU1BLG1CQUFtQixHQUFHLFNBQTVCOzs7QUFHQSxlQUFlQyxVQUFmLEdBQTZCO0FBQzNCQyxrQkFBSUMsS0FBSixDQUFVLG9DQUFWOztBQUNBLFFBQU1DLEtBQUssR0FBRyxNQUFNQywyQkFBVUMsbUJBQVYsRUFBcEI7O0FBQ0EsTUFBSUMsZ0JBQUVDLE9BQUYsQ0FBVUosS0FBVixDQUFKLEVBQXNCO0FBQ3BCLFVBQU0sSUFBSUssS0FBSixDQUFVLG9DQUFWLENBQU47QUFDRDs7QUFDRCxRQUFNQyxJQUFJLEdBQUdILGdCQUFFSSxJQUFGLENBQU9QLEtBQVAsQ0FBYjs7QUFDQSxNQUFJQSxLQUFLLENBQUNRLE1BQU4sR0FBZSxDQUFuQixFQUFzQjtBQUNwQlYsb0JBQUlXLElBQUosQ0FB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aW1wb3J0IHsgdXRpbGl0aWVzIH0gZnJvbSAnYXBwaXVtLWlvcy1kZXZpY2UnO1xuaW1wb3J0IHsgZnMsIHV0aWwsIG5ldCwgcGxpc3QgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7IHV0aWxzIGFzIGlvc1V0aWxzIH0gZnJvbSAnYXBwaXVtLWlvcy1kcml2ZXInO1xuaW1wb3J0IHsgU3ViUHJvY2VzcywgZXhlYyB9IGZyb20gJ3RlZW5fcHJvY2Vzcyc7XG5pbXBvcnQgeGNvZGUgZnJvbSAnYXBwaXVtLXhjb2RlJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgbG9nIGZyb20gJy4vbG9nZ2VyJztcbmltcG9ydCBfZnMgZnJvbSAnZnMnO1xuaW1wb3J0IHVybCBmcm9tICd1cmwnO1xuaW1wb3J0IHY4IGZyb20gJ3Y4JztcbmltcG9ydCB7IFBMQVRGT1JNX05BTUVfVFZPUyB9IGZyb20gJy4vZGVzaXJlZC1jYXBzJztcbmltcG9ydCBzZW12ZXIgZnJvbSAnc2VtdmVyJztcblxuY29uc3QgREVGQVVMVF9USU1FT1VUX0tFWSA9ICdkZWZhdWx0JztcblxuXG5hc3luYyBmdW5jdGlvbiBkZXRlY3RVZGlkICgpIHtcbiAgbG9nLmRlYnVnKCdBdXRvLWRldGVjdGluZyByZWFsIGRldmljZSB1ZGlkLi4uJyk7XG4gIGNvbnN0IHVkaWRzID0gYXdhaXQgdXRpbGl0aWVzLmdldENvbm5lY3RlZERldmljZXMoKTtcbiAgaWYgKF8uaXNFbXB0eSh1ZGlkcykpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIGRldmljZSBpcyBjb25uZWN0ZWQgdG8gdGhlIGhvc3QnKTtcbiAgfVxuICBjb25zdCB1ZGlkID0gXy5sYXN0KHVkaWRzKTtcbiAgaWYgKHVkaWRzLmxlbmd0aCA+IDEpIHtcbiAgICBsb2cud2FybihgTXVsdGlwbGUgZGV2aWNlcyBmb3VuZDogJHt1ZGlkcy5qb2luKCcsICcpfWApO1xuICAgIGxvZy53YXJuKGBDaG9vc2luZyAnJHt1ZGlkfScuIElmIHRoaXMgaXMgd3JvbmcsIG1hbnVhbGx5IHNldCB3aXRoICd1ZGlkJyBkZXNpcmVkIGNhcGFiaWxpdHlgKTtcbiAgfVxuICBsb2cuZGVidWcoYERldGVjdGVkIHJlYWwgZGV2aWNlIHVkaWQ6ICcke3VkaWR9J2ApO1xuICByZXR1cm4gdWRpZDtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0QW5kQ2hlY2tYY29kZVZlcnNpb24gKCkge1xuICBsZXQgdmVyc2lvbjtcbiAgdHJ5IHtcbiAgICB2ZXJzaW9uID0gYXdhaXQgeGNvZGUuZ2V0VmVyc2lvbih0cnVlKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbG9nLmRlYnVnKGVycik7XG4gICAgbG9nLmVycm9yQW5kVGhyb3coYENvdWxkIG5vdCBkZXRlcm1pbmUgWGNvZGUgdmVyc2lvbjogJHtlcnIubWVzc2FnZX1gKTtcbiAgfVxuXG4gIC8vIHdlIGRvIG5vdCBzdXBwb3J0IFhjb2RlcyA8IDcuMyxcbiAgaWYgKHZlcnNpb24udmVyc2lvbkZsb2F0IDwgNy4zKSB7XG4gICAgbG9nLmVycm9yQW5kVGhyb3coYFhjb2RlIHZlcnNpb24gJyR7dmVyc2lvbi52ZXJzaW9uU3RyaW5nfScuIFN1cHBvcnQgZm9yIGAgK1xuICAgICAgICAgICAgICAgICAgICAgIGBYY29kZSAke3ZlcnNpb24udmVyc2lvblN0cmluZ30gaXMgbm90IHN1cHBvcnRlZC4gYCArXG4gICAgICAgICAgICAgICAgICAgICAgYFBsZWFzZSB1cGdyYWRlIHRvIHZlcnNpb24gNy4zIG9yIGhpZ2hlcmApO1xuICB9XG4gIHJldHVybiB2ZXJzaW9uO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBbmRDaGVja0lvc1Nka1ZlcnNpb24gKCkge1xuICB0cnkge1xuICAgIHJldHVybiBhd2FpdCB4Y29kZS5nZXRNYXhJT1NTREsoKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbG9nLmVycm9yQW5kVGhyb3coYENvdWxkIG5vdCBkZXRlcm1pbmUgaU9TIFNESyB2ZXJzaW9uOiAke2Vyci5tZXNzYWdlfWApO1xuICB9XG59XG5cbmZ1bmN0aW9uIHRyYW5zbGF0ZURldmljZU5hbWUgKHBsYXRmb3JtVmVyc2lvbiwgZGV2TmFtZSA9ICcnKSB7XG4gIGxldCBkZXZpY2VOYW1lID0gZGV2TmFtZTtcbiAgc3dpdGNoIChkZXZOYW1lLnRvTG93ZXJDYXNlKCkudHJpbSgpKSB7XG4gICAgY2FzZSAnaXBob25lIHNpbXVsYXRvcic6XG4gICAgICBkZXZpY2VOYW1lID0gJ2lQaG9uZSA2JztcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ2lwYWQgc2ltdWxhdG9yJzpcbiAgICAgIC8vIGlQYWQgUmV0aW5hIGlzIG5vIGxvbmdlciBhdmFpbGFibGUgZm9yIGlvcyAxMC4zXG4gICAgICAvLyAgIHNvIHdlIHBpY2sgYW5vdGhlciBpUGFkIHRvIHVzZSBhcyBkZWZhdWx0XG4gICAgICBkZXZpY2VOYW1lID0gcGxhdGZvcm1WZXJzaW9uICYmIHV0aWwuY29tcGFyZVZlcnNpb25zKHBsYXRmb3JtVmVyc2lvbiwgJzwnLCAnMTAuMycpID8gJ2lQYWQgUmV0aW5hJyA6ICdpUGFkIEFpcic7XG4gICAgICBicmVhaztcbiAgfVxuXG4gIGlmIChkZXZpY2VOYW1lICE9PSBkZXZOYW1lKSB7XG4gICAgbG9nLmRlYnVnKGBDaGFuZ2luZyBkZXZpY2VOYW1lIGZyb20gJyR7ZGV2TmFtZX0nIHRvICcke2RldmljZU5hbWV9J2ApO1xuICB9XG4gIHJldHVybiBkZXZpY2VOYW1lO1xufVxuXG4vLyBUaGlzIG1hcCBjb250YWlucyBkZXJpdmVkIGRhdGEgbG9ncyBmb2xkZXJzIGFzIGtleXNcbi8vIGFuZCB2YWx1ZXMgYXJlIHRoZSBjb3VudCBvZiB0aW1lcyB0aGUgcGFydGljdWxhclxuLy8gZm9sZGVyIGhhcyBiZWVuIHNjaGVkdWxlZCBmb3IgcmVtb3ZhbFxuY29uc3QgZGVyaXZlZERhdGFDbGVhbnVwTWFya2VycyA9IG5ldyBNYXAoKTtcblxuYXN5bmMgZnVuY3Rpb24gbWFya1N5c3RlbUZpbGVzRm9yQ2xlYW51cCAod2RhKSB7XG4gIGlmICghd2RhIHx8ICFhd2FpdCB3ZGEucmV0cmlldmVEZXJpdmVkRGF0YVBhdGgoKSkge1xuICAgIGxvZy53YXJuKCdObyBXZWJEcml2ZXJBZ2VudCBkZXJpdmVkIGRhdGEgYXZhaWxhYmxlLCBzbyB1bmFibGUgdG8gbWFyayBzeXN0ZW0gZmlsZXMgZm9yIGNsZWFudXAnKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBsb2dzUm9vdCA9IHBhdGgucmVzb2x2ZShhd2FpdCB3ZGEucmV0cmlldmVEZXJpdmVkRGF0YVBhdGgoKSwgJ0xvZ3MnKTtcbiAgbGV0IG1hcmtlcnNDb3VudCA9IDA7XG4gIGlmIChkZXJpdmVkRGF0YUNsZWFudXBNYXJrZXJzLmhhcyhsb2dzUm9vdCkpIHtcbiAgICBtYXJrZXJzQ291bnQgPSBkZXJpdmVkRGF0YUNsZWFudXBNYXJrZXJzLmdldChsb2dzUm9vdCk7XG4gIH1cbiAgZGVyaXZlZERhdGFDbGVhbnVwTWFya2Vycy5zZXQobG9nc1Jvb3QsICsrbWFya2Vyc0NvdW50KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gY2xlYXJTeXN0ZW1GaWxlcyAod2RhKSB7XG4gIC8vIG9ubHkgd2FudCB0byBjbGVhciB0aGUgc3lzdGVtIGZpbGVzIGZvciB0aGUgcGFydGljdWxhciBXREEgeGNvZGUgcnVuXG4gIGlmICghd2RhIHx8ICFhd2FpdCB3ZGEucmV0cmlldmVEZXJpdmVkRGF0YVBhdGgoKSkge1xuICAgIGxvZy53YXJuKCdObyBXZWJEcml2ZXJBZ2VudCBkZXJpdmVkIGRhdGEgYXZhaWxhYmxlLCBzbyB1bmFibGUgdG8gY2xlYXIgc3lzdGVtIGZpbGVzJyk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgbG9nc1Jvb3QgPSBwYXRoLnJlc29sdmUoYXdhaXQgd2RhLnJldHJpZXZlRGVyaXZlZERhdGFQYXRoKCksICdMb2dzJyk7XG4gIGlmIChkZXJpdmVkRGF0YUNsZWFudXBNYXJrZXJzLmhhcyhsb2dzUm9vdCkpIHtcbiAgICBsZXQgbWFya2Vyc0NvdW50ID0gZGVyaXZlZERhdGFDbGVhbnVwTWFya2Vycy5nZXQobG9nc1Jvb3QpO1xuICAgIGRlcml2ZWREYXRhQ2xlYW51cE1hcmtlcnMuc2V0KGxvZ3NSb290LCAtLW1hcmtlcnNDb3VudCk7XG4gICAgaWYgKG1hcmtlcnNDb3VudCA+IDApIHtcbiAgICAgIGxvZy5pbmZvKGBOb3QgY2xlYW5pbmcgJyR7bG9nc1Jvb3R9JyBmb2xkZXIsIGJlY2F1c2UgdGhlIG90aGVyIHNlc3Npb24gZG9lcyBub3QgZXhwZWN0IGl0IHRvIGJlIGNsZWFuZWRgKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gIH1cbiAgZGVyaXZlZERhdGFDbGVhbnVwTWFya2Vycy5zZXQobG9nc1Jvb3QsIDApO1xuXG4gIC8vIENsZWFuaW5nIHVwIGJpZyB0ZW1wb3JhcnkgZmlsZXMgY3JlYXRlZCBieSBYQ1Rlc3Q6IGh0dHBzOi8vZ2l0aHViLmNvbS9hcHBpdW0vYXBwaXVtL2lzc3Vlcy85NDEwXG4gIGNvbnN0IGNsZWFudXBDbWQgPSBgZmluZCAtRSAvcHJpdmF0ZS92YXIvZm9sZGVycyBgICtcbiAgICBgLXJlZ2V4ICcuKi9TZXNzaW9uLVdlYkRyaXZlckFnZW50UnVubmVyLipcXFxcLmxvZyR8LiovU3RhbmRhcmRPdXRwdXRBbmRTdGFuZGFyZEVycm9yXFxcXC50eHQkJyBgICtcbiAgICBgLXR5cGUgZiAtZXhlYyBzaCAtYyAnZWNobyBcIlwiID4gXCJ7fVwiJyBcXFxcO2A7XG4gIGNvbnN0IGNsZWFudXBUYXNrID0gbmV3IFN1YlByb2Nlc3MoJ2Jhc2gnLCBbJy1jJywgY2xlYW51cENtZF0sIHtcbiAgICBkZXRhY2hlZDogdHJ1ZSxcbiAgICBzdGRpbzogWydpZ25vcmUnLCAncGlwZScsICdwaXBlJ10sXG4gIH0pO1xuICAvLyBEbyBub3Qgd2FpdCBmb3IgdGhlIHRhc2sgdG8gYmUgY29tcGxldGVkLCBzaW5jZSBpdCBtaWdodCB0YWtlIGEgbG90IG9mIHRpbWVcbiAgLy8gV2Uga2VlcCBpdCBydW5uaW5nIGFmdGVyIEFwcGl1bSBwcm9jZXNzIGlzIGtpbGxlZFxuICBhd2FpdCBjbGVhbnVwVGFzay5zdGFydCgwLCB0cnVlKTtcbiAgbG9nLmRlYnVnKGBTdGFydGVkIGJhY2tncm91bmQgWENUZXN0IGxvZ3MgY2xlYW51cDogJHtjbGVhbnVwQ21kfWApO1xuXG4gIGlmIChhd2FpdCBmcy5leGlzdHMobG9nc1Jvb3QpKSB7XG4gICAgbG9nLmluZm8oYENsZWFuaW5nIHRlc3QgbG9ncyBpbiAnJHtsb2dzUm9vdH0nIGZvbGRlcmApO1xuICAgIGF3YWl0IGlvc1V0aWxzLmNsZWFyTG9ncyhbbG9nc1Jvb3RdKTtcbiAgICByZXR1cm47XG4gIH1cbiAgbG9nLmluZm8oYFRoZXJlIGlzIG5vICR7bG9nc1Jvb3R9IGZvbGRlciwgc28gbm90IGNsZWFuaW5nIGZpbGVzYCk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGNoZWNrQXBwUHJlc2VudCAoYXBwKSB7XG4gIGxvZy5kZWJ1ZyhgQ2hlY2tpbmcgd2hldGhlciBhcHAgJyR7YXBwfScgaXMgYWN0dWFsbHkgcHJlc2VudCBvbiBmaWxlIHN5c3RlbWApO1xuICBpZiAoIShhd2FpdCBmcy5leGlzdHMoYXBwKSkpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhgQ291bGQgbm90IGZpbmQgYXBwIGF0ICcke2FwcH0nYCk7XG4gIH1cbiAgbG9nLmRlYnVnKCdBcHAgaXMgcHJlc2VudCcpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXREcml2ZXJJbmZvICgpIHtcbiAgY29uc3Qgc3RhdCA9IGF3YWl0IGZzLnN0YXQocGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgJy4uJykpO1xuICBjb25zdCBidWlsdCA9IHN0YXQubXRpbWUuZ2V0VGltZSgpO1xuXG4gIC8vIGdldCB0aGUgcGFja2FnZS5qc29uIGFuZCB0aGUgdmVyc2lvbiBmcm9tIGl0XG4gIGNvbnN0IHBrZyA9IHJlcXVpcmUoX19maWxlbmFtZS5pbmNsdWRlcygnYnVpbGQvbGliL3V0aWxzJykgPyAnLi4vLi4vcGFja2FnZS5qc29uJyA6ICcuLi9wYWNrYWdlLmpzb24nKTtcbiAgY29uc3QgdmVyc2lvbiA9IHBrZy52ZXJzaW9uO1xuXG4gIHJldHVybiB7XG4gICAgYnVpbHQsXG4gICAgdmVyc2lvbixcbiAgfTtcbn1cblxuZnVuY3Rpb24gbm9ybWFsaXplQ29tbWFuZFRpbWVvdXRzICh2YWx1ZSkge1xuICAvLyBUaGUgdmFsdWUgaXMgbm9ybWFsaXplZCBhbHJlYWR5XG4gIGlmICh0eXBlb2YgdmFsdWUgIT09ICdzdHJpbmcnKSB7XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG5cbiAgbGV0IHJlc3VsdCA9IHt9O1xuICAvLyBVc2UgYXMgZGVmYXVsdCB0aW1lb3V0IGZvciBhbGwgY29tbWFuZHMgaWYgYSBzaW5nbGUgaW50ZWdlciB2YWx1ZSBpcyBwcm92aWRlZFxuICBpZiAoIWlzTmFOKHZhbHVlKSkge1xuICAgIHJlc3VsdFtERUZBVUxUX1RJTUVPVVRfS0VZXSA9IF8udG9JbnRlZ2VyKHZhbHVlKTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLy8gSlNPTiBvYmplY3QgaGFzIGJlZW4gcHJvdmlkZWQuIExldCdzIHBhcnNlIGl0XG4gIHRyeSB7XG4gICAgcmVzdWx0ID0gSlNPTi5wYXJzZSh2YWx1ZSk7XG4gICAgaWYgKCFfLmlzUGxhaW5PYmplY3QocmVzdWx0KSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCk7XG4gICAgfVxuICB9IGNhdGNoIChlcnIpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhgXCJjb21tYW5kVGltZW91dHNcIiBjYXBhYmlsaXR5IHNob3VsZCBiZSBhIHZhbGlkIEpTT04gb2JqZWN0LiBcIiR7dmFsdWV9XCIgd2FzIGdpdmVuIGluc3RlYWRgKTtcbiAgfVxuICBmb3IgKGxldCBbY21kLCB0aW1lb3V0XSBvZiBfLnRvUGFpcnMocmVzdWx0KSkge1xuICAgIGlmICghXy5pc0ludGVnZXIodGltZW91dCkgfHwgdGltZW91dCA8PSAwKSB7XG4gICAgICBsb2cuZXJyb3JBbmRUaHJvdyhgVGhlIHRpbWVvdXQgZm9yIFwiJHtjbWR9XCIgc2hvdWxkIGJlIGEgdmFsaWQgbmF0dXJhbCBudW1iZXIgb2YgbWlsbGlzZWNvbmRzLiBcIiR7dGltZW91dH1cIiB3YXMgZ2l2ZW4gaW5zdGVhZGApO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufVxuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IFBpZExvb2t1cE9wdGlvbnNcbiAqXG4gKiBAcHJvcGVydHkgez9ib29sZWFufSBtdWx0aSBbZmFsc2VdIC0gU2V0IGl0IHRvIHRydWUgaWYgbXVsdGlwbGUgbWF0Y2hpbmdcbiAqIHBpZHMgYXJlIGV4cGVjdGVkIHRvIGJlIGZvdW5kLiBPbmx5IHRoZSBuZXdlc3QgcHJvY2VzcyBpZCBpcyBnb2luZyB0b1xuICogYmUgcmV0dXJuZWQgaW5zdGVhZFxuICogQHByb3BlcnR5IHs/Ym9vbGVhbn0gaWdub3JlQ2FzZSBbdHJ1ZV0gLSBTZXQgaXQgdG8gZmFsc2UgdG8gbWFrZSB0aGUgc2VhcmNoXG4gKiBjYXNlLXNlbnNpdGl2ZVxuICovXG5cbi8qKlxuICogR2V0IHRoZSBwcm9jZXNzIGlkIG9mIHRoZSBtb3N0IHJlY2VudCBydW5uaW5nIGFwcGxpY2F0aW9uXG4gKiBoYXZpbmcgdGhlIHBhcnRpY3VsYXIgY29tbWFuZCBsaW5lIHBhdHRlcm4uXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHBhdHRlcm4gLSBwZ3JlcC1jb21wYXRpYmxlIHNlYXJjaCBwYXR0ZXJuLlxuICogQHBhcmFtIHs/UGlkTG9va3VwT3B0aW9uc30gb3B0c1xuICogQHJldHVybiB7P3N0cmluZ3xBcnJheTxzdHJpbmc+fSBFaXRoZXIgYSBwcm9jZXNzIGlkIG9yIG51bGwgaWYgbm8gbWF0Y2hlcyB3ZXJlIGZvdW5kLlxuICogQW4gYXJyYXkgb2Ygc3RyaW5ncyBpcyBnb2luZyB0byBiZSByZXR1cm5lZCBpZiBgb3B0cy5tdWx0aWAgaXMgc2V0IHRvIHRydWVcbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0UElEc1VzaW5nUGF0dGVybiAocGF0dGVybiwgb3B0cyA9IHt9KSB7XG4gIGNvbnN0IHtcbiAgICBtdWx0aSA9IGZhbHNlLFxuICAgIGlnbm9yZUNhc2UgPSB0cnVlLFxuICB9ID0gb3B0cztcbiAgY29uc3QgYXJncyA9IFtgLSR7aWdub3JlQ2FzZSA/ICdpJyA6ICcnfWYke211bHRpID8gJycgOiAnbid9YCwgcGF0dGVybl07XG4gIHRyeSB7XG4gICAgY29uc3Qge3N0ZG91dH0gPSBhd2FpdCBleGVjKCdwZ3JlcCcsIGFyZ3MpO1xuICAgIGlmIChtdWx0aSkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gc3Rkb3V0LnNwbGl0KCdcXG4nKVxuICAgICAgICAuZmlsdGVyKCh4KSA9PiBwYXJzZUludCh4LCAxMCkpXG4gICAgICAgIC5tYXAoKHgpID0+IGAke3BhcnNlSW50KHgsIDEwKX1gKTtcbiAgICAgIHJldHVybiBfLmlzRW1wdHkocmVzdWx0KSA/IG51bGwgOiByZXN1bHQ7XG4gICAgfVxuICAgIGNvbnN0IHBpZCA9IHBhcnNlSW50KHN0ZG91dCwgMTApO1xuICAgIHJldHVybiBpc05hTihwaWQpID8gbnVsbCA6IGAke3BpZH1gO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBsb2cuZGVidWcoYCdwZ3JlcCAke2FyZ3Muam9pbignICcpfScgZGlkbid0IGRldGVjdCBhbnkgbWF0Y2hpbmcgcHJvY2Vzc2VzLiBSZXR1cm4gY29kZTogJHtlcnIuY29kZX1gKTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuXG4vKipcbiAqIEtpbGwgYSBwcm9jZXNzIGhhdmluZyB0aGUgcGFydGljdWxhciBjb21tYW5kIGxpbmUgcGF0dGVybi5cbiAqIFRoaXMgbWV0aG9kIHRyaWVzIHRvIHNlbmQgU0lHSU5ULCBTSUdURVJNIGFuZCBTSUdLSUxMIHRvIHRoZVxuICogbWF0Y2hlZCBwcm9jZXNzZXMgaW4gdGhpcyBvcmRlciBpZiB0aGUgcHJvY2VzcyBpcyBzdGlsbCBydW5uaW5nLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBwZ3JlcFBhdHRlcm4gLSBwZ3JlcC1jb21wYXRpYmxlIHNlYXJjaCBwYXR0ZXJuLlxuICovXG5hc3luYyBmdW5jdGlvbiBraWxsQXBwVXNpbmdQYXR0ZXJuIChwZ3JlcFBhdHRlcm4pIHtcbiAgZm9yIChjb25zdCBzaWduYWwgb2YgWzIsIDE1LCA5XSkge1xuICAgIGlmICghYXdhaXQgZ2V0UElEc1VzaW5nUGF0dGVybihwZ3JlcFBhdHRlcm4pKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGFyZ3MgPSBbYC0ke3NpZ25hbH1gLCAnLWlmJywgcGdyZXBQYXR0ZXJuXTtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgZXhlYygncGtpbGwnLCBhcmdzKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZy5kZWJ1ZyhgcGtpbGwgJHthcmdzLmpvaW4oJyAnKX0gLT4gJHtlcnIubWVzc2FnZX1gKTtcbiAgICB9XG4gICAgYXdhaXQgQi5kZWxheSgxMDApO1xuICB9XG59XG5cbi8qKlxuICogS2lsbHMgcnVubmluZyBYQ1Rlc3QgcHJvY2Vzc2VzIGZvciB0aGUgcGFydGljdWxhciBkZXZpY2UuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHVkaWQgLSBUaGUgZGV2aWNlIFVESUQuXG4gKiBAcGFyYW0ge2Jvb2xlYW59IGlzU2ltdWxhdG9yIC0gRXF1YWxzIHRvIHRydWUgaWYgdGhlIGN1cnJlbnQgZGV2aWNlIGlzIGEgU2ltdWxhdG9yXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHJlc2V0WENUZXN0UHJvY2Vzc2VzICh1ZGlkLCBpc1NpbXVsYXRvcikge1xuICBjb25zdCBwcm9jZXNzUGF0dGVybnMgPSBbYHhjb2RlYnVpbGQuKiR7dWRpZH1gXTtcbiAgaWYgKGlzU2ltdWxhdG9yKSB7XG4gICAgcHJvY2Vzc1BhdHRlcm5zLnB1c2goYCR7dWRpZH0uKlhDVFJ1bm5lcmApO1xuICB9XG4gIGxvZy5kZWJ1ZyhgS2lsbGluZyBydW5uaW5nIHByb2Nlc3NlcyAnJHtwcm9jZXNzUGF0dGVybnMuam9pbignLCAnKX0nIGZvciB0aGUgZGV2aWNlICR7dWRpZH0uLi5gKTtcbiAgZm9yIChjb25zdCBwZ3JlcFBhdHRlcm4gb2YgcHJvY2Vzc1BhdHRlcm5zKSB7XG4gICAgYXdhaXQga2lsbEFwcFVzaW5nUGF0dGVybihwZ3JlcFBhdHRlcm4pO1xuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHByaW50VXNlciAoKSB7XG4gIHRyeSB7XG4gICAgbGV0IHtzdGRvdXR9ID0gYXdhaXQgZXhlYygnd2hvYW1pJyk7XG4gICAgbG9nLmRlYnVnKGBDdXJyZW50IHVzZXI6ICcke3N0ZG91dC50cmltKCl9J2ApO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBsb2cuZGVidWcoYFVuYWJsZSB0byBnZXQgdXNlcm5hbWUgcnVubmluZyBzZXJ2ZXI6ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gcHJpbnRMaWJpbW9iaWxlZGV2aWNlSW5mbyAoKSB7XG4gIHRyeSB7XG4gICAgbGV0IHtzdGRvdXR9ID0gYXdhaXQgZXhlYygnYnJldycsIFsnaW5mbycsICdsaWJpbW9iaWxlZGV2aWNlJ10pO1xuICAgIGxldCBtYXRjaCA9IC9saWJpbW9iaWxlZGV2aWNlOiguKykvLmV4ZWMoc3Rkb3V0KTtcbiAgICBpZiAobWF0Y2ggJiYgbWF0Y2hbMV0pIHtcbiAgICAgIGxvZy5kZWJ1ZyhgQ3VycmVudCB2ZXJzaW9uIG9mIGxpYmltb2JpbGVkZXZpY2U6ICR7bWF0Y2hbMV0udHJpbSgpfWApO1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbG9nLmRlYnVnKGBVbmFibGUgdG8gZ2V0IHZlcnNpb24gb2YgbGliaW1vYmlsZWRldmljZTogJHtlcnIubWVzc2FnZX1gKTtcbiAgfVxufVxuXG4vKipcbiAqIEdldCB0aGUgSURzIG9mIHByb2Nlc3NlcyBsaXN0ZW5pbmcgb24gdGhlIHBhcnRpY3VsYXIgc3lzdGVtIHBvcnQuXG4gKiBJdCBpcyBhbHNvIHBvc3NpYmxlIHRvIGFwcGx5IGFkZGl0aW9uYWwgZmlsdGVyaW5nIGJhc2VkIG9uIHRoZVxuICogcHJvY2VzcyBjb21tYW5kIGxpbmUuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd8bnVtYmVyfSBwb3J0IC0gVGhlIHBvcnQgbnVtYmVyLlxuICogQHBhcmFtIHs/RnVuY3Rpb259IGZpbHRlcmluZ0Z1bmMgLSBPcHRpb25hbCBsYW1iZGEgZnVuY3Rpb24sIHdoaWNoXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlY2VpdmVzIGNvbW1hbmQgbGluZSBzdHJpbmcgb2YgdGhlIHBhcnRpY3VsYXIgcHJvY2Vzc1xuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0ZW5pbmcgb24gZ2l2ZW4gcG9ydCwgYW5kIGlzIGV4cGVjdGVkIHRvIHJldHVyblxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlaXRoZXIgdHJ1ZSBvciBmYWxzZSB0byBpbmNsdWRlL2V4Y2x1ZGUgdGhlIGNvcnJlc3BvbmRpbmcgUElEXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyb20gdGhlIHJlc3VsdGluZyBhcnJheS5cbiAqIEByZXR1cm5zIHtBcnJheTxzdHJpbmc+fSAtIHRoZSBsaXN0IG9mIG1hdGNoZWQgcHJvY2VzcyBpZHMuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGdldFBJRHNMaXN0ZW5pbmdPblBvcnQgKHBvcnQsIGZpbHRlcmluZ0Z1bmMgPSBudWxsKSB7XG4gIGNvbnN0IHJlc3VsdCA9IFtdO1xuICB0cnkge1xuICAgIC8vIFRoaXMgb25seSB3b3JrcyBzaW5jZSBNYWMgT1MgWCBFbCBDYXBpdGFuXG4gICAgY29uc3Qge3N0ZG91dH0gPSBhd2FpdCBleGVjKCdsc29mJywgWyctdGknLCBgdGNwOiR7cG9ydH1gXSk7XG4gICAgcmVzdWx0LnB1c2goLi4uKHN0ZG91dC50cmltKCkuc3BsaXQoL1xcbisvKSkpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIGlmICghXy5pc0Z1bmN0aW9uKGZpbHRlcmluZ0Z1bmMpKSB7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuICByZXR1cm4gYXdhaXQgQi5maWx0ZXIocmVzdWx0LCBhc3luYyAoeCkgPT4ge1xuICAgIGNvbnN0IHtzdGRvdXR9ID0gYXdhaXQgZXhlYygncHMnLCBbJy1wJywgeCwgJy1vJywgJ2NvbW1hbmQnXSk7XG4gICAgcmV0dXJuIGF3YWl0IGZpbHRlcmluZ0Z1bmMoc3Rkb3V0KTtcbiAgfSk7XG59XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gVXBsb2FkT3B0aW9uc1xuICpcbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gdXNlciAtIFRoZSBuYW1lIG9mIHRoZSB1c2VyIGZvciB0aGUgcmVtb3RlIGF1dGhlbnRpY2F0aW9uLiBPbmx5IHdvcmtzIGlmIGByZW1vdGVQYXRoYCBpcyBwcm92aWRlZC5cbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gcGFzcyAtIFRoZSBwYXNzd29yZCBmb3IgdGhlIHJlbW90ZSBhdXRoZW50aWNhdGlvbi4gT25seSB3b3JrcyBpZiBgcmVtb3RlUGF0aGAgaXMgcHJvdmlkZWQuXG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IG1ldGhvZCAtIFRoZSBodHRwIG11bHRpcGFydCB1cGxvYWQgbWV0aG9kIG5hbWUuIFRoZSAnUFVUJyBvbmUgaXMgdXNlZCBieSBkZWZhdWx0LlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPbmx5IHdvcmtzIGlmIGByZW1vdGVQYXRoYCBpcyBwcm92aWRlZC5cbiAqL1xuXG5cbi8qKlxuICogRW5jb2RlcyB0aGUgZ2l2ZW4gbG9jYWwgZmlsZSB0byBiYXNlNjQgYW5kIHJldHVybnMgdGhlIHJlc3VsdGluZyBzdHJpbmdcbiAqIG9yIHVwbG9hZHMgaXQgdG8gYSByZW1vdGUgc2VydmVyIHVzaW5nIGh0dHAvaHR0cHMgb3IgZnRwIHByb3RvY29sc1xuICogaWYgYHJlbW90ZVBhdGhgIGlzIHNldFxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBsb2NhbEZpbGUgLSBUaGUgcGF0aCB0byBhbiBleGlzdGluZyBsb2NhbCBmaWxlXG4gKiBAcGFyYW0gez9zdHJpbmd9IHJlbW90ZVBhdGggLSBUaGUgcGF0aCB0byB0aGUgcmVtb3RlIGxvY2F0aW9uLCB3aGVyZVxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcyBmaWxlIHNob3VsZCBiZSB1cGxvYWRlZFxuICogQHBhcmFtIHs/VXBsb2FkT3B0aW9uc30gdXBsb2FkT3B0aW9ucyAtIFNldCBvZiB1cGxvYWQgb3B0aW9uc1xuICogQHJldHVybnMge3N0cmluZ30gRWl0aGVyIGFuIGVtcHR5IHN0cmluZyBpZiB0aGUgdXBsb2FkIHdhcyBzdWNjZXNzZnVsIG9yXG4gKiBiYXNlNjQtZW5jb2RlZCBmaWxlIHJlcHJlc2VudGF0aW9uIGlmIGByZW1vdGVQYXRoYCBpcyBmYWxzeVxuICovXG5hc3luYyBmdW5jdGlvbiBlbmNvZGVCYXNlNjRPclVwbG9hZCAobG9jYWxGaWxlLCByZW1vdGVQYXRoID0gbnVsbCwgdXBsb2FkT3B0aW9ucyA9IHt9KSB7XG4gIGlmICghYXdhaXQgZnMuZXhpc3RzKGxvY2FsRmlsZSkpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhgVGhlIGZpbGUgYXQgJyR7bG9jYWxGaWxlfScgZG9lcyBub3QgZXhpc3Qgb3IgaXMgbm90IGFjY2Vzc2libGVgKTtcbiAgfVxuXG4gIGNvbnN0IHtzaXplfSA9IGF3YWl0IGZzLnN0YXQobG9jYWxGaWxlKTtcbiAgbG9nLmRlYnVnKGBUaGUgc2l6ZSBvZiB0aGUgZmlsZSBpcyAke3V0aWwudG9SZWFkYWJsZVNpemVTdHJpbmcoc2l6ZSl9YCk7XG4gIGlmIChfLmlzRW1wdHkocmVtb3RlUGF0aCkpIHtcbiAgICBjb25zdCBtYXhNZW1vcnlMaW1pdCA9IHY4LmdldEhlYXBTdGF0aXN0aWNzKCkudG90YWxfYXZhaWxhYmxlX3NpemUgLyAyO1xuICAgIGlmIChzaXplID49IG1heE1lbW9yeUxpbWl0KSB7XG4gICAgICBsb2cuaW5mbyhgVGhlIGZpbGUgbWlnaHQgYmUgdG9vIGxhcmdlIHRvIGZpdCBpbnRvIHRoZSBwcm9jZXNzIG1lbW9yeSBgICtcbiAgICAgICAgYCgke3V0aWwudG9SZWFkYWJsZVNpemVTdHJpbmcoc2l6ZSl9ID49ICR7dXRpbC50b1JlYWRhYmxlU2l6ZVN0cmluZyhtYXhNZW1vcnlMaW1pdCl9KS4gYCArXG4gICAgICAgIGBQcm92aWRlIGEgbGluayB0byBhIHJlbW90ZSB3cml0YWJsZSBsb2NhdGlvbiBmb3IgdmlkZW8gdXBsb2FkIGAgK1xuICAgICAgICBgKGh0dHAocykgYW5kIGZ0cCBwcm90b2NvbHMgYXJlIHN1cHBvcnRlZCkgaWYgeW91IGV4cGVyaWVuY2UgT3V0IE9mIE1lbW9yeSBlcnJvcnNgKTtcbiAgICB9XG4gICAgY29uc3QgY29udGVudCA9IGF3YWl0IGZzLnJlYWRGaWxlKGxvY2FsRmlsZSk7XG4gICAgcmV0dXJuIGNvbnRlbnQudG9TdHJpbmcoJ2Jhc2U2NCcpO1xuICB9XG5cbiAgY29uc3QgcmVtb3RlVXJsID0gdXJsLnBhcnNlKHJlbW90ZVBhdGgpO1xuICBsZXQgb3B0aW9ucyA9IHt9O1xuICBjb25zdCB7dXNlciwgcGFzcywgbWV0aG9kfSA9IHVwbG9hZE9wdGlvbnM7XG4gIGlmIChyZW1vdGVVcmwucHJvdG9jb2wuc3RhcnRzV2l0aCgnaHR0cCcpKSB7XG4gICAgb3B0aW9ucyA9IHtcbiAgICAgIHVybDogcmVtb3RlVXJsLmhyZWYsXG4gICAgICBtZXRob2Q6IG1ldGhvZCB8fCAnUFVUJyxcbiAgICAgIG11bHRpcGFydDogW3sgYm9keTogX2ZzLmNyZWF0ZVJlYWRTdHJlYW0obG9jYWxGaWxlKSB9XSxcbiAgICB9O1xuICAgIGlmICh1c2VyICYmIHBhc3MpIHtcbiAgICAgIG9wdGlvbnMuYXV0aCA9IHt1c2VyLCBwYXNzfTtcbiAgICB9XG4gIH0gZWxzZSBpZiAocmVtb3RlVXJsLnByb3RvY29sID09PSAnZnRwOicpIHtcbiAgICBvcHRpb25zID0ge1xuICAgICAgaG9zdDogcmVtb3RlVXJsLmhvc3RuYW1lLFxuICAgICAgcG9ydDogcmVtb3RlVXJsLnBvcnQgfHwgMjEsXG4gICAgfTtcbiAgICBpZiAodXNlciAmJiBwYXNzKSB7XG4gICAgICBvcHRpb25zLnVzZXIgPSB1c2VyO1xuICAgICAgb3B0aW9ucy5wYXNzID0gcGFzcztcbiAgICB9XG4gIH1cbiAgYXdhaXQgbmV0LnVwbG9hZEZpbGUobG9jYWxGaWxlLCByZW1vdGVQYXRoLCBvcHRpb25zKTtcbiAgcmV0dXJuICcnO1xufVxuXG4vKipcbiAqIFN0b3BzIGFuZCByZW1vdmVzIGFsbCB3ZWIgc29ja2V0IGhhbmRsZXJzIHRoYXQgYXJlIGxpc3RlbmluZ1xuICogaW4gc2NvcGUgb2YgdGhlIGN1cnJlY3Qgc2Vzc2lvbi5cbiAqXG4gKiBAcGFyYW0ge09iamVjdH0gc2VydmVyIC0gVGhlIGluc3RhbmNlIG9mIE5vZGVKcyBIVFRQIHNlcnZlcixcbiAqIHdoaWNoIGhvc3RzIEFwcGl1bVxuICogQHBhcmFtIHtzdHJpbmd9IHNlc3Npb25JZCAtIFRoZSBpZCBvZiB0aGUgY3VycmVudCBzZXNzaW9uXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHJlbW92ZUFsbFNlc3Npb25XZWJTb2NrZXRIYW5kbGVycyAoc2VydmVyLCBzZXNzaW9uSWQpIHtcbiAgaWYgKCFzZXJ2ZXIgfHwgIV8uaXNGdW5jdGlvbihzZXJ2ZXIuZ2V0V2ViU29ja2V0SGFuZGxlcnMpKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgYWN0aXZlSGFuZGxlcnMgPSBhd2FpdCBzZXJ2ZXIuZ2V0V2ViU29ja2V0SGFuZGxlcnMoc2Vzc2lvbklkKTtcbiAgZm9yIChjb25zdCBwYXRobmFtZSBvZiBfLmtleXMoYWN0aXZlSGFuZGxlcnMpKSB7XG4gICAgYXdhaXQgc2VydmVyLnJlbW92ZVdlYlNvY2tldEhhbmRsZXIocGF0aG5hbWUpO1xuICB9XG59XG5cbi8qKlxuICogVmVyaWZ5IHdoZXRoZXIgdGhlIGdpdmVuIGFwcGxpY2F0aW9uIGlzIGNvbXBhdGlibGUgdG8gdGhlXG4gKiBwbGF0Zm9ybSB3aGVyZSBpdCBpcyBnb2luZyB0byBiZSBpbnN0YWxsZWQgYW5kIHRlc3RlZC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gYXBwIC0gVGhlIGFjdHVhbCBwYXRoIHRvIHRoZSBhcHBsaWNhdGlvbiBidW5kbGVcbiAqIEBwYXJhbSB7Ym9vbGVhbn0gaXNTaW11bGF0b3IgLSBTaG91bGQgYmUgc2V0IHRvIGB0cnVlYCBpZiB0aGUgdGVzdCB3aWxsIGJlIGV4ZWN1dGVkIG9uIFNpbXVsYXRvclxuICogQHJldHVybnMgez9ib29sZWFufSBUaGUgZnVuY3Rpb24gcmV0dXJucyBgbnVsbGAgaWYgdGhlIGFwcGxpY2F0aW9uIGRvZXMgbm90IGV4aXN0IG9yIHRoZXJlIGlzIG5vXG4gKiBgQ0ZCdW5kbGVTdXBwb3J0ZWRQbGF0Zm9ybXNgIGtleSBpbiBpdHMgSW5mby5wbGlzdCBtYW5pZmVzdC5cbiAqIGB0cnVlYCBpcyByZXR1cm5lZCBpZiB0aGUgYnVuZGxlIGFyY2hpdGVjdHVyZSBtYXRjaGVzIHRoZSBkZXZpY2UgYXJjaGl0ZWN0dXJlLlxuICogQHRocm93cyB7RXJyb3J9IElmIGJ1bmRsZSBhcmNoaXRlY3R1cmUgZG9lcyBub3QgbWF0Y2ggdGhlIGRldmljZSBhcmNoaXRlY3R1cmUuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHZlcmlmeUFwcGxpY2F0aW9uUGxhdGZvcm0gKGFwcCwgaXNTaW11bGF0b3IsIGlzVHZPUykge1xuICBsb2cuZGVidWcoJ1ZlcmlmeWluZyBhcHBsaWNhdGlvbiBwbGF0Zm9ybScpO1xuXG4gIGNvbnN0IGluZm9QbGlzdCA9IHBhdGgucmVzb2x2ZShhcHAsICdJbmZvLnBsaXN0Jyk7XG4gIGlmICghYXdhaXQgZnMuZXhpc3RzKGluZm9QbGlzdCkpIHtcbiAgICBsb2cuZGVidWcoYCcke2luZm9QbGlzdH0nIGRvZXMgbm90IGV4aXN0YCk7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBjb25zdCB7Q0ZCdW5kbGVTdXBwb3J0ZWRQbGF0Zm9ybXN9ID0gYXdhaXQgcGxpc3QucGFyc2VQbGlzdEZpbGUoaW5mb1BsaXN0KTtcbiAgbG9nLmRlYnVnKGBDRkJ1bmRsZVN1cHBvcnRlZFBsYXRmb3JtczogJHtKU09OLnN0cmluZ2lmeShDRkJ1bmRsZVN1cHBvcnRlZFBsYXRmb3Jtcyl9YCk7XG4gIGlmICghXy5pc0FycmF5KENGQnVuZGxlU3VwcG9ydGVkUGxhdGZvcm1zKSkge1xuICAgIGxvZy5kZWJ1ZyhgQ0ZCdW5kbGVTdXBwb3J0ZWRQbGF0Zm9ybXMga2V5IGRvZXMgbm90IGV4aXN0IGluICcke2luZm9QbGlzdH0nYCk7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBjb25zdCBleHBlY3RlZFBsYXRmb3JtID0gaXNTaW11bGF0b3JcbiAgICA/IGlzVHZPUyA/ICdBcHBsZVRWU2ltdWxhdG9yJyA6ICdpUGhvbmVTaW11bGF0b3InXG4gICAgOiBpc1R2T1MgPyAnQXBwbGVUVk9TJyA6ICdpUGhvbmVPUyc7XG5cbiAgY29uc3QgaXNBcHBTdXBwb3J0ZWQgPSBDRkJ1bmRsZVN1cHBvcnRlZFBsYXRmb3Jtcy5pbmNsdWRlcyhleHBlY3RlZFBsYXRmb3JtKTtcbiAgaWYgKGlzQXBwU3VwcG9ydGVkKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgdGhyb3cgbmV3IEVycm9yKGAke2lzU2ltdWxhdG9yID8gJ1NpbXVsYXRvcicgOiAnUmVhbCBkZXZpY2UnfSBhcmNoaXRlY3R1cmUgaXMgdW5zdXBwb3J0ZWQgYnkgdGhlICcke2FwcH0nIGFwcGxpY2F0aW9uLiBgICtcbiAgICAgICAgICAgICAgICAgIGBNYWtlIHN1cmUgdGhlIGNvcnJlY3QgZGVwbG95bWVudCB0YXJnZXQgaGFzIGJlZW4gc2VsZWN0ZWQgZm9yIGl0cyBjb21waWxhdGlvbiBpbiBYY29kZS5gKTtcbn1cblxuLyoqXG4gKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgcGxhdGZvcm1OYW1lIGlzIHR2T1NcbiAqIEBwYXJhbSB7c3RyaW5nfSBwbGF0Zm9ybU5hbWUgVGhlIG5hbWUgb2YgdGhlIHBsYXRvcm1cbiAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm4gdHJ1ZSBpZiB0aGUgcGxhdGZvcm1OYW1lIGlzIHR2T1NcbiAqL1xuZnVuY3Rpb24gaXNUdk9TIChwbGF0Zm9ybU5hbWUpIHtcbiAgcmV0dXJuIF8udG9Mb3dlcihwbGF0Zm9ybU5hbWUpID09PSBfLnRvTG93ZXIoUExBVEZPUk1fTkFNRV9UVk9TKTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRydWUgaWYgdGhlIHVybFN0cmluZyBpcyBsb2NhbGhvc3RcbiAqIEBwYXJhbSB7P3N0cmluZ30gdXJsU3RyaW5nXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJuIHRydWUgaWYgdGhlIHVybFN0cmluZyBpcyBsb2NhbGhvc3RcbiAqL1xuZnVuY3Rpb24gaXNMb2NhbEhvc3QgKHVybFN0cmluZykge1xuICB0cnkge1xuICAgIGNvbnN0IHtob3N0bmFtZX0gPSB1cmwucGFyc2UodXJsU3RyaW5nKTtcbiAgICByZXR1cm4gWydsb2NhbGhvc3QnLCAnMTI3LjAuMC4xJywgJzo6MScsICc6OmZmZmY6MTI3LjAuMC4xJ10uaW5jbHVkZXMoaG9zdG5hbWUpO1xuICB9IGNhdGNoIChpZ24pIHtcbiAgICBsb2cud2FybihgJyR7dXJsU3RyaW5nfScgY2Fubm90IGJlIHBhcnNlZCBhcyBhIHZhbGlkIFVSTGApO1xuICB9XG4gIHJldHVybiBmYWxzZTtcbn1cblxuLyoqXG4gKiBOb3JtYWxpemVzIHBsYXRmb3JtVmVyc2lvbiB0byBhIHZhbGlkIGlPUyB2ZXJzaW9uIHN0cmluZ1xuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBvcmlnaW5hbFZlcnNpb24gLSBMb29zZSB2ZXJzaW9uIG51bWJlciwgdGhhdCBjYW4gYmUgcGFyc2VkIGJ5IHNlbXZlclxuICogQHJldHVybiB7c3RyaW5nfSBpT1MgdmVyc2lvbiBudW1iZXIgaW4gPG1ham9yPi48bWlub3I+IGZvcm1hdFxuICogQHRocm93cyB7RXJyb3J9IGlmIHRoZSB2ZXJzaW9uIG51bWJlciBjYW5ub3QgYmUgcGFyc2VkXG4gKi9cbmZ1bmN0aW9uIG5vcm1hbGl6ZVBsYXRmb3JtVmVyc2lvbiAob3JpZ2luYWxWZXJzaW9uKSB7XG4gIGNvbnN0IG5vcm1hbGl6ZWRWZXJzaW9uID0gdXRpbC5jb2VyY2VWZXJzaW9uKG9yaWdpbmFsVmVyc2lvbiwgZmFsc2UpO1xuICBpZiAoIW5vcm1hbGl6ZWRWZXJzaW9uKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgcGxhdGZvcm0gdmVyc2lvbiAnJHtvcmlnaW5hbFZlcnNpb259JyBzaG91bGQgYmUgYSB2YWxpZCB2ZXJzaW9uIG51bWJlcmApO1xuICB9XG4gIGNvbnN0IHttYWpvciwgbWlub3J9ID0gbmV3IHNlbXZlci5TZW1WZXIobm9ybWFsaXplZFZlcnNpb24pO1xuICByZXR1cm4gYCR7bWFqb3J9LiR7bWlub3J9YDtcbn1cblxuZXhwb3J0IHsgZGV0ZWN0VWRpZCwgZ2V0QW5kQ2hlY2tYY29kZVZlcnNpb24sIGdldEFuZENoZWNrSW9zU2RrVmVyc2lvbixcbiAgY2hlY2tBcHBQcmVzZW50LCBnZXREcml2ZXJJbmZvLFxuICBjbGVhclN5c3RlbUZpbGVzLCB0cmFuc2xhdGVEZXZpY2VOYW1lLCBub3JtYWxpemVDb21tYW5kVGltZW91dHMsXG4gIERFRkFVTFRfVElNRU9VVF9LRVksIHJlc2V0WENUZXN0UHJvY2Vzc2VzLCBnZXRQSURzVXNpbmdQYXR0ZXJuLFxuICBtYXJrU3lzdGVtRmlsZXNGb3JDbGVhbnVwLCBwcmludFVzZXIsIHByaW50TGliaW1vYmlsZWRldmljZUluZm8sXG4gIGdldFBJRHNMaXN0ZW5pbmdPblBvcnQsIGVuY29kZUJhc2U2NE9yVXBsb2FkLCByZW1vdmVBbGxTZXNzaW9uV2ViU29ja2V0SGFuZGxlcnMsXG4gIHZlcmlmeUFwcGxpY2F0aW9uUGxhdGZvcm0sIGlzVHZPUywgaXNMb2NhbEhvc3QsIG5vcm1hbGl6ZVBsYXRmb3JtVmVyc2lvbiB9O1xuIl0sImZpbGUiOiJsaWIvdXRpbHMuanMiLCJzb3VyY2VSb290IjoiLi4vLi4ifQ==
