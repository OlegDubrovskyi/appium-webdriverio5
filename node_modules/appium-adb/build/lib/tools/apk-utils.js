"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.REMOTE_CACHE_ROOT = void 0;

require("source-map-support/register");

var _helpers = require("../helpers.js");

var _teen_process = require("teen_process");

var _logger = _interopRequireDefault(require("../logger.js"));

var _path = _interopRequireDefault(require("path"));

var _lodash = _interopRequireDefault(require("lodash"));

var _asyncbox = require("asyncbox");

var _appiumSupport = require("appium-support");

var _semver = _interopRequireDefault(require("semver"));

var _os = _interopRequireDefault(require("os"));

var _lruCache = _interopRequireDefault(require("lru-cache"));

let apkUtilsMethods = {};
const ACTIVITIES_TROUBLESHOOTING_LINK = 'https://github.com/appium/appium/blob/master/docs/en/writing-running-appium/android/activity-startup.md';
apkUtilsMethods.APP_INSTALL_STATE = {
  UNKNOWN: 'unknown',
  NOT_INSTALLED: 'notInstalled',
  NEWER_VERSION_INSTALLED: 'newerVersionInstalled',
  SAME_VERSION_INSTALLED: 'sameVersionInstalled',
  OLDER_VERSION_INSTALLED: 'olderVersionInstalled'
};
const REMOTE_CACHE_ROOT = '/data/local/tmp/appium_cache';
exports.REMOTE_CACHE_ROOT = REMOTE_CACHE_ROOT;

apkUtilsMethods.isAppInstalled = async function isAppInstalled(pkg) {
  _logger.default.debug(`Getting install status for ${pkg}`);

  const installedPattern = new RegExp(`^\\s*Package\\s+\\[${_lodash.default.escapeRegExp(pkg)}\\][^:]+:$`, 'm');

  try {
    const stdout = await this.shell(['dumpsys', 'package', pkg]);
    const isInstalled = installedPattern.test(stdout);

    _logger.default.debug(`'${pkg}' is${!isInstalled ? ' not' : ''} installed`);

    return isInstalled;
  } catch (e) {
    throw new Error(`Error finding if '${pkg}' is installed. Original error: ${e.message}`);
  }
};

apkUtilsMethods.startUri = async function startUri(uri, pkg) {
  if (!uri || !pkg) {
    throw new Error('URI and package arguments are required');
  }

  const args = ['am', 'start', '-W', '-a', 'android.intent.action.VIEW', '-d', uri.replace(/&/g, '\\&'), pkg];

  try {
    const res = await this.shell(args);

    if (res.toLowerCase().includes('unable to resolve intent')) {
      throw new Error(res);
    }
  } catch (e) {
    throw new Error(`Error attempting to start URI. Original error: ${e}`);
  }
};

apkUtilsMethods.startApp = async function startApp(startAppOptions = {}) {
  if (!startAppOptions.activity || !startAppOptions.pkg) {
    throw new Error('activity and pkg are required to start an application');
  }

  startAppOptions = _lodash.default.clone(startAppOptions);
  startAppOptions.activity = startAppOptions.activity.replace('$', '\\$');

  _lodash.default.defaults(startAppOptions, {
    waitPkg: startAppOptions.pkg,
    waitForLaunch: true,
    waitActivity: false,
    retry: true,
    stopApp: true
  });

  startAppOptions.waitPkg = startAppOptions.waitPkg || startAppOptions.pkg;
  const apiLevel = await this.getApiLevel();
  const cmd = (0, _helpers.buildStartCmd)(startAppOptions, apiLevel);

  try {
    const shellOpts = {};

    if (_lodash.default.isInteger(startAppOptions.waitDuration) && startAppOptions.waitDuration > 20000) {
      shellOpts.timeout = startAppOptions.waitDuration;
    }

    const stdout = await this.shell(cmd, shellOpts);

    if (stdout.includes('Error: Activity class') && stdout.includes('does not exist')) {
      if (startAppOptions.retry && !startAppOptions.activity.startsWith('.')) {
        _logger.default.debug(`We tried to start an activity that doesn't exist, ` + `retrying with '.${startAppOptions.activity}' activity name`);

        startAppOptions.activity = `.${startAppOptions.activity}`;
        startAppOptions.retry = false;
        return await this.startApp(startAppOptions);
      }

      throw new Error(`Activity name '${startAppOptions.activity}' used to start the app doesn't ` + `exist or cannot be launched! Make sure it exists and is a launchable activity`);
    } else if (stdout.includes('java.lang.SecurityException')) {
      throw new Error(`The permission to start '${startAppOptions.activity}' activity has been denied.` + `Make sure the activity/package names are correct.`);
    }

    if (startAppOptions.waitActivity) {
      await this.waitForActivity(startAppOptions.waitPkg, startAppOptions.waitActivity, startAppOptions.waitDuration);
    }

    return stdout;
  } catch (e) {
    throw new Error(`Cannot start the '${startAppOptions.pkg}' application. ` + `Visit ${ACTIVITIES_TROUBLESHOOTING_LINK} for troubleshooting. ` + `Original error: ${e.message}`);
  }
};

apkUtilsMethods.dumpWindows = async function dumpWindows() {
  const apiLevel = await this.getApiLevel();
  const dumpsysArg = apiLevel >= 29 ? 'displays' : 'windows';
  const cmd = ['dumpsys', 'window', dumpsysArg];
  return await this.shell(cmd);
};

apkUtilsMethods.getFocusedPackageAndActivity = async function getFocusedPackageAndActivity() {
  _logger.default.debug('Getting focused package and activity');

  const nullFocusedAppRe = new RegExp(/^\s*mFocusedApp=null/, 'm');
  const focusedAppRe = new RegExp('^\\s*mFocusedApp.+Record\\{.*\\s([^\\s\\/\\}]+)' + '\\/([^\\s\\/\\}\\,]+)\\,?(\\s[^\\s\\/\\}]+)*\\}', 'm');
  const nullCurrentFocusRe = new RegExp(/^\s*mCurrentFocus=null/, 'm');
  const currentFocusAppRe = new RegExp('^\\s*mCurrentFocus.+\\{.+\\s([^\\s\\/]+)\\/([^\\s]+)\\b', 'm');

  try {
    const stdout = await this.dumpWindows();

    for (const pattern of [focusedAppRe, currentFocusAppRe]) {
      const match = pattern.exec(stdout);

      if (match) {
        return {
          appPackage: match[1].trim(),
          appActivity: match[2].trim()
        };
      }
    }

    for (const pattern of [nullFocusedAppRe, nullCurrentFocusRe]) {
      if (pattern.exec(stdout)) {
        return {
          appPackage: null,
          appActivity: null
        };
      }
    }

    throw new Error('Could not parse activity from dumpsys');
  } catch (e) {
    throw new Error(`Could not get focusPackageAndActivity. Original error: ${e.message}`);
  }
};

apkUtilsMethods.waitForActivityOrNot = async function waitForActivityOrNot(pkg, activity, waitForStop, waitMs = 20000) {
  if (!pkg || !activity) {
    throw new Error('Package and activity required.');
  }

  _logger.default.debug(`Waiting up to ${waitMs}ms for activity matching pkg: '${pkg}' and ` + `activity: '${activity}' to${waitForStop ? ' not' : ''} be focused`);

  const splitNames = names => names.split(',').map(name => name.trim());

  const allPackages = splitNames(pkg);
  const allActivities = splitNames(activity);
  let possibleActivityNames = [];

  for (let oneActivity of allActivities) {
    if (oneActivity.startsWith('.')) {
      for (let currentPkg of allPackages) {
        possibleActivityNames.push(`${currentPkg}${oneActivity}`.replace(/\.+/g, '.'));
      }
    } else {
      possibleActivityNames.push(oneActivity);
      possibleActivityNames.push(`${pkg}.${oneActivity}`);
    }
  }

  _logger.default.debug(`Possible activities, to be checked: ${possibleActivityNames.map(name => `'${name}'`).join(', ')}`);

  let possibleActivityPatterns = possibleActivityNames.map(possibleActivityName => new RegExp(`^${possibleActivityName.replace(/\./g, '\\.').replace(/\*/g, '.*?').replace(/\$/g, '\\$')}$`));
  let retries = parseInt(waitMs / 750, 10) || 1;
  retries = isNaN(retries) ? 30 : retries;
  await (0, _asyncbox.retryInterval)(retries, 750, async () => {
    let {
      appPackage,
      appActivity
    } = await this.getFocusedPackageAndActivity();

    if (appActivity && appPackage) {
      let fullyQualifiedActivity = appActivity.startsWith('.') ? `${appPackage}${appActivity}` : appActivity;

      _logger.default.debug(`Found package: '${appPackage}' and fully qualified activity name : '${fullyQualifiedActivity}'`);

      let foundAct = _lodash.default.includes(allPackages, appPackage) && _lodash.default.findIndex(possibleActivityPatterns, possiblePattern => possiblePattern.test(fullyQualifiedActivity)) !== -1;

      if (!waitForStop && foundAct || waitForStop && !foundAct) {
        return;
      }
    }

    _logger.default.debug('Incorrect package and activity. Retrying.');

    throw new Error(`${possibleActivityNames.map(name => `'${name}'`).join(' or ')} never ${waitForStop ? 'stopped' : 'started'}. ` + `Visit ${ACTIVITIES_TROUBLESHOOTING_LINK} for troubleshooting`);
  });
};

apkUtilsMethods.waitForActivity = async function waitForActivity(pkg, act, waitMs = 20000) {
  await this.waitForActivityOrNot(pkg, act, false, waitMs);
};

apkUtilsMethods.waitForNotActivity = async function waitForNotActivity(pkg, act, waitMs = 20000) {
  await this.waitForActivityOrNot(pkg, act, true, waitMs);
};

apkUtilsMethods.uninstallApk = async function uninstallApk(pkg, options = {}) {
  _logger.default.debug(`Uninstalling ${pkg}`);

  if (!(await this.isAppInstalled(pkg))) {
    _logger.default.info(`${pkg} was not uninstalled, because it was not present on the device`);

    return false;
  }

  const cmd = ['uninstall'];

  if (options.keepData) {
    cmd.push('-k');
  }

  cmd.push(pkg);
  let stdout;

  try {
    await this.forceStop(pkg);
    stdout = (await this.adbExec(cmd, {
      timeout: options.timeout
    })).trim();
  } catch (e) {
    throw new Error(`Unable to uninstall APK. Original error: ${e.message}`);
  }

  _logger.default.debug(`'adb ${cmd.join(' ')}' command output: ${stdout}`);

  if (stdout.includes('Success')) {
    _logger.default.info(`${pkg} was successfully uninstalled`);

    return true;
  }

  _logger.default.info(`${pkg} was not uninstalled`);

  return false;
};

apkUtilsMethods.installFromDevicePath = async function installFromDevicePath(apkPathOnDevice, opts = {}) {
  let stdout = await this.shell(['pm', 'install', '-r', apkPathOnDevice], opts);

  if (stdout.indexOf('Failure') !== -1) {
    throw new Error(`Remote install failed: ${stdout}`);
  }
};

apkUtilsMethods.cacheApk = async function cacheApk(apkPath, options = {}) {
  const appHash = await _appiumSupport.fs.hash(apkPath);

  const remotePath = _path.default.posix.join(REMOTE_CACHE_ROOT, `${appHash}.apk`);

  const remoteCachedFiles = [];

  try {
    const errorMarker = '_ERROR_';
    let lsOutput = null;

    if (this._areExtendedLsOptionsSupported === true || !_lodash.default.isBoolean(this._areExtendedLsOptionsSupported)) {
      lsOutput = await this.shell([`ls -t -1 ${REMOTE_CACHE_ROOT} 2>&1 || echo ${errorMarker}`]);
    }

    if (!_lodash.default.isString(lsOutput) || lsOutput.includes(errorMarker) && !lsOutput.includes(REMOTE_CACHE_ROOT)) {
      if (!_lodash.default.isBoolean(this._areExtendedLsOptionsSupported)) {
        _logger.default.debug('The current Android API does not support extended ls options. ' + 'Defaulting to no-options call');
      }

      lsOutput = await this.shell([`ls ${REMOTE_CACHE_ROOT} 2>&1 || echo ${errorMarker}`]);
      this._areExtendedLsOptionsSupported = false;
    } else {
      this._areExtendedLsOptionsSupported = true;
    }

    if (lsOutput.includes(errorMarker)) {
      throw new Error(lsOutput.substring(0, lsOutput.indexOf(errorMarker)));
    }

    remoteCachedFiles.push(...lsOutput.split('\n').map(x => x.trim()).filter(Boolean));
  } catch (e) {
    _logger.default.debug(`Got an error '${e.message.trim()}' while getting the list of files in the cache. ` + `Assuming the cache does not exist yet`);

    await this.shell(['mkdir', '-p', REMOTE_CACHE_ROOT]);
  }

  _logger.default.debug(`The count of applications in the cache: ${remoteCachedFiles.length}`);

  const toHash = remotePath => _path.default.posix.parse(remotePath).name;

  if (remoteCachedFiles.find(x => toHash(x) === appHash)) {
    _logger.default.info(`The application at '${apkPath}' is already cached to '${remotePath}'`);
  } else {
    _logger.default.info(`Caching the application at '${apkPath}' to '${remotePath}'`);

    const started = process.hrtime();
    await this.push(apkPath, remotePath, {
      timeout: options.timeout
    });
    const [seconds, nanos] = process.hrtime(started);
    const {
      size
    } = await _appiumSupport.fs.stat(apkPath);

    _logger.default.info(`The upload of '${_path.default.basename(apkPath)}' (${_appiumSupport.util.toReadableSizeString(size)}) ` + `took ${(seconds + nanos / 1e9).toFixed(3)}s`);
  }

  if (!this.remoteAppsCache) {
    this.remoteAppsCache = new _lruCache.default({
      max: this.remoteAppsCacheLimit
    });
  }

  _lodash.default.difference(this.remoteAppsCache.keys(), remoteCachedFiles.map(toHash)).forEach(hash => this.remoteAppsCache.del(hash));

  this.remoteAppsCache.set(appHash, remotePath);
  const entriesToCleanup = remoteCachedFiles.map(x => _path.default.posix.join(REMOTE_CACHE_ROOT, x)).filter(x => !this.remoteAppsCache.has(toHash(x))).slice(this.remoteAppsCacheLimit - this.remoteAppsCache.keys().length);

  if (!_lodash.default.isEmpty(entriesToCleanup)) {
    try {
      await this.shell(['rm', '-f', ...entriesToCleanup]);

      _logger.default.debug(`Deleted ${entriesToCleanup.length} expired application cache entries`);
    } catch (e) {
      _logger.default.warn(`Cannot delete ${entriesToCleanup.length} expired application cache entries. ` + `Original error: ${e.message}`);
    }
  }

  return remotePath;
};

apkUtilsMethods.install = async function install(appPath, options = {}) {
  if (appPath.endsWith(_helpers.APKS_EXTENSION)) {
    return await this.installApks(appPath, options);
  }

  options = _lodash.default.cloneDeep(options);

  _lodash.default.defaults(options, {
    replace: true,
    timeout: this.adbExecTimeout === _helpers.DEFAULT_ADB_EXEC_TIMEOUT ? _helpers.APK_INSTALL_TIMEOUT : this.adbExecTimeout,
    timeoutCapName: 'androidInstallTimeout'
  });

  const installArgs = (0, _helpers.buildInstallArgs)((await this.getApiLevel()), options);
  const installOpts = {
    timeout: options.timeout,
    timeoutCapName: options.timeoutCapName
  };

  let performAppInstall = async () => await this.adbExec(['install', ...installArgs, appPath], installOpts);

  if (this.remoteAppsCacheLimit > 0) {
    const cachedRemotePath = await this.cacheApk(appPath, {
      timeout: options.timeout
    });

    performAppInstall = async () => await this.shell(['pm', 'install', ...installArgs, cachedRemotePath], installOpts);
  }

  try {
    const started = process.hrtime();
    const output = await performAppInstall();
    const [seconds, nanos] = process.hrtime(started);

    _logger.default.info(`The installation of '${_path.default.basename(appPath)}' took ${(seconds + nanos / 1e9).toFixed(3)}s`);

    const truncatedOutput = !_lodash.default.isString(output) || output.length <= 300 ? output : `${output.substr(0, 150)}...${output.substr(output.length - 150)}`;

    _logger.default.debug(`Install command stdout: ${truncatedOutput}`);

    if (/\[INSTALL[A-Z_]+FAILED[A-Z_]+\]/.test(output)) {
      if (this.isTestPackageOnlyError(output)) {
        const msg = `Set 'allowTestPackages' capability to true in order to allow test packages installation.`;

        _logger.default.warn(msg);

        throw new Error(`${output}\n${msg}`);
      }

      throw new Error(output);
    }
  } catch (err) {
    if (!err.message.includes('INSTALL_FAILED_ALREADY_EXISTS')) {
      throw err;
    }

    _logger.default.debug(`Application '${appPath}' already installed. Continuing.`);
  }
};

apkUtilsMethods.getApplicationInstallState = async function getApplicationInstallState(appPath, pkg = null) {
  let apkInfo = null;

  if (!pkg) {
    apkInfo = await this.getApkInfo(appPath);
    pkg = apkInfo.name;
  }

  if (!pkg) {
    _logger.default.warn(`Cannot read the package name of '${appPath}'`);

    return this.APP_INSTALL_STATE.UNKNOWN;
  }

  if (!(await this.isAppInstalled(pkg))) {
    _logger.default.debug(`App '${appPath}' is not installed`);

    return this.APP_INSTALL_STATE.NOT_INSTALLED;
  }

  const {
    versionCode: pkgVersionCode,
    versionName: pkgVersionNameStr
  } = await this.getPackageInfo(pkg);

  const pkgVersionName = _semver.default.valid(_semver.default.coerce(pkgVersionNameStr));

  if (!apkInfo) {
    apkInfo = await this.getApkInfo(appPath);
  }

  const {
    versionCode: apkVersionCode,
    versionName: apkVersionNameStr
  } = apkInfo;

  const apkVersionName = _semver.default.valid(_semver.default.coerce(apkVersionNameStr));

  if (!_lodash.default.isInteger(apkVersionCode) || !_lodash.default.isInteger(pkgVersionCode)) {
    _logger.default.warn(`Cannot read version codes of '${appPath}' and/or '${pkg}'`);

    if (!_lodash.default.isString(apkVersionName) || !_lodash.default.isString(pkgVersionName)) {
      _logger.default.warn(`Cannot read version names of '${appPath}' and/or '${pkg}'`);

      return this.APP_INSTALL_STATE.UNKNOWN;
    }
  }

  if (_lodash.default.isInteger(apkVersionCode) && _lodash.default.isInteger(pkgVersionCode)) {
    if (pkgVersionCode > apkVersionCode) {
      _logger.default.debug(`The version code of the installed '${pkg}' is greater than the application version code (${pkgVersionCode} > ${apkVersionCode})`);

      return this.APP_INSTALL_STATE.NEWER_VERSION_INSTALLED;
    }

    if (pkgVersionCode === apkVersionCode) {
      if (_lodash.default.isString(apkVersionName) && _lodash.default.isString(pkgVersionName) && _semver.default.satisfies(pkgVersionName, `>=${apkVersionName}`)) {
        _logger.default.debug(`The version name of the installed '${pkg}' is greater or equal to the application version name ('${pkgVersionName}' >= '${apkVersionName}')`);

        return _semver.default.satisfies(pkgVersionName, `>${apkVersionName}`) ? this.APP_INSTALL_STATE.NEWER_VERSION_INSTALLED : this.APP_INSTALL_STATE.SAME_VERSION_INSTALLED;
      }

      if (!_lodash.default.isString(apkVersionName) || !_lodash.default.isString(pkgVersionName)) {
        _logger.default.debug(`The version name of the installed '${pkg}' is equal to application version name (${pkgVersionCode} === ${apkVersionCode})`);

        return this.APP_INSTALL_STATE.SAME_VERSION_INSTALLED;
      }
    }
  } else if (_lodash.default.isString(apkVersionName) && _lodash.default.isString(pkgVersionName) && _semver.default.satisfies(pkgVersionName, `>=${apkVersionName}`)) {
    _logger.default.debug(`The version name of the installed '${pkg}' is greater or equal to the application version name ('${pkgVersionName}' >= '${apkVersionName}')`);

    return _semver.default.satisfies(pkgVersionName, `>${apkVersionName}`) ? this.APP_INSTALL_STATE.NEWER_VERSION_INSTALLED : this.APP_INSTALL_STATE.SAME_VERSION_INSTALLED;
  }

  _logger.default.debug(`The installed '${pkg}' package is older than '${appPath}' (${pkgVersionCode} < ${apkVersionCode} or '${pkgVersionName}' < '${apkVersionName}')'`);

  return this.APP_INSTALL_STATE.OLDER_VERSION_INSTALLED;
};

apkUtilsMethods.installOrUpgrade = async function installOrUpgrade(appPath, pkg = null, options = {}) {
  if (!pkg) {
    const apkInfo = await this.getApkInfo(appPath);
    pkg = apkInfo.name;
  }

  const appState = await this.getApplicationInstallState(appPath, pkg);

  switch (appState) {
    case this.APP_INSTALL_STATE.NOT_INSTALLED:
      _logger.default.debug(`Installing '${appPath}'`);

      await this.install(appPath, Object.assign({}, options, {
        replace: false
      }));
      return;

    case this.APP_INSTALL_STATE.NEWER_VERSION_INSTALLED:
    case this.APP_INSTALL_STATE.SAME_VERSION_INSTALLED:
      _logger.default.debug(`There is no need to install/upgrade '${appPath}'`);

      return;

    case this.APP_INSTALL_STATE.OLDER_VERSION_INSTALLED:
      _logger.default.debug(`Executing upgrade of '${appPath}'`);

      break;

    default:
      _logger.default.debug(`The current install state of '${appPath}' is unknown. Installing anyway`);

      break;
  }

  try {
    await this.install(appPath, Object.assign({}, options, {
      replace: true
    }));
  } catch (err) {
    _logger.default.warn(`Cannot upgrade '${pkg}' because of '${err.message}'. Trying full reinstall`);

    if (!(await this.uninstallApk(pkg))) {
      throw new Error(`'${pkg}' package cannot be uninstalled`);
    }

    await this.install(appPath, Object.assign({}, options, {
      replace: false
    }));
  }
};

apkUtilsMethods.extractStringsFromApk = async function extractStringsFromApk(appPath, language, out) {
  _logger.default.debug(`Extracting strings from for language: ${language || 'default'}`);

  if (appPath.endsWith(_helpers.APKS_EXTENSION)) {
    appPath = await this.extractLanguageApk(appPath, language);
  }

  await this.initAapt();
  let rawAaptOutput;

  try {
    const {
      stdout
    } = await (0, _teen_process.exec)(this.binaries.aapt, ['d', '--values', 'resources', appPath]);
    rawAaptOutput = stdout;
  } catch (e) {
    throw new Error(`Cannot extract resources from '${appPath}'. Original error: ${e.message}`);
  }

  const defaultConfigMarker = '(default)';
  let configMarker = language || defaultConfigMarker;

  if (configMarker.includes('-') && !configMarker.includes('-r')) {
    configMarker = configMarker.replace('-', '-r');
  }

  if (configMarker.toLowerCase().startsWith('en')) {
    const {
      stdout
    } = await (0, _teen_process.exec)(this.binaries.aapt, ['d', 'configurations', appPath]);
    const configs = stdout.split(_os.default.EOL);

    if (!configs.includes(configMarker)) {
      _logger.default.debug(`There is no '${configMarker}' configuration. ` + `Replacing it with '${defaultConfigMarker}'`);

      configMarker = defaultConfigMarker;
    }
  }

  const apkStrings = {};
  let isInConfig = false;
  let currentResourceId = null;
  let isInPluralGroup = false;

  const startsWithAny = (s, arr) => arr.reduce((acc, x) => acc || s.startsWith(x), false);

  const normalizeStringMatch = s => s.replace(/"$/, '').replace(/^"/, '').replace(/\\"/g, '"');

  for (const line of rawAaptOutput.split(_os.default.EOL)) {
    const trimmedLine = line.trim();

    if (_lodash.default.isEmpty(trimmedLine)) {
      continue;
    }

    if (startsWithAny(trimmedLine, ['config', 'type', 'spec', 'Package'])) {
      isInConfig = trimmedLine.startsWith(`config ${configMarker}:`);
      currentResourceId = null;
      isInPluralGroup = false;
      continue;
    }

    if (!isInConfig) {
      continue;
    }

    if (trimmedLine.startsWith('resource')) {
      isInPluralGroup = false;
      currentResourceId = null;

      if (trimmedLine.includes(':string/')) {
        const match = /:string\/(\S+):/.exec(trimmedLine);

        if (match) {
          currentResourceId = match[1];
        }
      } else if (trimmedLine.includes(':plurals/')) {
        const match = /:plurals\/(\S+):/.exec(trimmedLine);

        if (match) {
          currentResourceId = match[1];
          isInPluralGroup = true;
        }
      }

      continue;
    }

    if (currentResourceId && trimmedLine.startsWith('(string')) {
      const match = /"[^"\\]*(?:\\.[^"\\]*)*"/.exec(trimmedLine);

      if (match) {
        apkStrings[currentResourceId] = normalizeStringMatch(match[0]);
      }

      currentResourceId = null;
      continue;
    }

    if (currentResourceId && isInPluralGroup && trimmedLine.includes(': (string')) {
      const match = /"[^"\\]*(?:\\.[^"\\]*)*"/.exec(trimmedLine);

      if (match) {
        apkStrings[currentResourceId] = [...(apkStrings[currentResourceId] || []), normalizeStringMatch(match[0])];
      }

      continue;
    }
  }

  if (_lodash.default.isEmpty(apkStrings)) {
    _logger.default.warn(`No strings have been found in '${appPath}' resources ` + `for '${configMarker}' configuration`);
  } else {
    _logger.default.info(`Successfully extracted ${_lodash.default.keys(apkStrings).length} strings from '${appPath}' resources ` + `for '${configMarker}' configuration`);
  }

  const localPath = _path.default.resolve(out, 'strings.json');

  await (0, _appiumSupport.mkdirp)(out);
  await _appiumSupport.fs.writeFile(localPath, JSON.stringify(apkStrings, null, 2), 'utf-8');
  return {
    apkStrings,
    localPath
  };
};

apkUtilsMethods.getDeviceLanguage = async function getDeviceLanguage() {
  let language;

  if ((await this.getApiLevel()) < 23) {
    language = await this.getDeviceSysLanguage();

    if (!language) {
      language = await this.getDeviceProductLanguage();
    }
  } else {
    language = (await this.getDeviceLocale()).split('-')[0];
  }

  return language;
};

apkUtilsMethods.getDeviceCountry = async function getDeviceCountry() {
  let country = await this.getDeviceSysCountry();

  if (!country) {
    country = await this.getDeviceProductCountry();
  }

  return country;
};

apkUtilsMethods.getDeviceLocale = async function getDeviceLocale() {
  let locale = await this.getDeviceSysLocale();

  if (!locale) {
    locale = await this.getDeviceProductLocale();
  }

  return locale;
};

apkUtilsMethods.setDeviceLocale = async function setDeviceLocale(locale) {
  const validateLocale = new RegExp(/[a-zA-Z]+-[a-zA-Z0-9]+/);

  if (!validateLocale.test(locale)) {
    _logger.default.warn(`setDeviceLocale requires the following format: en-US or ja-JP`);

    return;
  }

  let split_locale = locale.split('-');
  await this.setDeviceLanguageCountry(split_locale[0], split_locale[1]);
};

apkUtilsMethods.ensureCurrentLocale = async function ensureCurrentLocale(language, country, script = null) {
  const hasLanguage = _lodash.default.isString(language);

  const hasCountry = _lodash.default.isString(country);

  if (!hasLanguage && !hasCountry) {
    _logger.default.warn('ensureCurrentLocale requires language or country');

    return false;
  }

  language = (language || '').toLowerCase();
  country = (country || '').toLowerCase();
  const apiLevel = await this.getApiLevel();
  return await (0, _asyncbox.retryInterval)(5, 1000, async () => {
    try {
      if (apiLevel < 23) {
        let curLanguage, curCountry;

        if (hasLanguage) {
          curLanguage = (await this.getDeviceLanguage()).toLowerCase();

          if (!hasCountry && language === curLanguage) {
            return true;
          }
        }

        if (hasCountry) {
          curCountry = (await this.getDeviceCountry()).toLowerCase();

          if (!hasLanguage && country === curCountry) {
            return true;
          }
        }

        if (language === curLanguage && country === curCountry) {
          return true;
        }
      } else {
        const curLocale = (await this.getDeviceLocale()).toLowerCase();
        const localeCode = script ? `${language}-${script.toLowerCase()}-${country}` : `${language}-${country}`;

        if (localeCode === curLocale) {
          _logger.default.debug(`Requested locale is equal to current locale: '${curLocale}'`);

          return true;
        }
      }

      return false;
    } catch (err) {
      _logger.default.error(`Unable to check device localization: ${err.message}`);

      _logger.default.debug('Restarting ADB and retrying...');

      await this.restartAdb();
      throw err;
    }
  });
};

apkUtilsMethods.setDeviceLanguageCountry = async function setDeviceLanguageCountry(language, country, script = null) {
  let hasLanguage = language && _lodash.default.isString(language);

  let hasCountry = country && _lodash.default.isString(country);

  if (!hasLanguage || !hasCountry) {
    _logger.default.warn(`setDeviceLanguageCountry requires language and country at least`);

    _logger.default.warn(`Got language: '${language}' and country: '${country}'`);

    return;
  }

  let apiLevel = await this.getApiLevel();
  language = (language || '').toLowerCase();
  country = (country || '').toUpperCase();

  if (apiLevel < 23) {
    let curLanguage = (await this.getDeviceLanguage()).toLowerCase();
    let curCountry = (await this.getDeviceCountry()).toUpperCase();

    if (language !== curLanguage || country !== curCountry) {
      await this.setDeviceSysLocaleViaSettingApp(language, country);
    }
  } else {
    let curLocale = await this.getDeviceLocale();
    const localeCode = script ? `${language}-${script}-${country}` : `${language}-${country}`;

    _logger.default.debug(`Current locale: '${curLocale}'; requested locale: '${localeCode}'`);

    if (localeCode.toLowerCase() !== curLocale.toLowerCase()) {
      await this.setDeviceSysLocaleViaSettingApp(language, country, script);
    }
  }
};

apkUtilsMethods.getApkInfo = async function getApkInfo(appPath) {
  if (!(await _appiumSupport.fs.exists(appPath))) {
    throw new Error(`The file at path ${appPath} does not exist or is not accessible`);
  }

  if (appPath.endsWith(_helpers.APKS_EXTENSION)) {
    appPath = await this.extractBaseApk(appPath);
  }

  await this.initAapt();

  try {
    const {
      stdout
    } = await (0, _teen_process.exec)(this.binaries.aapt, ['d', 'badging', appPath]);
    const matches = new RegExp(/package: name='([^']+)' versionCode='(\d+)' versionName='([^']+)'/).exec(stdout);

    if (matches) {
      return {
        name: matches[1],
        versionCode: parseInt(matches[2], 10),
        versionName: matches[3]
      };
    }
  } catch (err) {
    _logger.default.warn(`Error "${err.message}" while getting badging info`);
  }

  return {};
};

apkUtilsMethods.getPackageInfo = async function getPackageInfo(pkg) {
  _logger.default.debug(`Getting package info for '${pkg}'`);

  let result = {
    name: pkg
  };

  try {
    const stdout = await this.shell(['dumpsys', 'package', pkg]);
    const versionNameMatch = new RegExp(/versionName=([\d+.]+)/).exec(stdout);

    if (versionNameMatch) {
      result.versionName = versionNameMatch[1];
    }

    const versionCodeMatch = new RegExp(/versionCode=(\d+)/).exec(stdout);

    if (versionCodeMatch) {
      result.versionCode = parseInt(versionCodeMatch[1], 10);
    }

    return result;
  } catch (err) {
    _logger.default.warn(`Error '${err.message}' while dumping package info`);
  }

  return result;
};

apkUtilsMethods.pullApk = async function pullApk(pkg, tmpDir) {
  const pkgPath = (await this.adbExec(['shell', 'pm', 'path', pkg])).replace('package:', '');

  const tmpApp = _path.default.resolve(tmpDir, `${pkg}.apk`);

  await this.pull(pkgPath, tmpApp);

  _logger.default.debug(`Pulled app for package '${pkg}' to '${tmpApp}'`);

  return tmpApp;
};

var _default = apkUtilsMethods;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi90b29scy9hcGstdXRpbHMuanMiXSwibmFtZXMiOlsiYXBrVXRpbHNNZXRob2RzIiwiQUNUSVZJVElFU19UUk9VQkxFU0hPT1RJTkdfTElOSyIsIkFQUF9JTlNUQUxMX1NUQVRFIiwiVU5LTk9XTiIsIk5PVF9JTlNUQUxMRUQiLCJORVdFUl9WRVJTSU9OX0lOU1RBTExFRCIsIlNBTUVfVkVSU0lPTl9JTlNUQUxMRUQiLCJPTERFUl9WRVJTSU9OX0lOU1RBTExFRCIsIlJFTU9URV9DQUNIRV9ST09UIiwiaXNBcHBJbnN0YWxsZWQiLCJwa2ciLCJsb2ciLCJkZWJ1ZyIsImluc3RhbGxlZFBhdHRlcm4iLCJSZWdFeHAiLCJfIiwiZXNjYXBlUmVnRXhwIiwic3Rkb3V0Iiwic2hlbGwiLCJpc0luc3RhbGxlZCIsInRlc3QiLCJlIiwiRXJyb3IiLCJtZXNzYWdlIiwic3RhcnRVcmkiLCJ1cmkiLCJhcmdzIiwicmVwbGFjZSIsInJlcyIsInRvTG93ZXJDYXNlIiwiaW5jbHVkZXMiLCJzdGFydEFwcCIsInN0YXJ0QXBwT3B0aW9ucyIsImFjdGl2aXR5IiwiY2xvbmUiLCJkZWZhdWx0cyIsIndhaXRQa2ciLCJ3YWl0Rm9yTGF1bmNoIiwid2FpdEFjdGl2aXR5IiwicmV0cnkiLCJzdG9wQXBwIiwiYXBpTGV2ZWwiLCJnZXRBcGlMZXZlbCIsImNtZCIsInNoZWxsT3B0cyIsImlzSW50ZWdlciIsIndhaXREdXJhdGlvbiIsInRpbWVvdXQiLCJzdGFydHNXaXRoIiwid2FpdEZvckFjdGl2aXR5IiwiZHVtcFdpbmRvd3MiLCJkdW1wc3lzQXJnIiwiZ2V0Rm9jdXNlZFBhY2thZ2VBbmRBY3Rpdml0eSIsIm51bGxGb2N1c2VkQXBwUmUiLCJmb2N1c2VkQXBwUmUiLCJudWxsQ3VycmVudEZvY3VzUmUiLCJjdXJyZW50Rm9jdXNBcHBSZSIsInBhdHRlcm4iLCJtYXRjaCIsImV4ZWMiLCJhcHBQYWNrYWdlIiwidHJpbSIsImFwcEFjdGl2aXR5Iiwid2FpdEZvckFjdGl2aXR5T3JOb3QiLCJ3YWl0Rm9yU3RvcCIsIndhaXRNcyIsInNwbGl0TmFtZXMiLCJuYW1lcyIsInNwbGl0IiwibWFwIiwibmFtZSIsImFsbFBhY2thZ2VzIiwiYWxsQWN0aXZpdGllcyIsInBvc3NpYmxlQWN0aXZpdHlOYW1lcyIsIm9uZUFjdGl2aXR5IiwiY3VycmVudFBrZyIsInB1c2giLCJqb2luIiwicG9zc2libGVBY3Rpdml0eVBhdHRlcm5zIiwicG9zc2libGVBY3Rpdml0eU5hbWUiLCJyZXRyaWVzIiwicGFyc2VJbnQiLCJpc05hTiIsImZ1bGx5UXVhbGlmaWVkQWN0aXZpdHkiLCJmb3VuZEFjdCIsImZpbmRJbmRleCIsInBvc3NpYmxlUGF0dGVybiIsImFjdCIsIndhaXRGb3JOb3RBY3Rpdml0eSIsInVuaW5zdGFsbEFwayIsIm9wdGlvbnMiLCJpbmZvIiwia2VlcERhdGEiLCJmb3JjZVN0b3AiLCJhZGJFeGVjIiwiaW5zdGFsbEZyb21EZXZpY2VQYXRoIiwiYXBrUGF0aE9uRGV2aWNlIiwib3B0cyIsImluZGV4T2YiLCJjYWNoZUFwayIsImFwa1BhdGgiLCJhcHBIYXNoIiwiZnMiLCJoYXNoIiwicmVtb3RlUGF0aCIsInBhdGgiLCJwb3NpeCIsInJlbW90ZUNhY2hlZEZpbGVzIiwiZXJyb3JNYXJrZXIiLCJsc091dHB1dCIsIl9hcmVFeHRlbmRlZExzT3B0aW9uc1N1cHBvcnRlZCIsImlzQm9vbGVhbiIsImlzU3RyaW5nIiwic3Vic3RyaW5nIiwieCIsImZpbHRlciIsIkJvb2xlYW4iLCJsZW5ndGgiLCJ0b0hhc2giLCJwYXJzZSIsImZpbmQiLCJzdGFydGVkIiwicHJvY2VzcyIsImhydGltZSIsInNlY29uZHMiLCJuYW5vcyIsInNpemUiLCJzdGF0IiwiYmFzZW5hbWUiLCJ1dGlsIiwidG9SZWFkYWJsZVNpemVTdHJpbmciLCJ0b0ZpeGVkIiwicmVtb3RlQXBwc0NhY2hlIiwiTFJVIiwibWF4IiwicmVtb3RlQXBwc0NhY2hlTGltaXQiLCJkaWZmZXJlbmNlIiwia2V5cyIsImZvckVhY2giLCJkZWwiLCJzZXQiLCJlbnRyaWVzVG9DbGVhbnVwIiwiaGFzIiwic2xpY2UiLCJpc0VtcHR5Iiwid2FybiIsImluc3RhbGwiLCJhcHBQYXRoIiwiZW5kc1dpdGgiLCJBUEtTX0VYVEVOU0lPTiIsImluc3RhbGxBcGtzIiwiY2xvbmVEZWVwIiwiYWRiRXhlY1RpbWVvdXQiLCJERUZBVUxUX0FEQl9FWEVDX1RJTUVPVVQiLCJBUEtfSU5TVEFMTF9USU1FT1VUIiwidGltZW91dENhcE5hbWUiLCJpbnN0YWxsQXJncyIsImluc3RhbGxPcHRzIiwicGVyZm9ybUFwcEluc3RhbGwiLCJjYWNoZWRSZW1vdGVQYXRoIiwib3V0cHV0IiwidHJ1bmNhdGVkT3V0cHV0Iiwic3Vic3RyIiwiaXNUZXN0UGFja2FnZU9ubHlFcnJvciIsIm1zZyIsImVyciIsImdldEFwcGxpY2F0aW9uSW5zdGFsbFN0YXRlIiwiYXBrSW5mbyIsImdldEFwa0luZm8iLCJ2ZXJzaW9uQ29kZSIsInBrZ1ZlcnNpb25Db2RlIiwidmVyc2lvbk5hbWUiLCJwa2dWZXJzaW9uTmFtZVN0ciIsImdldFBhY2thZ2VJbmZvIiwicGtnVmVyc2lvbk5hbWUiLCJzZW12ZXIiLCJ2YWxpZCIsImNvZXJjZSIsImFwa1ZlcnNpb25Db2RlIiwiYXBrVmVyc2lvbk5hbWVTdHIiLCJhcGtWZXJzaW9uTmFtZSIsInNhdGlzZmllcyIsImluc3RhbGxPclVwZ3JhZGUiLCJhcHBTdGF0ZSIsIk9iamVjdCIsImFzc2lnbiIsImV4dHJhY3RTdHJpbmdzRnJvbUFwayIsImxhbmd1YWdlIiwib3V0IiwiZXh0cmFjdExhbmd1YWdlQXBrIiwiaW5pdEFhcHQiLCJyYXdBYXB0T3V0cHV0IiwiYmluYXJpZXMiLCJhYXB0IiwiZGVmYXVsdENvbmZpZ01hcmtlciIsImNvbmZpZ01hcmtlciIsImNvbmZpZ3MiLCJvcyIsIkVPTCIsImFwa1N0cmluZ3MiLCJpc0luQ29uZmlnIiwiY3VycmVudFJlc291cmNlSWQiLCJpc0luUGx1cmFsR3JvdXAiLCJzdGFydHNXaXRoQW55IiwicyIsImFyciIsInJlZHVjZSIsImFjYyIsIm5vcm1hbGl6ZVN0cmluZ01hdGNoIiwibGluZSIsInRyaW1tZWRMaW5lIiwibG9jYWxQYXRoIiwicmVzb2x2ZSIsIndyaXRlRmlsZSIsIkpTT04iLCJzdHJpbmdpZnkiLCJnZXREZXZpY2VMYW5ndWFnZSIsImdldERldmljZVN5c0xhbmd1YWdlIiwiZ2V0RGV2aWNlUHJvZHVjdExhbmd1YWdlIiwiZ2V0RGV2aWNlTG9jYWxlIiwiZ2V0RGV2aWNlQ291bnRyeSIsImNvdW50cnkiLCJnZXREZXZpY2VTeXNDb3VudHJ5IiwiZ2V0RGV2aWNlUHJvZHVjdENvdW50cnkiLCJsb2NhbGUiLCJnZXREZXZpY2VTeXNMb2NhbGUiLCJnZXREZXZpY2VQcm9kdWN0TG9jYWxlIiwic2V0RGV2aWNlTG9jYWxlIiwidmFsaWRhdGVMb2NhbGUiLCJzcGxpdF9sb2NhbGUiLCJzZXREZXZpY2VMYW5ndWFnZUNvdW50cnkiLCJlbnN1cmVDdXJyZW50TG9jYWxlIiwic2NyaXB0IiwiaGFzTGFuZ3VhZ2UiLCJoYXNDb3VudHJ5IiwiY3VyTGFuZ3VhZ2UiLCJjdXJDb3VudHJ5IiwiY3VyTG9jYWxlIiwibG9jYWxlQ29kZSIsImVycm9yIiwicmVzdGFydEFkYiIsInRvVXBwZXJDYXNlIiwic2V0RGV2aWNlU3lzTG9jYWxlVmlhU2V0dGluZ0FwcCIsImV4aXN0cyIsImV4dHJhY3RCYXNlQXBrIiwibWF0Y2hlcyIsInJlc3VsdCIsInZlcnNpb25OYW1lTWF0Y2giLCJ2ZXJzaW9uQ29kZU1hdGNoIiwicHVsbEFwayIsInRtcERpciIsInBrZ1BhdGgiLCJ0bXBBcHAiLCJwdWxsIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBOztBQUdBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBLElBQUlBLGVBQWUsR0FBRyxFQUF0QjtBQUVBLE1BQU1DLCtCQUErQixHQUNuQyx5R0FERjtBQUVBRCxlQUFlLENBQUNFLGlCQUFoQixHQUFvQztBQUNsQ0MsRUFB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QztBQUNEOztBQUNELFVBQU1DLGdCQUFnQixHQUFHLElBQUkxTyxNQUFKLENBQVcsbUJBQVgsRUFBZ0M2QyxJQUFoQyxDQUFxQzFDLE1BQXJDLENBQXpCOztBQUNBLFFBQUl1TyxnQkFBSixFQUFzQjtBQUNwQkYsTUFBQUEsTUFBTSxDQUFDN0UsV0FBUCxHQUFxQnhGLFFBQVEsQ0FBQ3VLLGdCQUFnQixDQUFDLENBQUQsQ0FBakIsRUFBc0IsRUFBdEIsQ0FBN0I7QUFDRDs7QUFDRCxXQUFPRixNQUFQO0FBQ0QsR0FYRCxDQVdFLE9BQU9qRixHQUFQLEVBQVk7QUFDWjFKLG9CQUFJc0ksSUFBSixDQUFVLFVBQVNvQixHQUFHLENBQUM5SSxPQUFRLDhCQUEvQjtBQUNEOztBQUNELFNBQU8rTixNQUFQO0FBQ0QsQ0FsQkQ7O0FBb0JBdFAsZUFBZSxDQUFDeVAsT0FBaEIsR0FBMEIsZUFBZUEsT0FBZixDQUF3Qi9PLEdBQXhCLEVBQTZCZ1AsTUFBN0IsRUFBcUM7QUFDN0QsUUFBTUMsT0FBTyxHQUFHLENBQUMsTUFBTSxLQUFLN0osT0FBTCxDQUFhLENBQUMsT0FBRCxFQUFVLElBQVYsRUFBZ0IsTUFBaEIsRUFBd0JwRixHQUF4QixDQUFiLENBQVAsRUFBbURpQixPQUFuRCxDQUEyRCxVQUEzRCxFQUF1RSxFQUF2RSxDQUFoQjs7QUFDQSxRQUFNaU8sTUFBTSxHQUFHbkosY0FBSzJHLE9BQUwsQ0FBYXNDLE1BQWIsRUFBc0IsR0FBRWhQLEdBQUksTUFBNUIsQ0FBZjs7QUFDQSxRQUFNLEtBQUttUCxJQUFMLENBQVVGLE9BQVYsRUFBbUJDLE1BQW5CLENBQU47O0FBQ0FqUCxrQkFBSUMsS0FBSixDQUFXLDJCQUEwQkYsR0FBSSxTQUFRa1AsTUFBTyxHQUF4RDs7QUFDQSxTQUFPQSxNQUFQO0FBQ0QsQ0FORDs7ZUFTZTVQLGUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBidWlsZFN0YXJ0Q21kLCBBUEtTX0VYVEVOU0lPTiwgYnVpbGRJbnN0YWxsQXJncyxcbiAgQVBLX0lOU1RBTExfVElNRU9VVCwgREVGQVVMVF9BREJfRVhFQ19USU1FT1VUIH0gZnJvbSAnLi4vaGVscGVycy5qcyc7XG5pbXBvcnQgeyBleGVjIH0gZnJvbSAndGVlbl9wcm9jZXNzJztcbmltcG9ydCBsb2cgZnJvbSAnLi4vbG9nZ2VyLmpzJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7IHJldHJ5SW50ZXJ2YWwgfSBmcm9tICdhc3luY2JveCc7XG5pbXBvcnQgeyBmcywgdXRpbCwgbWtkaXJwIH0gZnJvbSAnYXBwaXVtLXN1cHBvcnQnO1xuaW1wb3J0IHNlbXZlciBmcm9tICdzZW12ZXInO1xuaW1wb3J0IG9zIGZyb20gJ29zJztcbmltcG9ydCBMUlUgZnJvbSAnbHJ1LWNhY2hlJztcblxubGV0IGFwa1V0aWxzTWV0aG9kcyA9IHt9O1xuXG5jb25zdCBBQ1RJVklUSUVTX1RST1VCTEVTSE9PVElOR19MSU5LID1cbiAgJ2h0dHBzOi8vZ2l0aHViLmNvbS9hcHBpdW0vYXBwaXVtL2Jsb2IvbWFzdGVyL2RvY3MvZW4vd3JpdGluZy1ydW5uaW5nLWFwcGl1bS9hbmRyb2lkL2FjdGl2aXR5LXN0YXJ0dXAubWQnO1xuYXBrVXRpbHNNZXRob2RzLkFQUF9JTlNUQUxMX1NUQVRFID0ge1xuICBVTktOT1dOOiAndW5rbm93bicsXG4gIE5PVF9JTlNUQUxMRUQ6ICdub3RJbnN0YWxsZWQnLFxuICBORVdFUl9WRVJTSU9OX0lOU1RBTExFRDogJ25ld2VyVmVyc2lvbkluc3RhbGxlZCcsXG4gIFNBTUVfVkVSU0lPTl9JTlNUQUxMRUQ6ICdzYW1lVmVyc2lvbkluc3RhbGxlZCcsXG4gIE9MREVSX1ZFUlNJT05fSU5TVEFMTEVEOiAnb2xkZXJWZXJzaW9uSW5zdGFsbGVkJyxcbn07XG5jb25zdCBSRU1PVEVfQ0FDSEVfUk9PVCA9ICcvZGF0YS9sb2NhbC90bXAvYXBwaXVtX2NhY2hlJztcblxuXG4vKipcbiAqIENoZWNrIHdoZXRoZXIgdGhlIHBhcnRpY3VsYXIgcGFja2FnZSBpcyBwcmVzZW50IG9uIHRoZSBkZXZpY2UgdW5kZXIgdGVzdC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gcGtnIC0gVGhlIG5hbWUgb2YgdGhlIHBhY2thZ2UgdG8gY2hlY2suXG4gKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIHRoZSBwYWNrYWdlIGlzIGluc3RhbGxlZC5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGVyZSB3YXMgYW4gZXJyb3Igd2hpbGUgZGV0ZWN0aW5nIGFwcGxpY2F0aW9uIHN0YXRlXG4gKi9cbmFwa1V0aWxzTWV0aG9kcy5pc0FwcEluc3RhbGxlZCA9IGFzeW5jIGZ1bmN0aW9uIGlzQXBwSW5zdGFsbGVkIChwa2cpIHtcbiAgbG9nLmRlYnVnKGBHZXR0aW5nIGluc3RhbGwgc3RhdHVzIGZvciAke3BrZ31gKTtcbiAgY29uc3QgaW5zdGFsbGVkUGF0dGVybiA9IG5ldyBSZWdFeHAoYF5cXFxccypQYWNrYWdlXFxcXHMrXFxcXFske18uZXNjYXBlUmVnRXhwKHBrZyl9XFxcXF1bXjpdKzokYCwgJ20nKTtcbiAgdHJ5IHtcbiAgICBjb25zdCBzdGRvdXQgPSBhd2FpdCB0aGlzLnNoZWxsKFsnZHVtcHN5cycsICdwYWNrYWdlJywgcGtnXSk7XG4gICAgY29uc3QgaXNJbnN0YWxsZWQgPSBpbnN0YWxsZWRQYXR0ZXJuLnRlc3Qoc3Rkb3V0KTtcbiAgICBsb2cuZGVidWcoYCcke3BrZ30nIGlzJHshaXNJbnN0YWxsZWQgPyAnIG5vdCcgOiAnJ30gaW5zdGFsbGVkYCk7XG4gICAgcmV0dXJuIGlzSW5zdGFsbGVkO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBFcnJvciBmaW5kaW5nIGlmICcke3BrZ30nIGlzIGluc3RhbGxlZC4gT3JpZ2luYWwgZXJyb3I6ICR7ZS5tZXNzYWdlfWApO1xuICB9XG59O1xuXG4vKipcbiAqIFN0YXJ0IHRoZSBwYXJ0aWN1bGFyIFVSSSBvbiB0aGUgZGV2aWNlIHVuZGVyIHRlc3QuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHVyaSAtIFRoZSBuYW1lIG9mIFVSSSB0byBzdGFydC5cbiAqIEBwYXJhbSB7c3RyaW5nfSBwa2cgLSBUaGUgbmFtZSBvZiB0aGUgcGFja2FnZSB0byBzdGFydCB0aGUgVVJJIHdpdGguXG4gKi9cbmFwa1V0aWxzTWV0aG9kcy5zdGFydFVyaSA9IGFzeW5jIGZ1bmN0aW9uIHN0YXJ0VXJpICh1cmksIHBrZykge1xuICBpZiAoIXVyaSB8fCAhcGtnKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdVUkkgYW5kIHBhY2thZ2UgYXJndW1lbnRzIGFyZSByZXF1aXJlZCcpO1xuICB9XG5cbiAgY29uc3QgYXJncyA9IFtcbiAgICAnYW0nLCAnc3RhcnQnLFxuICAgICctVycsXG4gICAgJy1hJywgJ2FuZHJvaWQuaW50ZW50LmFjdGlvbi5WSUVXJyxcbiAgICAnLWQnLCB1cmkucmVwbGFjZSgvJi9nLCAnXFxcXCYnKSxcbiAgICBwa2csXG4gIF07XG4gIHRyeSB7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5zaGVsbChhcmdzKTtcbiAgICBpZiAocmVzLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ3VuYWJsZSB0byByZXNvbHZlIGludGVudCcpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IocmVzKTtcbiAgICB9XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEVycm9yIGF0dGVtcHRpbmcgdG8gc3RhcnQgVVJJLiBPcmlnaW5hbCBlcnJvcjogJHtlfWApO1xuICB9XG59O1xuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IFN0YXJ0QXBwT3B0aW9uc1xuICogQHByb3BlcnR5IHshc3RyaW5nfSBhY3Rpdml0eSAtIFRoZSBuYW1lIG9mIHRoZSBtYWluIGFwcGxpY2F0aW9uIGFjdGl2aXR5XG4gKiBAcHJvcGVydHkgeyFzdHJpbmd9IHBrZyAtIFRoZSBuYW1lIG9mIHRoZSBhcHBsaWNhdGlvbiBwYWNrYWdlXG4gKiBAcHJvcGVydHkgez9ib29sZWFufSByZXRyeSBbdHJ1ZV0gLSBJZiB0aGlzIHByb3BlcnR5IGlzIHNldCB0byBgdHJ1ZWBcbiAqIGFuZCB0aGUgYWN0aXZpdHkgbmFtZSBkb2VzIG5vdCBzdGFydCB3aXRoICcuJyB0aGVuIHRoZSBtZXRob2RcbiAqIHdpbGwgdHJ5IHRvIGFkZCB0aGUgbWlzc2luZyBkb3QgYW5kIHN0YXJ0IHRoZSBhY3Rpdml0eSBvbmNlIG1vcmVcbiAqIGlmIHRoZSBmaXJzdCBzdGFydHVwIHRyeSBmYWlscy5cbiAqIEBwcm9wZXJ0eSB7P2Jvb2xlYW59IHN0b3BBcHAgW3RydWVdIC0gU2V0IGl0IHRvIGB0cnVlYCBpbiBvcmRlciB0byBmb3JjZWZ1bGx5XG4gKiBzdG9wIHRoZSBhY3Rpdml0eSBpZiBpdCBpcyBhbHJlYWR5IHJ1bm5pbmcuXG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IHdhaXRQa2cgLSBUaGUgbmFtZSBvZiB0aGUgcGFja2FnZSB0byB3YWl0IHRvIG9uXG4gKiBzdGFydHVwICh0aGlzIG9ubHkgbWFrZXMgc2Vuc2UgaWYgdGhpcyBuYW1lIGlzIGRpZmZlcmVudCBmcm9tIHRoZSBvbmUsIHdoaWNoIGlzIHNldCBhcyBgcGtnYClcbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gd2FpdEFjdGl2aXR5IC0gVGhlIG5hbWUgb2YgdGhlIGFjdGl2aXR5IHRvIHdhaXQgdG8gb25cbiAqIHN0YXJ0dXAgKHRoaXMgb25seSBtYWtlcyBzZW5zZSBpZiB0aGlzIG5hbWUgaXMgZGlmZmVyZW50IGZyb20gdGhlIG9uZSwgd2hpY2ggaXMgc2V0IGFzIGBhY3Rpdml0eWApXG4gKiBAcHJvcGVydHkgez9udW1iZXJ9IHdhaXREdXJhdGlvbiAtIFRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRvIHdhaXQgdW50aWwgdGhlXG4gKiBgd2FpdEFjdGl2aXR5YCBpcyBmb2N1c2VkXG4gKiBAcHJvcGVydHkgez9zdHJpbmd8bnVtYmVyfSB1c2VyIC0gVGhlIG51bWJlciBvZiB0aGUgdXNlciBwcm9maWxlIHRvIHN0YXJ0XG4gKiB0aGUgZ2l2ZW4gYWN0aXZpdHkgd2l0aC4gVGhlIGRlZmF1bHQgT1MgdXNlciBwcm9maWxlICh1c3VhbGx5IHplcm8pIGlzIHVzZWRcbiAqIHdoZW4gdGhpcyBwcm9wZXJ0eSBpcyB1bnNldFxuICogQHByb3BlcnR5IHs/Ym9vbGVhbn0gd2FpdEZvckxhdW5jaCBbdHJ1ZV0gLSBpZiBgZmFsc2VgIHRoZW4gYWRiIHdvbid0IHdhaXRcbiAqIGZvciB0aGUgc3RhcnRlZCBhY3Rpdml0eSB0byByZXR1cm4gdGhlIGNvbnRyb2xcbiAqL1xuXG4vKipcbiAqIFN0YXJ0IHRoZSBwYXJ0aWN1bGFyIHBhY2thZ2UvYWN0aXZpdHkgb24gdGhlIGRldmljZSB1bmRlciB0ZXN0LlxuICpcbiAqIEBwYXJhbSB7U3RhcnRBcHBPcHRpb25zfSBzdGFydEFwcE9wdGlvbnMgW3t9XSAtIFN0YXJ0dXAgb3B0aW9ucyBtYXBwaW5nLlxuICogQHJldHVybiB7c3RyaW5nfSBUaGUgb3V0cHV0IG9mIHRoZSBjb3JyZXNwb25kaW5nIGFkYiBjb21tYW5kLlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZXJlIGlzIGFuIGVycm9yIHdoaWxlIGV4ZWN1dGluZyB0aGUgYWN0aXZpdHlcbiAqL1xuYXBrVXRpbHNNZXRob2RzLnN0YXJ0QXBwID0gYXN5bmMgZnVuY3Rpb24gc3RhcnRBcHAgKHN0YXJ0QXBwT3B0aW9ucyA9IHt9KSB7XG4gIGlmICghc3RhcnRBcHBPcHRpb25zLmFjdGl2aXR5IHx8ICFzdGFydEFwcE9wdGlvbnMucGtnKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdhY3Rpdml0eSBhbmQgcGtnIGFyZSByZXF1aXJlZCB0byBzdGFydCBhbiBhcHBsaWNhdGlvbicpO1xuICB9XG5cbiAgc3RhcnRBcHBPcHRpb25zID0gXy5jbG9uZShzdGFydEFwcE9wdGlvbnMpO1xuICBzdGFydEFwcE9wdGlvbnMuYWN0aXZpdHkgPSBzdGFydEFwcE9wdGlvbnMuYWN0aXZpdHkucmVwbGFjZSgnJCcsICdcXFxcJCcpO1xuICAvLyBpbml0aWFsaXppbmcgZGVmYXVsdHNcbiAgXy5kZWZhdWx0cyhzdGFydEFwcE9wdGlvbnMsIHtcbiAgICB3YWl0UGtnOiBzdGFydEFwcE9wdGlvbnMucGtnLFxuICAgIHdhaXRGb3JMYXVuY2g6IHRydWUsXG4gICAgd2FpdEFjdGl2aXR5OiBmYWxzZSxcbiAgICByZXRyeTogdHJ1ZSxcbiAgICBzdG9wQXBwOiB0cnVlXG4gIH0pO1xuICAvLyBwcmV2ZW50aW5nIG51bGwgd2FpdHBrZ1xuICBzdGFydEFwcE9wdGlvbnMud2FpdFBrZyA9IHN0YXJ0QXBwT3B0aW9ucy53YWl0UGtnIHx8IHN0YXJ0QXBwT3B0aW9ucy5wa2c7XG5cbiAgY29uc3QgYXBpTGV2ZWwgPSBhd2FpdCB0aGlzLmdldEFwaUxldmVsKCk7XG4gIGNvbnN0IGNtZCA9IGJ1aWxkU3RhcnRDbWQoc3RhcnRBcHBPcHRpb25zLCBhcGlMZXZlbCk7XG4gIHRyeSB7XG4gICAgY29uc3Qgc2hlbGxPcHRzID0ge307XG4gICAgaWYgKF8uaXNJbnRlZ2VyKHN0YXJ0QXBwT3B0aW9ucy53YWl0RHVyYXRpb24pICYmIHN0YXJ0QXBwT3B0aW9ucy53YWl0RHVyYXRpb24gPiAyMDAwMCkge1xuICAgICAgc2hlbGxPcHRzLnRpbWVvdXQgPSBzdGFydEFwcE9wdGlvbnMud2FpdER1cmF0aW9uO1xuICAgIH1cbiAgICBjb25zdCBzdGRvdXQgPSBhd2FpdCB0aGlzLnNoZWxsKGNtZCwgc2hlbGxPcHRzKTtcbiAgICBpZiAoc3Rkb3V0LmluY2x1ZGVzKCdFcnJvcjogQWN0aXZpdHkgY2xhc3MnKSAmJiBzdGRvdXQuaW5jbHVkZXMoJ2RvZXMgbm90IGV4aXN0JykpIHtcbiAgICAgIGlmIChzdGFydEFwcE9wdGlvbnMucmV0cnkgJiYgIXN0YXJ0QXBwT3B0aW9ucy5hY3Rpdml0eS5zdGFydHNXaXRoKCcuJykpIHtcbiAgICAgICAgbG9nLmRlYnVnKGBXZSB0cmllZCB0byBzdGFydCBhbiBhY3Rpdml0eSB0aGF0IGRvZXNuJ3QgZXhpc3QsIGAgK1xuICAgICAgICAgICAgICAgICAgYHJldHJ5aW5nIHdpdGggJy4ke3N0YXJ0QXBwT3B0aW9ucy5hY3Rpdml0eX0nIGFjdGl2aXR5IG5hbWVgKTtcbiAgICAgICAgc3RhcnRBcHBPcHRpb25zLmFjdGl2aXR5ID0gYC4ke3N0YXJ0QXBwT3B0aW9ucy5hY3Rpdml0eX1gO1xuICAgICAgICBzdGFydEFwcE9wdGlvbnMucmV0cnkgPSBmYWxzZTtcbiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuc3RhcnRBcHAoc3RhcnRBcHBPcHRpb25zKTtcbiAgICAgIH1cbiAgICAgIHRocm93IG5ldyBFcnJvcihgQWN0aXZpdHkgbmFtZSAnJHtzdGFydEFwcE9wdGlvbnMuYWN0aXZpdHl9JyB1c2VkIHRvIHN0YXJ0IHRoZSBhcHAgZG9lc24ndCBgICtcbiAgICAgICAgICAgICAgICAgICAgICBgZXhpc3Qgb3IgY2Fubm90IGJlIGxhdW5jaGVkISBNYWtlIHN1cmUgaXQgZXhpc3RzIGFuZCBpcyBhIGxhdW5jaGFibGUgYWN0aXZpdHlgKTtcbiAgICB9IGVsc2UgaWYgKHN0ZG91dC5pbmNsdWRlcygnamF2YS5sYW5nLlNlY3VyaXR5RXhjZXB0aW9uJykpIHtcbiAgICAgIC8vIGlmIHRoZSBhcHAgaXMgZGlzYWJsZWQgb24gYSByZWFsIGRldmljZSBpdCB3aWxsIHRocm93IGEgc2VjdXJpdHkgZXhjZXB0aW9uXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZSBwZXJtaXNzaW9uIHRvIHN0YXJ0ICcke3N0YXJ0QXBwT3B0aW9ucy5hY3Rpdml0eX0nIGFjdGl2aXR5IGhhcyBiZWVuIGRlbmllZC5gICtcbiAgICAgICAgICAgICAgICAgICAgICBgTWFrZSBzdXJlIHRoZSBhY3Rpdml0eS9wYWNrYWdlIG5hbWVzIGFyZSBjb3JyZWN0LmApO1xuICAgIH1cbiAgICBpZiAoc3RhcnRBcHBPcHRpb25zLndhaXRBY3Rpdml0eSkge1xuICAgICAgYXdhaXQgdGhpcy53YWl0Rm9yQWN0aXZpdHkoc3RhcnRBcHBPcHRpb25zLndhaXRQa2csIHN0YXJ0QXBwT3B0aW9ucy53YWl0QWN0aXZpdHksIHN0YXJ0QXBwT3B0aW9ucy53YWl0RHVyYXRpb24pO1xuICAgIH1cbiAgICByZXR1cm4gc3Rkb3V0O1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3Qgc3RhcnQgdGhlICcke3N0YXJ0QXBwT3B0aW9ucy5wa2d9JyBhcHBsaWNhdGlvbi4gYCArXG4gICAgICBgVmlzaXQgJHtBQ1RJVklUSUVTX1RST1VCTEVTSE9PVElOR19MSU5LfSBmb3IgdHJvdWJsZXNob290aW5nLiBgICtcbiAgICAgIGBPcmlnaW5hbCBlcnJvcjogJHtlLm1lc3NhZ2V9YCk7XG4gIH1cbn07XG5cbi8qKlxuICogSGVscGVyIG1ldGhvZCB0byBjYWxsIGBhZGIgZHVtcHN5cyB3aW5kb3cgd2luZG93cy9kaXNwbGF5c2BcbiAqL1xuYXBrVXRpbHNNZXRob2RzLmR1bXBXaW5kb3dzID0gYXN5bmMgZnVuY3Rpb24gZHVtcFdpbmRvd3MgKCkge1xuICBjb25zdCBhcGlMZXZlbCA9IGF3YWl0IHRoaXMuZ2V0QXBpTGV2ZWwoKTtcblxuICAvLyBXaXRoIHZlcnNpb24gMjksIEFuZHJvaWQgY2hhbmdlZCB0aGUgZHVtcHN5cyBzeW50YXhcbiAgY29uc3QgZHVtcHN5c0FyZyA9IGFwaUxldmVsID49IDI5ID8gJ2Rpc3BsYXlzJyA6ICd3aW5kb3dzJztcbiAgY29uc3QgY21kID0gWydkdW1wc3lzJywgJ3dpbmRvdycsIGR1bXBzeXNBcmddO1xuXG4gIHJldHVybiBhd2FpdCB0aGlzLnNoZWxsKGNtZCk7XG59O1xuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IFBhY2thZ2VBY3Rpdml0eUluZm9cbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gYXBwUGFja2FnZSAtIFRoZSBuYW1lIG9mIGFwcGxpY2F0aW9uIHBhY2thZ2UsXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgZXhhbXBsZSAnY29tLmFjbWUuYXBwJy5cbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gYXBwQWN0aXZpdHkgLSBUaGUgbmFtZSBvZiBtYWluIGFwcGxpY2F0aW9uIGFjdGl2aXR5LlxuICovXG5cbi8qKlxuICogR2V0IHRoZSBuYW1lIG9mIGN1cnJlbnRseSBmb2N1c2VkIHBhY2thZ2UgYW5kIGFjdGl2aXR5LlxuICpcbiAqIEByZXR1cm4ge1BhY2thZ2VBY3Rpdml0eUluZm99IFRoZSBtYXBwaW5nLCB3aGVyZSBwcm9wZXJ0eSBuYW1lcyBhcmUgJ2FwcFBhY2thZ2UnIGFuZCAnYXBwQWN0aXZpdHknLlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZXJlIGlzIGFuIGVycm9yIHdoaWxlIHBhcnNpbmcgdGhlIGRhdGEuXG4gKi9cbmFwa1V0aWxzTWV0aG9kcy5nZXRGb2N1c2VkUGFja2FnZUFuZEFjdGl2aXR5ID0gYXN5bmMgZnVuY3Rpb24gZ2V0Rm9jdXNlZFBhY2thZ2VBbmRBY3Rpdml0eSAoKSB7XG4gIGxvZy5kZWJ1ZygnR2V0dGluZyBmb2N1c2VkIHBhY2thZ2UgYW5kIGFjdGl2aXR5Jyk7XG4gIGNvbnN0IG51bGxGb2N1c2VkQXBwUmUgPSBuZXcgUmVnRXhwKC9eXFxzKm1Gb2N1c2VkQXBwPW51bGwvLCAnbScpO1xuICAvLyBodHRwczovL3JlZ2V4MTAxLmNvbS9yL3haOHZGNy8xXG4gIGNvbnN0IGZvY3VzZWRBcHBSZSA9IG5ldyBSZWdFeHAoJ15cXFxccyptRm9jdXNlZEFwcC4rUmVjb3JkXFxcXHsuKlxcXFxzKFteXFxcXHNcXFxcL1xcXFx9XSspJyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1xcXFwvKFteXFxcXHNcXFxcL1xcXFx9XFxcXCxdKylcXFxcLD8oXFxcXHNbXlxcXFxzXFxcXC9cXFxcfV0rKSpcXFxcfScsICdtJyk7XG4gIGNvbnN0IG51bGxDdXJyZW50Rm9jdXNSZSA9IG5ldyBSZWdFeHAoL15cXHMqbUN1cnJlbnRGb2N1cz1udWxsLywgJ20nKTtcbiAgY29uc3QgY3VycmVudEZvY3VzQXBwUmUgPSBuZXcgUmVnRXhwKCdeXFxcXHMqbUN1cnJlbnRGb2N1cy4rXFxcXHsuK1xcXFxzKFteXFxcXHNcXFxcL10rKVxcXFwvKFteXFxcXHNdKylcXFxcYicsICdtJyk7XG5cbiAgdHJ5IHtcbiAgICBjb25zdCBzdGRvdXQgPSBhd2FpdCB0aGlzLmR1bXBXaW5kb3dzKCk7XG4gICAgLy8gVGhlIG9yZGVyIG1hdHRlcnMgaGVyZVxuICAgIGZvciAoY29uc3QgcGF0dGVybiBvZiBbZm9jdXNlZEFwcFJlLCBjdXJyZW50Rm9jdXNBcHBSZV0pIHtcbiAgICAgIGNvbnN0IG1hdGNoID0gcGF0dGVybi5leGVjKHN0ZG91dCk7XG4gICAgICBpZiAobWF0Y2gpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBhcHBQYWNrYWdlOiBtYXRjaFsxXS50cmltKCksXG4gICAgICAgICAgYXBwQWN0aXZpdHk6IG1hdGNoWzJdLnRyaW0oKVxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH1cblxuICAgIGZvciAoY29uc3QgcGF0dGVybiBvZiBbbnVsbEZvY3VzZWRBcHBSZSwgbnVsbEN1cnJlbnRGb2N1c1JlXSkge1xuICAgICAgaWYgKHBhdHRlcm4uZXhlYyhzdGRvdXQpKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgYXBwUGFja2FnZTogbnVsbCxcbiAgICAgICAgICBhcHBBY3Rpdml0eTogbnVsbFxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH1cblxuICAgIHRocm93IG5ldyBFcnJvcignQ291bGQgbm90IHBhcnNlIGFjdGl2aXR5IGZyb20gZHVtcHN5cycpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBDb3VsZCBub3QgZ2V0IGZvY3VzUGFja2FnZUFuZEFjdGl2aXR5LiBPcmlnaW5hbCBlcnJvcjogJHtlLm1lc3NhZ2V9YCk7XG4gIH1cbn07XG5cbi8qKlxuICogV2FpdCBmb3IgdGhlIGdpdmVuIGFjdGl2aXR5IHRvIGJlIGZvY3VzZWQvbm9uLWZvY3VzZWQuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHBrZyAtIFRoZSBuYW1lIG9mIHRoZSBwYWNrYWdlIHRvIHdhaXQgZm9yLlxuICogQHBhcmFtIHtzdHJpbmd9IGFjdGl2aXR5IC0gVGhlIG5hbWUgb2YgdGhlIGFjdGl2aXR5LCBiZWxvbmdpbmcgdG8gdGhhdCBwYWNrYWdlLFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG8gd2FpdCBmb3IuXG4gKiBAcGFyYW0ge2Jvb2xlYW59IHdhaXRGb3JTdG9wIC0gV2hldGhlciB0byB3YWl0IHVudGlsIHRoZSBhY3Rpdml0eSBpcyBmb2N1c2VkICh0cnVlKVxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yIGlzIG5vdCBmb2N1c2VkIChmYWxzZSkuXG4gKiBAcGFyYW0ge251bWJlcn0gd2FpdE1zIFsyMDAwMF0gLSBOdW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRvIHdhaXQgYmVmb3JlIHRpbWVvdXQgb2NjdXJzLlxuICogQHRocm93cyB7ZXJyb3J9IElmIHRpbWVvdXQgaGFwcGVucy5cbiAqL1xuYXBrVXRpbHNNZXRob2RzLndhaXRGb3JBY3Rpdml0eU9yTm90ID0gYXN5bmMgZnVuY3Rpb24gd2FpdEZvckFjdGl2aXR5T3JOb3QgKHBrZywgYWN0aXZpdHksIHdhaXRGb3JTdG9wLCB3YWl0TXMgPSAyMDAwMCkge1xuICBpZiAoIXBrZyB8fCAhYWN0aXZpdHkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ1BhY2thZ2UgYW5kIGFjdGl2aXR5IHJlcXVpcmVkLicpO1xuICB9XG4gIGxvZy5kZWJ1ZyhgV2FpdGluZyB1cCB0byAke3dhaXRNc31tcyBmb3IgYWN0aXZpdHkgbWF0Y2hpbmcgcGtnOiAnJHtwa2d9JyBhbmQgYCArXG4gICAgICAgICAgICBgYWN0aXZpdHk6ICcke2FjdGl2aXR5fScgdG8ke3dhaXRGb3JTdG9wID8gJyBub3QnIDogJyd9IGJlIGZvY3VzZWRgKTtcblxuICBjb25zdCBzcGxpdE5hbWVzID0gKG5hbWVzKSA9PiBuYW1lcy5zcGxpdCgnLCcpLm1hcCgobmFtZSkgPT4gbmFtZS50cmltKCkpO1xuXG4gIGNvbnN0IGFsbFBhY2thZ2VzID0gc3BsaXROYW1lcyhwa2cpO1xuICBjb25zdCBhbGxBY3Rpdml0aWVzID0gc3BsaXROYW1lcyhhY3Rpdml0eSk7XG5cbiAgbGV0IHBvc3NpYmxlQWN0aXZpdHlOYW1lcyA9IFtdO1xuICBmb3IgKGxldCBvbmVBY3Rpdml0eSBvZiBhbGxBY3Rpdml0aWVzKSB7XG4gICAgaWYgKG9uZUFjdGl2aXR5LnN0YXJ0c1dpdGgoJy4nKSkge1xuICAgICAgLy8gYWRkIHRoZSBwYWNrYWdlIG5hbWUgaWYgYWN0aXZpdHkgaXMgbm90IGZ1bGwgcXVhbGlmaWVkXG4gICAgICBmb3IgKGxldCBjdXJyZW50UGtnIG9mIGFsbFBhY2thZ2VzKSB7XG4gICAgICAgIHBvc3NpYmxlQWN0aXZpdHlOYW1lcy5wdXNoKGAke2N1cnJlbnRQa2d9JHtvbmVBY3Rpdml0eX1gLnJlcGxhY2UoL1xcLisvZywgJy4nKSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIGFjY2VwdCBmdWxseSBxdWFsaWZpZWQgYWN0aXZpdHkgbmFtZS5cbiAgICAgIHBvc3NpYmxlQWN0aXZpdHlOYW1lcy5wdXNoKG9uZUFjdGl2aXR5KTtcbiAgICAgIHBvc3NpYmxlQWN0aXZpdHlOYW1lcy5wdXNoKGAke3BrZ30uJHtvbmVBY3Rpdml0eX1gKTtcbiAgICB9XG4gIH1cbiAgbG9nLmRlYnVnKGBQb3NzaWJsZSBhY3Rpdml0aWVzLCB0byBiZSBjaGVja2VkOiAke3Bvc3NpYmxlQWN0aXZpdHlOYW1lcy5tYXAoKG5hbWUpID0+IGAnJHtuYW1lfSdgKS5qb2luKCcsICcpfWApO1xuXG4gIGxldCBwb3NzaWJsZUFjdGl2aXR5UGF0dGVybnMgPSBwb3NzaWJsZUFjdGl2aXR5TmFtZXMubWFwKChwb3NzaWJsZUFjdGl2aXR5TmFtZSkgPT5cbiAgICBuZXcgUmVnRXhwKGBeJHtwb3NzaWJsZUFjdGl2aXR5TmFtZS5yZXBsYWNlKC9cXC4vZywgJ1xcXFwuJykucmVwbGFjZSgvXFwqL2csICcuKj8nKS5yZXBsYWNlKC9cXCQvZywgJ1xcXFwkJyl9JGApXG4gICk7XG5cbiAgLy8gZmlndXJlIG91dCB0aGUgbnVtYmVyIG9mIHJldHJpZXMuIFRyeSBvbmNlIGlmIHdhaXRNcyBpcyBsZXNzIHRoYXQgNzUwXG4gIC8vIDMwIHRpbWVzIGlmIHBhcnNpbmcgaXMgbm90IHBvc3NpYmxlXG4gIGxldCByZXRyaWVzID0gcGFyc2VJbnQod2FpdE1zIC8gNzUwLCAxMCkgfHwgMTtcbiAgcmV0cmllcyA9IGlzTmFOKHJldHJpZXMpID8gMzAgOiByZXRyaWVzO1xuICBhd2FpdCByZXRyeUludGVydmFsKHJldHJpZXMsIDc1MCwgYXN5bmMgKCkgPT4ge1xuICAgIGxldCB7YXBwUGFja2FnZSwgYXBwQWN0aXZpdHl9ID0gYXdhaXQgdGhpcy5nZXRGb2N1c2VkUGFja2FnZUFuZEFjdGl2aXR5KCk7XG4gICAgaWYgKGFwcEFjdGl2aXR5ICYmIGFwcFBhY2thZ2UpIHtcbiAgICAgIGxldCBmdWxseVF1YWxpZmllZEFjdGl2aXR5ID0gYXBwQWN0aXZpdHkuc3RhcnRzV2l0aCgnLicpID8gYCR7YXBwUGFja2FnZX0ke2FwcEFjdGl2aXR5fWAgOiBhcHBBY3Rpdml0eTtcbiAgICAgIGxvZy5kZWJ1ZyhgRm91bmQgcGFja2FnZTogJyR7YXBwUGFja2FnZX0nIGFuZCBmdWxseSBxdWFsaWZpZWQgYWN0aXZpdHkgbmFtZSA6ICcke2Z1bGx5UXVhbGlmaWVkQWN0aXZpdHl9J2ApO1xuICAgICAgbGV0IGZvdW5kQWN0ID0gKF8uaW5jbHVkZXMoYWxsUGFja2FnZXMsIGFwcFBhY2thZ2UpICYmXG4gICAgICAgICAgICAgICAgICAgICAgXy5maW5kSW5kZXgocG9zc2libGVBY3Rpdml0eVBhdHRlcm5zLCAocG9zc2libGVQYXR0ZXJuKSA9PiBwb3NzaWJsZVBhdHRlcm4udGVzdChmdWxseVF1YWxpZmllZEFjdGl2aXR5KSkgIT09IC0xKTtcbiAgICAgIGlmICgoIXdhaXRGb3JTdG9wICYmIGZvdW5kQWN0KSB8fCAod2FpdEZvclN0b3AgJiYgIWZvdW5kQWN0KSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuICAgIGxvZy5kZWJ1ZygnSW5jb3JyZWN0IHBhY2thZ2UgYW5kIGFjdGl2aXR5LiBSZXRyeWluZy4nKTtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYCR7cG9zc2libGVBY3Rpdml0eU5hbWVzLm1hcCgobmFtZSkgPT4gYCcke25hbWV9J2ApLmpvaW4oJyBvciAnKX0gbmV2ZXIgJHt3YWl0Rm9yU3RvcCA/ICdzdG9wcGVkJyA6ICdzdGFydGVkJ30uIGAgK1xuICAgICAgYFZpc2l0ICR7QUNUSVZJVElFU19UUk9VQkxFU0hPT1RJTkdfTElOS30gZm9yIHRyb3VibGVzaG9vdGluZ2ApO1xuICB9KTtcbn07XG5cbi8qKlxuICogV2FpdCBmb3IgdGhlIGdpdmVuIGFjdGl2aXR5IHRvIGJlIGZvY3VzZWRcbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gcGtnIC0gVGhlIG5hbWUgb2YgdGhlIHBhY2thZ2UgdG8gd2FpdCBmb3IuXG4gKiBAcGFyYW0ge3N0cmluZ30gYWN0aXZpdHkgLSBUaGUgbmFtZSBvZiB0aGUgYWN0aXZpdHksIGJlbG9uZ2luZyB0byB0aGF0IHBhY2thZ2UsXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0byB3YWl0IGZvci5cbiAqIEBwYXJhbSB7bnVtYmVyfSB3YWl0TXMgWzIwMDAwXSAtIE51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdCBiZWZvcmUgdGltZW91dCBvY2N1cnMuXG4gKiBAdGhyb3dzIHtlcnJvcn0gSWYgdGltZW91dCBoYXBwZW5zLlxuICovXG5hcGtVdGlsc01ldGhvZHMud2FpdEZvckFjdGl2aXR5ID0gYXN5bmMgZnVuY3Rpb24gd2FpdEZvckFjdGl2aXR5IChwa2csIGFjdCwgd2FpdE1zID0gMjAwMDApIHtcbiAgYXdhaXQgdGhpcy53YWl0Rm9yQWN0aXZpdHlPck5vdChwa2csIGFjdCwgZmFsc2UsIHdhaXRNcyk7XG59O1xuXG4vKipcbiAqIFdhaXQgZm9yIHRoZSBnaXZlbiBhY3Rpdml0eSB0byBiZSBub24tZm9jdXNlZC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gcGtnIC0gVGhlIG5hbWUgb2YgdGhlIHBhY2thZ2UgdG8gd2FpdCBmb3IuXG4gKiBAcGFyYW0ge3N0cmluZ30gYWN0aXZpdHkgLSBUaGUgbmFtZSBvZiB0aGUgYWN0aXZpdHksIGJlbG9uZ2luZyB0byB0aGF0IHBhY2thZ2UsXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0byB3YWl0IGZvci5cbiAqIEBwYXJhbSB7bnVtYmVyfSB3YWl0TXMgWzIwMDAwXSAtIE51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdCBiZWZvcmUgdGltZW91dCBvY2N1cnMuXG4gKiBAdGhyb3dzIHtlcnJvcn0gSWYgdGltZW91dCBoYXBwZW5zLlxuICovXG5hcGtVdGlsc01ldGhvZHMud2FpdEZvck5vdEFjdGl2aXR5ID0gYXN5bmMgZnVuY3Rpb24gd2FpdEZvck5vdEFjdGl2aXR5IChwa2csIGFjdCwgd2FpdE1zID0gMjAwMDApIHtcbiAgYXdhaXQgdGhpcy53YWl0Rm9yQWN0aXZpdHlPck5vdChwa2csIGFjdCwgdHJ1ZSwgd2FpdE1zKTtcbn07XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gVW5pbnN0YWxsT3B0aW9uc1xuICogQHByb3BlcnR5IHtudW1iZXJ9IHRpbWVvdXQgW2FkYkV4ZWNUaW1lb3V0XSAtIFRoZSBjb3VudCBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdCB1bnRpbCB0aGVcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHAgaXMgdW5pbnN0YWxsZWQuXG4gKiBAcHJvcGVydHkge2Jvb2xlYW59IGtlZXBEYXRhIFtmYWxzZV0gLSBTZXQgdG8gdHJ1ZSBpbiBvcmRlciB0byBrZWVwIHRoZVxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwbGljYXRpb24gZGF0YSBhbmQgY2FjaGUgZm9sZGVycyBhZnRlciB1bmluc3RhbGwuXG4gKi9cblxuLyoqXG4gKiBVbmluc3RhbGwgdGhlIGdpdmVuIHBhY2thZ2UgZnJvbSB0aGUgZGV2aWNlIHVuZGVyIHRlc3QuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHBrZyAtIFRoZSBuYW1lIG9mIHRoZSBwYWNrYWdlIHRvIGJlIHVuaW5zdGFsbGVkLlxuICogQHBhcmFtIHs/VW5pbnN0YWxsT3B0aW9uc30gb3B0aW9ucyAtIFRoZSBzZXQgb2YgdW5pbnN0YWxsIG9wdGlvbnMuXG4gKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIHRoZSBwYWNrYWdlIHdhcyBmb3VuZCBvbiB0aGUgZGV2aWNlIGFuZFxuICogICAgICAgICAgICAgICAgICAgc3VjY2Vzc2Z1bGx5IHVuaW5zdGFsbGVkLlxuICovXG5hcGtVdGlsc01ldGhvZHMudW5pbnN0YWxsQXBrID0gYXN5bmMgZnVuY3Rpb24gdW5pbnN0YWxsQXBrIChwa2csIG9wdGlvbnMgPSB7fSkge1xuICBsb2cuZGVidWcoYFVuaW5zdGFsbGluZyAke3BrZ31gKTtcbiAgaWYgKCFhd2FpdCB0aGlzLmlzQXBwSW5zdGFsbGVkKHBrZykpIHtcbiAgICBsb2cuaW5mbyhgJHtwa2d9IHdhcyBub3QgdW5pbnN0YWxsZWQsIGJlY2F1c2UgaXQgd2FzIG5vdCBwcmVzZW50IG9uIHRoZSBkZXZpY2VgKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBjb25zdCBjbWQgPSBbJ3VuaW5zdGFsbCddO1xuICBpZiAob3B0aW9ucy5rZWVwRGF0YSkge1xuICAgIGNtZC5wdXNoKCctaycpO1xuICB9XG4gIGNtZC5wdXNoKHBrZyk7XG5cbiAgbGV0IHN0ZG91dDtcbiAgdHJ5IHtcbiAgICBhd2FpdCB0aGlzLmZvcmNlU3RvcChwa2cpO1xuICAgIHN0ZG91dCA9IChhd2FpdCB0aGlzLmFkYkV4ZWMoY21kLCB7dGltZW91dDogb3B0aW9ucy50aW1lb3V0fSkpLnRyaW0oKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgVW5hYmxlIHRvIHVuaW5zdGFsbCBBUEsuIE9yaWdpbmFsIGVycm9yOiAke2UubWVzc2FnZX1gKTtcbiAgfVxuICBsb2cuZGVidWcoYCdhZGIgJHtjbWQuam9pbignICcpfScgY29tbWFuZCBvdXRwdXQ6ICR7c3Rkb3V0fWApO1xuICBpZiAoc3Rkb3V0LmluY2x1ZGVzKCdTdWNjZXNzJykpIHtcbiAgICBsb2cuaW5mbyhgJHtwa2d9IHdhcyBzdWNjZXNzZnVsbHkgdW5pbnN0YWxsZWRgKTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBsb2cuaW5mbyhgJHtwa2d9IHdhcyBub3QgdW5pbnN0YWxsZWRgKTtcbiAgcmV0dXJuIGZhbHNlO1xufTtcblxuLyoqXG4gKiBJbnN0YWxsIHRoZSBwYWNrYWdlIGFmdGVyIGl0IHdhcyBwdXNoZWQgdG8gdGhlIGRldmljZSB1bmRlciB0ZXN0LlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBhcGtQYXRoT25EZXZpY2UgLSBUaGUgZnVsbCBwYXRoIHRvIHRoZSBwYWNrYWdlIG9uIHRoZSBkZXZpY2UgZmlsZSBzeXN0ZW0uXG4gKiBAcGFyYW0ge29iamVjdH0gb3B0cyBbe31dIC0gQWRkaXRpb25hbCBleGVjIG9wdGlvbnMuIFNlZSB7QGxpbmsgaHR0cHM6Ly9naXRodWIuY29tL2FwcGl1bS9ub2RlLXRlZW5fcHJvY2Vzc31cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgbW9yZSBkZXRhaWxzIG9uIHRoaXMgcGFyYW1ldGVyLlxuICogQHRocm93cyB7ZXJyb3J9IElmIHRoZXJlIHdhcyBhIGZhaWx1cmUgZHVyaW5nIGFwcGxpY2F0aW9uIGluc3RhbGwuXG4gKi9cbmFwa1V0aWxzTWV0aG9kcy5pbnN0YWxsRnJvbURldmljZVBhdGggPSBhc3luYyBmdW5jdGlvbiBpbnN0YWxsRnJvbURldmljZVBhdGggKGFwa1BhdGhPbkRldmljZSwgb3B0cyA9IHt9KSB7XG4gIGxldCBzdGRvdXQgPSBhd2FpdCB0aGlzLnNoZWxsKFsncG0nLCAnaW5zdGFsbCcsICctcicsIGFwa1BhdGhPbkRldmljZV0sIG9wdHMpO1xuICBpZiAoc3Rkb3V0LmluZGV4T2YoJ0ZhaWx1cmUnKSAhPT0gLTEpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFJlbW90ZSBpbnN0YWxsIGZhaWxlZDogJHtzdGRvdXR9YCk7XG4gIH1cbn07XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gQ2FjaGluZ09wdGlvbnNcbiAqIEBwcm9wZXJ0eSB7P251bWJlcn0gdGltZW91dCBbYWRiRXhlY1RpbWVvdXRdIC0gVGhlIGNvdW50IG9mIG1pbGxpc2Vjb25kcyB0byB3YWl0IHVudGlsIHRoZVxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHAgaXMgdXBsb2FkZWQgdG8gdGhlIHJlbW90ZSBsb2NhdGlvbi5cbiAqL1xuXG4vKipcbiAqIENhY2hlcyB0aGUgZ2l2ZW4gQVBLIGF0IGEgcmVtb3RlIGxvY2F0aW9uIHRvIHNwZWVkIHVwIGZ1cnRoZXIgQVBLIGRlcGxveW1lbnRzLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBhcGtQYXRoIC0gRnVsbCBwYXRoIHRvIHRoZSBhcGsgb24gdGhlIGxvY2FsIEZTXG4gKiBAcGFyYW0gez9DYWNoaW5nT3B0aW9uc30gb3B0aW9ucyAtIENhY2hpbmcgb3B0aW9uc1xuICogQHJldHVybnMge3N0cmluZ30gLSBGdWxsIHBhdGggdG8gdGhlIGNhY2hlZCBhcGsgb24gdGhlIHJlbW90ZSBmaWxlIHN5c3RlbVxuICovXG5hcGtVdGlsc01ldGhvZHMuY2FjaGVBcGsgPSBhc3luYyBmdW5jdGlvbiBjYWNoZUFwayAoYXBrUGF0aCwgb3B0aW9ucyA9IHt9KSB7XG4gIGNvbnN0IGFwcEhhc2ggPSBhd2FpdCBmcy5oYXNoKGFwa1BhdGgpO1xuICBjb25zdCByZW1vdGVQYXRoID0gcGF0aC5wb3NpeC5qb2luKFJFTU9URV9DQUNIRV9ST09ULCBgJHthcHBIYXNofS5hcGtgKTtcbiAgY29uc3QgcmVtb3RlQ2FjaGVkRmlsZXMgPSBbXTtcbiAgLy8gR2V0IGN1cnJlbnQgY29udGVudHMgb2YgdGhlIHJlbW90ZSBjYWNoZSBvciBjcmVhdGUgaXQgZm9yIHRoZSBmaXJzdCB0aW1lXG4gIHRyeSB7XG4gICAgY29uc3QgZXJyb3JNYXJrZXIgPSAnX0VSUk9SXyc7XG4gICAgbGV0IGxzT3V0cHV0ID0gbnVsbDtcbiAgICBpZiAodGhpcy5fYXJlRXh0ZW5kZWRMc09wdGlvbnNTdXBwb3J0ZWQgPT09IHRydWUgfHwgIV8uaXNCb29sZWFuKHRoaXMuX2FyZUV4dGVuZGVkTHNPcHRpb25zU3VwcG9ydGVkKSkge1xuICAgICAgbHNPdXRwdXQgPSBhd2FpdCB0aGlzLnNoZWxsKFtgbHMgLXQgLTEgJHtSRU1PVEVfQ0FDSEVfUk9PVH0gMj4mMSB8fCBlY2hvICR7ZXJyb3JNYXJrZXJ9YF0pO1xuICAgIH1cbiAgICBpZiAoIV8uaXNTdHJpbmcobHNPdXRwdXQpIHx8IChsc091dHB1dC5pbmNsdWRlcyhlcnJvck1hcmtlcikgJiYgIWxzT3V0cHV0LmluY2x1ZGVzKFJFTU9URV9DQUNIRV9ST09UKSkpIHtcbiAgICAgIGlmICghXy5pc0Jvb2xlYW4odGhpcy5fYXJlRXh0ZW5kZWRMc09wdGlvbnNTdXBwb3J0ZWQpKSB7XG4gICAgICAgIGxvZy5kZWJ1ZygnVGhlIGN1cnJlbnQgQW5kcm9pZCBBUEkgZG9lcyBub3Qgc3VwcG9ydCBleHRlbmRlZCBscyBvcHRpb25zLiAnICtcbiAgICAgICAgICAnRGVmYXVsdGluZyB0byBuby1vcHRpb25zIGNhbGwnKTtcbiAgICAgIH1cbiAgICAgIGxzT3V0cHV0ID0gYXdhaXQgdGhpcy5zaGVsbChbYGxzICR7UkVNT1RFX0NBQ0hFX1JPT1R9IDI+JjEgfHwgZWNobyAke2Vycm9yTWFya2VyfWBdKTtcbiAgICAgIHRoaXMuX2FyZUV4dGVuZGVkTHNPcHRpb25zU3VwcG9ydGVkID0gZmFsc2U7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2FyZUV4dGVuZGVkTHNPcHRpb25zU3VwcG9ydGVkID0gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKGxzT3V0cHV0LmluY2x1ZGVzKGVycm9yTWFya2VyKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGxzT3V0cHV0LnN1YnN0cmluZygwLCBsc091dHB1dC5pbmRleE9mKGVycm9yTWFya2VyKSkpO1xuICAgIH1cbiAgICByZW1vdGVDYWNoZWRGaWxlcy5wdXNoKC4uLihcbiAgICAgIGxzT3V0cHV0LnNwbGl0KCdcXG4nKVxuICAgICAgICAubWFwKCh4KSA9PiB4LnRyaW0oKSlcbiAgICAgICAgLmZpbHRlcihCb29sZWFuKVxuICAgICkpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgbG9nLmRlYnVnKGBHb3QgYW4gZXJyb3IgJyR7ZS5tZXNzYWdlLnRyaW0oKX0nIHdoaWxlIGdldHRpbmcgdGhlIGxpc3Qgb2YgZmlsZXMgaW4gdGhlIGNhY2hlLiBgICtcbiAgICAgIGBBc3N1bWluZyB0aGUgY2FjaGUgZG9lcyBub3QgZXhpc3QgeWV0YCk7XG4gICAgYXdhaXQgdGhpcy5zaGVsbChbJ21rZGlyJywgJy1wJywgUkVNT1RFX0NBQ0hFX1JPT1RdKTtcbiAgfVxuICBsb2cuZGVidWcoYFRoZSBjb3VudCBvZiBhcHBsaWNhdGlvbnMgaW4gdGhlIGNhY2hlOiAke3JlbW90ZUNhY2hlZEZpbGVzLmxlbmd0aH1gKTtcbiAgY29uc3QgdG9IYXNoID0gKHJlbW90ZVBhdGgpID0+IHBhdGgucG9zaXgucGFyc2UocmVtb3RlUGF0aCkubmFtZTtcbiAgLy8gUHVzaCB0aGUgYXBrIHRvIHRoZSByZW1vdGUgY2FjaGUgaWYgbmVlZGVkXG4gIGlmIChyZW1vdGVDYWNoZWRGaWxlcy5maW5kKCh4KSA9PiB0b0hhc2goeCkgPT09IGFwcEhhc2gpKSB7XG4gICAgbG9nLmluZm8oYFRoZSBhcHBsaWNhdGlvbiBhdCAnJHthcGtQYXRofScgaXMgYWxyZWFkeSBjYWNoZWQgdG8gJyR7cmVtb3RlUGF0aH0nYCk7XG4gIH0gZWxzZSB7XG4gICAgbG9nLmluZm8oYENhY2hpbmcgdGhlIGFwcGxpY2F0aW9uIGF0ICcke2Fwa1BhdGh9JyB0byAnJHtyZW1vdGVQYXRofSdgKTtcbiAgICBjb25zdCBzdGFydGVkID0gcHJvY2Vzcy5ocnRpbWUoKTtcbiAgICBhd2FpdCB0aGlzLnB1c2goYXBrUGF0aCwgcmVtb3RlUGF0aCwge3RpbWVvdXQ6IG9wdGlvbnMudGltZW91dH0pO1xuICAgIGNvbnN0IFtzZWNvbmRzLCBuYW5vc10gPSBwcm9jZXNzLmhydGltZShzdGFydGVkKTtcbiAgICBjb25zdCB7c2l6ZX0gPSBhd2FpdCBmcy5zdGF0KGFwa1BhdGgpO1xuICAgIGxvZy5pbmZvKGBUaGUgdXBsb2FkIG9mICcke3BhdGguYmFzZW5hbWUoYXBrUGF0aCl9JyAoJHt1dGlsLnRvUmVhZGFibGVTaXplU3RyaW5nKHNpemUpfSkgYCArXG4gICAgICBgdG9vayAkeyhzZWNvbmRzICsgbmFub3MgLyAxZTkpLnRvRml4ZWQoMyl9c2ApO1xuICB9XG4gIGlmICghdGhpcy5yZW1vdGVBcHBzQ2FjaGUpIHtcbiAgICB0aGlzLnJlbW90ZUFwcHNDYWNoZSA9IG5ldyBMUlUoe1xuICAgICAgbWF4OiB0aGlzLnJlbW90ZUFwcHNDYWNoZUxpbWl0LFxuICAgIH0pO1xuICB9XG4gIC8vIENsZWFudXAgdGhlIGludmFsaWQgZW50cmllcyBmcm9tIHRoZSBjYWNoZVxuICBfLmRpZmZlcmVuY2UodGhpcy5yZW1vdGVBcHBzQ2FjaGUua2V5cygpLCByZW1vdGVDYWNoZWRGaWxlcy5tYXAodG9IYXNoKSlcbiAgICAuZm9yRWFjaCgoaGFzaCkgPT4gdGhpcy5yZW1vdGVBcHBzQ2FjaGUuZGVsKGhhc2gpKTtcbiAgLy8gQnVtcCB0aGUgY2FjaGUgcmVjb3JkIGZvciB0aGUgcmVjZW50bHkgY2FjaGVkIGl0ZW1cbiAgdGhpcy5yZW1vdGVBcHBzQ2FjaGUuc2V0KGFwcEhhc2gsIHJlbW90ZVBhdGgpO1xuICAvLyBJZiB0aGUgcmVtb3RlIGNhY2hlIGV4Y2VlZHMgdGhpcy5yZW1vdGVBcHBzQ2FjaGVMaW1pdCwgcmVtb3ZlIHRoZSBsZWFzdCByZWNlbnRseSB1c2VkIGVudHJpZXNcbiAgY29uc3QgZW50cmllc1RvQ2xlYW51cCA9IHJlbW90ZUNhY2hlZEZpbGVzXG4gICAgLm1hcCgoeCkgPT4gcGF0aC5wb3NpeC5qb2luKFJFTU9URV9DQUNIRV9ST09ULCB4KSlcbiAgICAuZmlsdGVyKCh4KSA9PiAhdGhpcy5yZW1vdGVBcHBzQ2FjaGUuaGFzKHRvSGFzaCh4KSkpXG4gICAgLnNsaWNlKHRoaXMucmVtb3RlQXBwc0NhY2hlTGltaXQgLSB0aGlzLnJlbW90ZUFwcHNDYWNoZS5rZXlzKCkubGVuZ3RoKTtcbiAgaWYgKCFfLmlzRW1wdHkoZW50cmllc1RvQ2xlYW51cCkpIHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5zaGVsbChbJ3JtJywgJy1mJywgLi4uZW50cmllc1RvQ2xlYW51cF0pO1xuICAgICAgbG9nLmRlYnVnKGBEZWxldGVkICR7ZW50cmllc1RvQ2xlYW51cC5sZW5ndGh9IGV4cGlyZWQgYXBwbGljYXRpb24gY2FjaGUgZW50cmllc2ApO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGxvZy53YXJuKGBDYW5ub3QgZGVsZXRlICR7ZW50cmllc1RvQ2xlYW51cC5sZW5ndGh9IGV4cGlyZWQgYXBwbGljYXRpb24gY2FjaGUgZW50cmllcy4gYCArXG4gICAgICAgIGBPcmlnaW5hbCBlcnJvcjogJHtlLm1lc3NhZ2V9YCk7XG4gICAgfVxuICB9XG4gIHJldHVybiByZW1vdGVQYXRoO1xufTtcblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBJbnN0YWxsT3B0aW9uc1xuICogQHByb3BlcnR5IHtudW1iZXJ9IHRpbWVvdXQgWzYwMDAwXSAtIFRoZSBjb3VudCBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdCB1bnRpbCB0aGVcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHAgaXMgaW5zdGFsbGVkLlxuICogQHByb3BlcnR5IHtzdHJpbmd9IHRpbWVvdXRDYXBOYW1lIFthbmRyb2lkSW5zdGFsbFRpbWVvdXRdIC0gVGhlIHRpbWVvdXQgb3B0aW9uIG5hbWVcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJzIGNhbiBpbmNyZWFzZSB0aGUgdGltZW91dC5cbiAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gYWxsb3dUZXN0UGFja2FnZXMgW2ZhbHNlXSAtIFNldCB0byB0cnVlIGluIG9yZGVyIHRvIGFsbG93IHRlc3RcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhY2thZ2VzIGluc3RhbGxhdGlvbi5cbiAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gdXNlU2RjYXJkIFtmYWxzZV0gLSBTZXQgdG8gdHJ1ZSB0byBpbnN0YWxsIHRoZSBhcHAgb24gc2RjYXJkXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zdGVhZCBvZiB0aGUgZGV2aWNlIG1lbW9yeS5cbiAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gZ3JhbnRQZXJtaXNzaW9ucyBbZmFsc2VdIC0gU2V0IHRvIHRydWUgaW4gb3JkZXIgdG8gZ3JhbnQgYWxsIHRoZVxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwZXJtaXNzaW9ucyByZXF1ZXN0ZWQgaW4gdGhlIGFwcGxpY2F0aW9uJ3MgbWFuaWZlc3RcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXV0b21hdGljYWxseSBhZnRlciB0aGUgaW5zdGFsbGF0aW9uIGlzIGNvbXBsZXRlZFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bmRlciBBbmRyb2lkIDYrLlxuICogQHByb3BlcnR5IHtib29sZWFufSByZXBsYWNlIFt0cnVlXSAtIFNldCBpdCB0byBmYWxzZSBpZiB5b3UgZG9uJ3Qgd2FudFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZSBhcHBsaWNhdGlvbiB0byBiZSB1cGdyYWRlZC9yZWluc3RhbGxlZFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGl0IGlzIGFscmVhZHkgcHJlc2VudCBvbiB0aGUgZGV2aWNlLlxuICovXG5cbi8qKlxuICogSW5zdGFsbCB0aGUgcGFja2FnZSBmcm9tIHRoZSBsb2NhbCBmaWxlIHN5c3RlbS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gYXBwUGF0aCAtIFRoZSBmdWxsIHBhdGggdG8gdGhlIGxvY2FsIHBhY2thZ2UuXG4gKiBAcGFyYW0gez9JbnN0YWxsT3B0aW9uc30gb3B0aW9ucyAtIFRoZSBzZXQgb2YgaW5zdGFsbGF0aW9uIG9wdGlvbnMuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgYW4gdW5leHBlY3RlZCBlcnJvciBoYXBwZW5zIGR1cmluZyBpbnN0YWxsLlxuICovXG5hcGtVdGlsc01ldGhvZHMuaW5zdGFsbCA9IGFzeW5jIGZ1bmN0aW9uIGluc3RhbGwgKGFwcFBhdGgsIG9wdGlvbnMgPSB7fSkge1xuICBpZiAoYXBwUGF0aC5lbmRzV2l0aChBUEtTX0VYVEVOU0lPTikpIHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5pbnN0YWxsQXBrcyhhcHBQYXRoLCBvcHRpb25zKTtcbiAgfVxuXG4gIG9wdGlvbnMgPSBfLmNsb25lRGVlcChvcHRpb25zKTtcbiAgXy5kZWZhdWx0cyhvcHRpb25zLCB7XG4gICAgcmVwbGFjZTogdHJ1ZSxcbiAgICB0aW1lb3V0OiB0aGlzLmFkYkV4ZWNUaW1lb3V0ID09PSBERUZBVUxUX0FEQl9FWEVDX1RJTUVPVVQgPyBBUEtfSU5TVEFMTF9USU1FT1VUIDogdGhpcy5hZGJFeGVjVGltZW91dCxcbiAgICB0aW1lb3V0Q2FwTmFtZTogJ2FuZHJvaWRJbnN0YWxsVGltZW91dCcsXG4gIH0pO1xuXG4gIGNvbnN0IGluc3RhbGxBcmdzID0gYnVpbGRJbnN0YWxsQXJncyhhd2FpdCB0aGlzLmdldEFwaUxldmVsKCksIG9wdGlvbnMpO1xuICBjb25zdCBpbnN0YWxsT3B0cyA9IHtcbiAgICB0aW1lb3V0OiBvcHRpb25zLnRpbWVvdXQsXG4gICAgdGltZW91dENhcE5hbWU6IG9wdGlvbnMudGltZW91dENhcE5hbWUsXG4gIH07XG4gIGxldCBwZXJmb3JtQXBwSW5zdGFsbCA9IGFzeW5jICgpID0+IGF3YWl0IHRoaXMuYWRiRXhlYyhbXG4gICAgJ2luc3RhbGwnLFxuICAgIC4uLmluc3RhbGxBcmdzLFxuICAgIGFwcFBhdGhcbiAgXSwgaW5zdGFsbE9wdHMpO1xuICAvLyB0aGlzLnJlbW90ZUFwcHNDYWNoZUxpbWl0IDw9IDAgbWVhbnMgbm8gY2FjaGluZyBzaG91bGQgYmUgYXBwbGllZFxuICBpZiAodGhpcy5yZW1vdGVBcHBzQ2FjaGVMaW1pdCA+IDApIHtcbiAgICBjb25zdCBjYWNoZWRSZW1vdGVQYXRoID0gYXdhaXQgdGhpcy5jYWNoZUFwayhhcHBQYXRoLCB7XG4gICAgICB0aW1lb3V0OiBvcHRpb25zLnRpbWVvdXQsXG4gICAgfSk7XG4gICAgcGVyZm9ybUFwcEluc3RhbGwgPSBhc3luYyAoKSA9PiBhd2FpdCB0aGlzLnNoZWxsKFtcbiAgICAgICdwbScsXG4gICAgICAnaW5zdGFsbCcsXG4gICAgICAuLi5pbnN0YWxsQXJncyxcbiAgICAgIGNhY2hlZFJlbW90ZVBhdGhcbiAgICBdLCBpbnN0YWxsT3B0cyk7XG4gIH1cbiAgdHJ5IHtcbiAgICBjb25zdCBzdGFydGVkID0gcHJvY2Vzcy5ocnRpbWUoKTtcbiAgICBjb25zdCBvdXRwdXQgPSBhd2FpdCBwZXJmb3JtQXBwSW5zdGFsbCgpO1xuICAgIGNvbnN0IFtzZWNvbmRzLCBuYW5vc10gPSBwcm9jZXNzLmhydGltZShzdGFydGVkKTtcbiAgICBsb2cuaW5mbyhgVGhlIGluc3RhbGxhdGlvbiBvZiAnJHtwYXRoLmJhc2VuYW1lKGFwcFBhdGgpfScgdG9vayAkeyhzZWNvbmRzICsgbmFub3MgLyAxZTkpLnRvRml4ZWQoMyl9c2ApO1xuICAgIGNvbnN0IHRydW5jYXRlZE91dHB1dCA9ICghXy5pc1N0cmluZyhvdXRwdXQpIHx8IG91dHB1dC5sZW5ndGggPD0gMzAwKSA/XG4gICAgICBvdXRwdXQgOiBgJHtvdXRwdXQuc3Vic3RyKDAsIDE1MCl9Li4uJHtvdXRwdXQuc3Vic3RyKG91dHB1dC5sZW5ndGggLSAxNTApfWA7XG4gICAgbG9nLmRlYnVnKGBJbnN0YWxsIGNvbW1hbmQgc3Rkb3V0OiAke3RydW5jYXRlZE91dHB1dH1gKTtcbiAgICBpZiAoL1xcW0lOU1RBTExbQS1aX10rRkFJTEVEW0EtWl9dK1xcXS8udGVzdChvdXRwdXQpKSB7XG4gICAgICBpZiAodGhpcy5pc1Rlc3RQYWNrYWdlT25seUVycm9yKG91dHB1dCkpIHtcbiAgICAgICAgY29uc3QgbXNnID0gYFNldCAnYWxsb3dUZXN0UGFja2FnZXMnIGNhcGFiaWxpdHkgdG8gdHJ1ZSBpbiBvcmRlciB0byBhbGxvdyB0ZXN0IHBhY2thZ2VzIGluc3RhbGxhdGlvbi5gO1xuICAgICAgICBsb2cud2Fybihtc2cpO1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYCR7b3V0cHV0fVxcbiR7bXNnfWApO1xuICAgICAgfVxuICAgICAgdGhyb3cgbmV3IEVycm9yKG91dHB1dCk7XG4gICAgfVxuICB9IGNhdGNoIChlcnIpIHtcbiAgICAvLyBvbiBzb21lIHN5c3RlbXMgdGhpcyB3aWxsIHRocm93IGFuIGVycm9yIGlmIHRoZSBhcHAgYWxyZWFkeVxuICAgIC8vIGV4aXN0c1xuICAgIGlmICghZXJyLm1lc3NhZ2UuaW5jbHVkZXMoJ0lOU1RBTExfRkFJTEVEX0FMUkVBRFlfRVhJU1RTJykpIHtcbiAgICAgIHRocm93IGVycjtcbiAgICB9XG4gICAgbG9nLmRlYnVnKGBBcHBsaWNhdGlvbiAnJHthcHBQYXRofScgYWxyZWFkeSBpbnN0YWxsZWQuIENvbnRpbnVpbmcuYCk7XG4gIH1cbn07XG5cbi8qKlxuICogUmV0cmlldmVzIHRoZSBjdXJyZW50IGluc3RhbGxhdGlvbiBzdGF0ZSBvZiB0aGUgcGFydGljdWxhciBhcHBsaWNhdGlvblxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBhcHBQYXRoIC0gRnVsbCBwYXRoIHRvIHRoZSBhcHBsaWNhdGlvblxuICogQHBhcmFtIHs/c3RyaW5nfSBwa2cgLSBQYWNrYWdlIGlkZW50aWZpZXIuIElmIG9taXR0ZWQgdGhlbiB0aGUgc2NyaXB0IHdpbGxcbiAqICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHRvIGV4dHJhY3QgaXQgb24gaXRzIG93blxuICogQHJldHVybnMge3N0cmluZ31dT25lIG9mIGBBUFBfSU5TVEFMTF9TVEFURWAgY29uc3RhbnRzXG4gKi9cbmFwa1V0aWxzTWV0aG9kcy5nZXRBcHBsaWNhdGlvbkluc3RhbGxTdGF0ZSA9IGFzeW5jIGZ1bmN0aW9uIGdldEFwcGxpY2F0aW9uSW5zdGFsbFN0YXRlIChhcHBQYXRoLCBwa2cgPSBudWxsKSB7XG4gIGxldCBhcGtJbmZvID0gbnVsbDtcbiAgaWYgKCFwa2cpIHtcbiAgICBhcGtJbmZvID0gYXdhaXQgdGhpcy5nZXRBcGtJbmZvKGFwcFBhdGgpO1xuICAgIHBrZyA9IGFwa0luZm8ubmFtZTtcbiAgfVxuICBpZiAoIXBrZykge1xuICAgIGxvZy53YXJuKGBDYW5ub3QgcmVhZCB0aGUgcGFja2FnZSBuYW1lIG9mICcke2FwcFBhdGh9J2ApO1xuICAgIHJldHVybiB0aGlzLkFQUF9JTlNUQUxMX1NUQVRFLlVOS05PV047XG4gIH1cblxuICBpZiAoIWF3YWl0IHRoaXMuaXNBcHBJbnN0YWxsZWQocGtnKSkge1xuICAgIGxvZy5kZWJ1ZyhgQXBwICcke2FwcFBhdGh9JyBpcyBub3QgaW5zdGFsbGVkYCk7XG4gICAgcmV0dXJuIHRoaXMuQVBQX0lOU1RBTExfU1RBVEUuTk9UX0lOU1RBTExFRDtcbiAgfVxuXG4gIGNvbnN0IHt2ZXJzaW9uQ29kZTogcGtnVmVyc2lvbkNvZGUsIHZlcnNpb25OYW1lOiBwa2dWZXJzaW9uTmFtZVN0cn0gPSBhd2FpdCB0aGlzLmdldFBhY2thZ2VJbmZvKHBrZyk7XG4gIGNvbnN0IHBrZ1ZlcnNpb25OYW1lID0gc2VtdmVyLnZhbGlkKHNlbXZlci5jb2VyY2UocGtnVmVyc2lvbk5hbWVTdHIpKTtcbiAgaWYgKCFhcGtJbmZvKSB7XG4gICAgYXBrSW5mbyA9IGF3YWl0IHRoaXMuZ2V0QXBrSW5mbyhhcHBQYXRoKTtcbiAgfVxuICBjb25zdCB7dmVyc2lvbkNvZGU6IGFwa1ZlcnNpb25Db2RlLCB2ZXJzaW9uTmFtZTogYXBrVmVyc2lvbk5hbWVTdHJ9ID0gYXBrSW5mbztcbiAgY29uc3QgYXBrVmVyc2lvbk5hbWUgPSBzZW12ZXIudmFsaWQoc2VtdmVyLmNvZXJjZShhcGtWZXJzaW9uTmFtZVN0cikpO1xuXG4gIGlmICghXy5pc0ludGVnZXIoYXBrVmVyc2lvbkNvZGUpIHx8ICFfLmlzSW50ZWdlcihwa2dWZXJzaW9uQ29kZSkpIHtcbiAgICBsb2cud2FybihgQ2Fubm90IHJlYWQgdmVyc2lvbiBjb2RlcyBvZiAnJHthcHBQYXRofScgYW5kL29yICcke3BrZ30nYCk7XG4gICAgaWYgKCFfLmlzU3RyaW5nKGFwa1ZlcnNpb25OYW1lKSB8fCAhXy5pc1N0cmluZyhwa2dWZXJzaW9uTmFtZSkpIHtcbiAgICAgIGxvZy53YXJuKGBDYW5ub3QgcmVhZCB2ZXJzaW9uIG5hbWVzIG9mICcke2FwcFBhdGh9JyBhbmQvb3IgJyR7cGtnfSdgKTtcbiAgICAgIHJldHVybiB0aGlzLkFQUF9JTlNUQUxMX1NUQVRFLlVOS05PV047XG4gICAgfVxuICB9XG4gIGlmIChfLmlzSW50ZWdlcihhcGtWZXJzaW9uQ29kZSkgJiYgXy5pc0ludGVnZXIocGtnVmVyc2lvbkNvZGUpKSB7XG4gICAgaWYgKHBrZ1ZlcnNpb25Db2RlID4gYXBrVmVyc2lvbkNvZGUpIHtcbiAgICAgIGxvZy5kZWJ1ZyhgVGhlIHZlcnNpb24gY29kZSBvZiB0aGUgaW5zdGFsbGVkICcke3BrZ30nIGlzIGdyZWF0ZXIgdGhhbiB0aGUgYXBwbGljYXRpb24gdmVyc2lvbiBjb2RlICgke3BrZ1ZlcnNpb25Db2RlfSA+ICR7YXBrVmVyc2lvbkNvZGV9KWApO1xuICAgICAgcmV0dXJuIHRoaXMuQVBQX0lOU1RBTExfU1RBVEUuTkVXRVJfVkVSU0lPTl9JTlNUQUxMRUQ7XG4gICAgfVxuICAgIC8vIFZlcnNpb24gY29kZXMgbWlnaHQgbm90IGJlIG1haW50YWluZWQuIENoZWNrIHZlcnNpb24gbmFtZXMuXG4gICAgaWYgKHBrZ1ZlcnNpb25Db2RlID09PSBhcGtWZXJzaW9uQ29kZSkge1xuICAgICAgaWYgKF8uaXNTdHJpbmcoYXBrVmVyc2lvbk5hbWUpICYmIF8uaXNTdHJpbmcocGtnVmVyc2lvbk5hbWUpICYmIHNlbXZlci5zYXRpc2ZpZXMocGtnVmVyc2lvbk5hbWUsIGA+PSR7YXBrVmVyc2lvbk5hbWV9YCkpIHtcbiAgICAgICAgbG9nLmRlYnVnKGBUaGUgdmVyc2lvbiBuYW1lIG9mIHRoZSBpbnN0YWxsZWQgJyR7cGtnfScgaXMgZ3JlYXRlciBvciBlcXVhbCB0byB0aGUgYXBwbGljYXRpb24gdmVyc2lvbiBuYW1lICgnJHtwa2dWZXJzaW9uTmFtZX0nID49ICcke2Fwa1ZlcnNpb25OYW1lfScpYCk7XG4gICAgICAgIHJldHVybiBzZW12ZXIuc2F0aXNmaWVzKHBrZ1ZlcnNpb25OYW1lLCBgPiR7YXBrVmVyc2lvbk5hbWV9YClcbiAgICAgICAgICA/IHRoaXMuQVBQX0lOU1RBTExfU1RBVEUuTkVXRVJfVkVSU0lPTl9JTlNUQUxMRURcbiAgICAgICAgICA6IHRoaXMuQVBQX0lOU1RBTExfU1RBVEUuU0FNRV9WRVJTSU9OX0lOU1RBTExFRDtcbiAgICAgIH1cbiAgICAgIGlmICghXy5pc1N0cmluZyhhcGtWZXJzaW9uTmFtZSkgfHwgIV8uaXNTdHJpbmcocGtnVmVyc2lvbk5hbWUpKSB7XG4gICAgICAgIGxvZy5kZWJ1ZyhgVGhlIHZlcnNpb24gbmFtZSBvZiB0aGUgaW5zdGFsbGVkICcke3BrZ30nIGlzIGVxdWFsIHRvIGFwcGxpY2F0aW9uIHZlcnNpb24gbmFtZSAoJHtwa2dWZXJzaW9uQ29kZX0gPT09ICR7YXBrVmVyc2lvbkNvZGV9KWApO1xuICAgICAgICByZXR1cm4gdGhpcy5BUFBfSU5TVEFMTF9TVEFURS5TQU1FX1ZFUlNJT05fSU5TVEFMTEVEO1xuICAgICAgfVxuICAgIH1cbiAgfSBlbHNlIGlmIChfLmlzU3RyaW5nKGFwa1ZlcnNpb25OYW1lKSAmJiBfLmlzU3RyaW5nKHBrZ1ZlcnNpb25OYW1lKSAmJiBzZW12ZXIuc2F0aXNmaWVzKHBrZ1ZlcnNpb25OYW1lLCBgPj0ke2Fwa1ZlcnNpb25OYW1lfWApKSB7XG4gICAgbG9nLmRlYnVnKGBUaGUgdmVyc2lvbiBuYW1lIG9mIHRoZSBpbnN0YWxsZWQgJyR7cGtnfScgaXMgZ3JlYXRlciBvciBlcXVhbCB0byB0aGUgYXBwbGljYXRpb24gdmVyc2lvbiBuYW1lICgnJHtwa2dWZXJzaW9uTmFtZX0nID49ICcke2Fwa1ZlcnNpb25OYW1lfScpYCk7XG4gICAgcmV0dXJuIHNlbXZlci5zYXRpc2ZpZXMocGtnVmVyc2lvbk5hbWUsIGA+JHthcGtWZXJzaW9uTmFtZX1gKVxuICAgICAgPyB0aGlzLkFQUF9JTlNUQUxMX1NUQVRFLk5FV0VSX1ZFUlNJT05fSU5TVEFMTEVEXG4gICAgICA6IHRoaXMuQVBQX0lOU1RBTExfU1RBVEUuU0FNRV9WRVJTSU9OX0lOU1RBTExFRDtcbiAgfVxuXG4gIGxvZy5kZWJ1ZyhgVGhlIGluc3RhbGxlZCAnJHtwa2d9JyBwYWNrYWdlIGlzIG9sZGVyIHRoYW4gJyR7YXBwUGF0aH0nICgke3BrZ1ZlcnNpb25Db2RlfSA8ICR7YXBrVmVyc2lvbkNvZGV9IG9yICcke3BrZ1ZlcnNpb25OYW1lfScgPCAnJHthcGtWZXJzaW9uTmFtZX0nKSdgKTtcbiAgcmV0dXJuIHRoaXMuQVBQX0lOU1RBTExfU1RBVEUuT0xERVJfVkVSU0lPTl9JTlNUQUxMRUQ7XG59O1xuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IEluc3RhbGxPclVwZ3JhZGVPcHRpb25zXG4gKiBAcHJvcGVydHkge251bWJlcn0gdGltZW91dCBbNjAwMDBdIC0gVGhlIGNvdW50IG9mIG1pbGxpc2Vjb25kcyB0byB3YWl0IHVudGlsIHRoZVxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcCBpcyBpbnN0YWxsZWQuXG4gKiBAcHJvcGVydHkge2Jvb2xlYW59IGFsbG93VGVzdFBhY2thZ2VzIFtmYWxzZV0gLSBTZXQgdG8gdHJ1ZSBpbiBvcmRlciB0byBhbGxvdyB0ZXN0XG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWNrYWdlcyBpbnN0YWxsYXRpb24uXG4gKiBAcHJvcGVydHkge2Jvb2xlYW59IHVzZVNkY2FyZCBbZmFsc2VdIC0gU2V0IHRvIHRydWUgdG8gaW5zdGFsbCB0aGUgYXBwIG9uIFNEQ2FyZFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc3RlYWQgb2YgdGhlIGRldmljZSBtZW1vcnkuXG4gKiBAcHJvcGVydHkge2Jvb2xlYW59IGdyYW50UGVybWlzc2lvbnMgW2ZhbHNlXSAtIFNldCB0byB0cnVlIGluIG9yZGVyIHRvIGdyYW50IGFsbCB0aGVcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGVybWlzc2lvbnMgcmVxdWVzdGVkIGluIHRoZSBhcHBsaWNhdGlvbidzIG1hbmlmZXN0XG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF1dG9tYXRpY2FsbHkgYWZ0ZXIgdGhlIGluc3RhbGxhdGlvbiBpcyBjb21wbGV0ZWRcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5kZXIgQW5kcm9pZCA2Ky5cbiAqL1xuXG4vKipcbiAqIEluc3RhbGwgdGhlIHBhY2thZ2UgZnJvbSB0aGUgbG9jYWwgZmlsZSBzeXN0ZW0gb3IgdXBncmFkZSBpdCBpZiBhbiBvbGRlclxuICogdmVyc2lvbiBvZiB0aGUgc2FtZSBwYWNrYWdlIGlzIGFscmVhZHkgaW5zdGFsbGVkLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBhcHBQYXRoIC0gVGhlIGZ1bGwgcGF0aCB0byB0aGUgbG9jYWwgcGFja2FnZS5cbiAqIEBwYXJhbSB7P3N0cmluZ30gcGtnIC0gVGhlIG5hbWUgb2YgdGhlIGluc3RhbGxlZCBwYWNrYWdlLiBUaGUgbWV0aG9kIHdpbGxcbiAqICAgICAgICAgICAgICAgICAgICAgICAgcGVyZm9ybSBmYXN0ZXIgaWYgaXQgaXMgc2V0LlxuICogQHBhcmFtIHs/SW5zdGFsbE9yVXBncmFkZU9wdGlvbnN9IG9wdGlvbnMgLSBTZXQgb2YgaW5zdGFsbCBvcHRpb25zLlxuICogQHRocm93cyB7RXJyb3J9IElmIGFuIHVuZXhwZWN0ZWQgZXJyb3IgaGFwcGVucyBkdXJpbmcgaW5zdGFsbC5cbiAqL1xuYXBrVXRpbHNNZXRob2RzLmluc3RhbGxPclVwZ3JhZGUgPSBhc3luYyBmdW5jdGlvbiBpbnN0YWxsT3JVcGdyYWRlIChhcHBQYXRoLCBwa2cgPSBudWxsLCBvcHRpb25zID0ge30pIHtcbiAgaWYgKCFwa2cpIHtcbiAgICBjb25zdCBhcGtJbmZvID0gYXdhaXQgdGhpcy5nZXRBcGtJbmZvKGFwcFBhdGgpO1xuICAgIHBrZyA9IGFwa0luZm8ubmFtZTtcbiAgfVxuXG4gIGNvbnN0IGFwcFN0YXRlID0gYXdhaXQgdGhpcy5nZXRBcHBsaWNhdGlvbkluc3RhbGxTdGF0ZShhcHBQYXRoLCBwa2cpO1xuICBzd2l0Y2ggKGFwcFN0YXRlKSB7XG4gICAgY2FzZSB0aGlzLkFQUF9JTlNUQUxMX1NUQVRFLk5PVF9JTlNUQUxMRUQ6XG4gICAgICBsb2cuZGVidWcoYEluc3RhbGxpbmcgJyR7YXBwUGF0aH0nYCk7XG4gICAgICBhd2FpdCB0aGlzLmluc3RhbGwoYXBwUGF0aCwgT2JqZWN0LmFzc2lnbih7fSwgb3B0aW9ucywge3JlcGxhY2U6IGZhbHNlfSkpO1xuICAgICAgcmV0dXJuO1xuICAgIGNhc2UgdGhpcy5BUFBfSU5TVEFMTF9TVEFURS5ORVdFUl9WRVJTSU9OX0lOU1RBTExFRDpcbiAgICBjYXNlIHRoaXMuQVBQX0lOU1RBTExfU1RBVEUuU0FNRV9WRVJTSU9OX0lOU1RBTExFRDpcbiAgICAgIGxvZy5kZWJ1ZyhgVGhlcmUgaXMgbm8gbmVlZCB0byBpbnN0YWxsL3VwZ3JhZGUgJyR7YXBwUGF0aH0nYCk7XG4gICAgICByZXR1cm47XG4gICAgY2FzZSB0aGlzLkFQUF9JTlNUQUxMX1NUQVRFLk9MREVSX1ZFUlNJT05fSU5TVEFMTEVEOlxuICAgICAgbG9nLmRlYnVnKGBFeGVjdXRpbmcgdXBncmFkZSBvZiAnJHthcHBQYXRofSdgKTtcbiAgICAgIGJyZWFrO1xuICAgIGRlZmF1bHQ6XG4gICAgICBsb2cuZGVidWcoYFRoZSBjdXJyZW50IGluc3RhbGwgc3RhdGUgb2YgJyR7YXBwUGF0aH0nIGlzIHVua25vd24uIEluc3RhbGxpbmcgYW55d2F5YCk7XG4gICAgICBicmVhaztcbiAgfVxuXG4gIHRyeSB7XG4gICAgYXdhaXQgdGhpcy5pbnN0YWxsKGFwcFBhdGgsIE9iamVjdC5hc3NpZ24oe30sIG9wdGlvbnMsIHtyZXBsYWNlOiB0cnVlfSkpO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBsb2cud2FybihgQ2Fubm90IHVwZ3JhZGUgJyR7cGtnfScgYmVjYXVzZSBvZiAnJHtlcnIubWVzc2FnZX0nLiBUcnlpbmcgZnVsbCByZWluc3RhbGxgKTtcbiAgICBpZiAoIWF3YWl0IHRoaXMudW5pbnN0YWxsQXBrKHBrZykpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgJyR7cGtnfScgcGFja2FnZSBjYW5ub3QgYmUgdW5pbnN0YWxsZWRgKTtcbiAgICB9XG4gICAgYXdhaXQgdGhpcy5pbnN0YWxsKGFwcFBhdGgsIE9iamVjdC5hc3NpZ24oe30sIG9wdGlvbnMsIHtyZXBsYWNlOiBmYWxzZX0pKTtcbiAgfVxufTtcblxuLyoqXG4gKiBFeHRyYWN0IHN0cmluZyByZXNvdXJjZXMgZnJvbSB0aGUgZ2l2ZW4gcGFja2FnZSBvbiBsb2NhbCBmaWxlIHN5c3RlbS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gYXBwUGF0aCAtIFRoZSBmdWxsIHBhdGggdG8gdGhlIC5hcGsocykgcGFja2FnZS5cbiAqIEBwYXJhbSB7P3N0cmluZ30gbGFuZ3VhZ2UgLSBUaGUgbmFtZSBvZiB0aGUgbGFuZ3VhZ2UgdG8gZXh0cmFjdCB0aGUgcmVzb3VyY2VzIGZvci5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUaGUgZGVmYXVsdCBsYW5ndWFnZSBpcyB1c2VkIGlmIHRoaXMgZXF1YWxzIHRvIGBudWxsYC9gdW5kZWZpbmVkYFxuICogQHBhcmFtIHtzdHJpbmd9IG91dCAtIFRoZSBuYW1lIG9mIHRoZSBkZXN0aW5hdGlvbiBmb2xkZXIgb24gdGhlIGxvY2FsIGZpbGUgc3lzdGVtIHRvXG4gKiAgICAgICAgICAgICAgICAgICAgICAgc3RvcmUgdGhlIGV4dHJhY3RlZCBmaWxlIHRvLlxuICogQHJldHVybiB7T2JqZWN0fSBBIG1hcHBpbmcgb2JqZWN0LCB3aGVyZSBwcm9wZXJ0aWVzIGFyZTogJ2Fwa1N0cmluZ3MnLCBjb250YWluaW5nXG4gKiAgICAgICAgICAgICAgICAgIHBhcnNlZCByZXNvdXJjZSBmaWxlIHJlcHJlc2VudGVkIGFzIEpTT04gb2JqZWN0LCBhbmQgJ2xvY2FsUGF0aCcsXG4gKiAgICAgICAgICAgICAgICAgIGNvbnRhaW5pbmcgdGhlIHBhdGggdG8gdGhlIGV4dHJhY3RlZCBmaWxlIG9uIHRoZSBsb2NhbCBmaWxlIHN5c3RlbS5cbiAqL1xuYXBrVXRpbHNNZXRob2RzLmV4dHJhY3RTdHJpbmdzRnJvbUFwayA9IGFzeW5jIGZ1bmN0aW9uIGV4dHJhY3RTdHJpbmdzRnJvbUFwayAoYXBwUGF0aCwgbGFuZ3VhZ2UsIG91dCkge1xuICBsb2cuZGVidWcoYEV4dHJhY3Rpbmcgc3RyaW5ncyBmcm9tIGZvciBsYW5ndWFnZTogJHtsYW5ndWFnZSB8fCAnZGVmYXVsdCd9YCk7XG4gIGlmIChhcHBQYXRoLmVuZHNXaXRoKEFQS1NfRVhURU5TSU9OKSkge1xuICAgIGFwcFBhdGggPSBhd2FpdCB0aGlzLmV4dHJhY3RMYW5ndWFnZUFwayhhcHBQYXRoLCBsYW5ndWFnZSk7XG4gIH1cbiAgYXdhaXQgdGhpcy5pbml0QWFwdCgpO1xuICBsZXQgcmF3QWFwdE91dHB1dDtcbiAgdHJ5IHtcbiAgICBjb25zdCB7c3Rkb3V0fSA9IGF3YWl0IGV4ZWModGhpcy5iaW5hcmllcy5hYXB0LCBbXG4gICAgICAnZCcsXG4gICAgICAnLS12YWx1ZXMnLFxuICAgICAgJ3Jlc291cmNlcycsXG4gICAgICBhcHBQYXRoLFxuICAgIF0pO1xuICAgIHJhd0FhcHRPdXRwdXQgPSBzdGRvdXQ7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBleHRyYWN0IHJlc291cmNlcyBmcm9tICcke2FwcFBhdGh9Jy4gT3JpZ2luYWwgZXJyb3I6ICR7ZS5tZXNzYWdlfWApO1xuICB9XG5cbiAgY29uc3QgZGVmYXVsdENvbmZpZ01hcmtlciA9ICcoZGVmYXVsdCknO1xuICBsZXQgY29uZmlnTWFya2VyID0gbGFuZ3VhZ2UgfHwgZGVmYXVsdENvbmZpZ01hcmtlcjtcbiAgaWYgKGNvbmZpZ01hcmtlci5pbmNsdWRlcygnLScpICYmICFjb25maWdNYXJrZXIuaW5jbHVkZXMoJy1yJykpIHtcbiAgICBjb25maWdNYXJrZXIgPSBjb25maWdNYXJrZXIucmVwbGFjZSgnLScsICctcicpO1xuICB9XG4gIGlmIChjb25maWdNYXJrZXIudG9Mb3dlckNhc2UoKS5zdGFydHNXaXRoKCdlbicpKSB7XG4gICAgLy8gQXNzdW1lIHRoZSAnZW4nIGNvbmZpZ3VyYXRpb24gaXMgdGhlIGRlZmF1bHQgb25lXG4gICAgY29uc3Qge3N0ZG91dH0gPSBhd2FpdCBleGVjKHRoaXMuYmluYXJpZXMuYWFwdCwgW1xuICAgICAgJ2QnLFxuICAgICAgJ2NvbmZpZ3VyYXRpb25zJyxcbiAgICAgIGFwcFBhdGgsXG4gICAgXSk7XG4gICAgY29uc3QgY29uZmlncyA9IHN0ZG91dC5zcGxpdChvcy5FT0wpO1xuICAgIGlmICghY29uZmlncy5pbmNsdWRlcyhjb25maWdNYXJrZXIpKSB7XG4gICAgICBsb2cuZGVidWcoYFRoZXJlIGlzIG5vICcke2NvbmZpZ01hcmtlcn0nIGNvbmZpZ3VyYXRpb24uIGAgK1xuICAgICAgICAgICAgICAgIGBSZXBsYWNpbmcgaXQgd2l0aCAnJHtkZWZhdWx0Q29uZmlnTWFya2VyfSdgKTtcbiAgICAgIGNvbmZpZ01hcmtlciA9IGRlZmF1bHRDb25maWdNYXJrZXI7XG4gICAgfVxuICB9XG5cbiAgY29uc3QgYXBrU3RyaW5ncyA9IHt9O1xuICBsZXQgaXNJbkNvbmZpZyA9IGZhbHNlO1xuICBsZXQgY3VycmVudFJlc291cmNlSWQgPSBudWxsO1xuICBsZXQgaXNJblBsdXJhbEdyb3VwID0gZmFsc2U7XG4gIGNvbnN0IHN0YXJ0c1dpdGhBbnkgPSAocywgYXJyKSA9PiBhcnIucmVkdWNlKChhY2MsIHgpID0+IGFjYyB8fCBzLnN0YXJ0c1dpdGgoeCksIGZhbHNlKTtcbiAgY29uc3Qgbm9ybWFsaXplU3RyaW5nTWF0Y2ggPSAocykgPT4gcy5yZXBsYWNlKC9cIiQvLCAnJykucmVwbGFjZSgvXlwiLywgJycpLnJlcGxhY2UoL1xcXFxcIi9nLCAnXCInKTtcbiAgZm9yIChjb25zdCBsaW5lIG9mIHJhd0FhcHRPdXRwdXQuc3BsaXQob3MuRU9MKSkge1xuICAgIGNvbnN0IHRyaW1tZWRMaW5lID0gbGluZS50cmltKCk7XG4gICAgaWYgKF8uaXNFbXB0eSh0cmltbWVkTGluZSkpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIGlmIChzdGFydHNXaXRoQW55KHRyaW1tZWRMaW5lLCBbJ2NvbmZpZycsICd0eXBlJywgJ3NwZWMnLCAnUGFja2FnZSddKSkge1xuICAgICAgaXNJbkNvbmZpZyA9IHRyaW1tZWRMaW5lLnN0YXJ0c1dpdGgoYGNvbmZpZyAke2NvbmZpZ01hcmtlcn06YCk7XG4gICAgICBjdXJyZW50UmVzb3VyY2VJZCA9IG51bGw7XG4gICAgICBpc0luUGx1cmFsR3JvdXAgPSBmYWxzZTtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIGlmICghaXNJbkNvbmZpZykge1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgaWYgKHRyaW1tZWRMaW5lLnN0YXJ0c1dpdGgoJ3Jlc291cmNlJykpIHtcbiAgICAgIGlzSW5QbHVyYWxHcm91cCA9IGZhbHNlO1xuICAgICAgY3VycmVudFJlc291cmNlSWQgPSBudWxsO1xuXG4gICAgICBpZiAodHJpbW1lZExpbmUuaW5jbHVkZXMoJzpzdHJpbmcvJykpIHtcbiAgICAgICAgY29uc3QgbWF0Y2ggPSAvOnN0cmluZ1xcLyhcXFMrKTovLmV4ZWModHJpbW1lZExpbmUpO1xuICAgICAgICBpZiAobWF0Y2gpIHtcbiAgICAgICAgICBjdXJyZW50UmVzb3VyY2VJZCA9IG1hdGNoWzFdO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHRyaW1tZWRMaW5lLmluY2x1ZGVzKCc6cGx1cmFscy8nKSkge1xuICAgICAgICBjb25zdCBtYXRjaCA9IC86cGx1cmFsc1xcLyhcXFMrKTovLmV4ZWModHJpbW1lZExpbmUpO1xuICAgICAgICBpZiAobWF0Y2gpIHtcbiAgICAgICAgICBjdXJyZW50UmVzb3VyY2VJZCA9IG1hdGNoWzFdO1xuICAgICAgICAgIGlzSW5QbHVyYWxHcm91cCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIGlmIChjdXJyZW50UmVzb3VyY2VJZCAmJiB0cmltbWVkTGluZS5zdGFydHNXaXRoKCcoc3RyaW5nJykpIHtcbiAgICAgIGNvbnN0IG1hdGNoID0gL1wiW15cIlxcXFxdKig/OlxcXFwuW15cIlxcXFxdKikqXCIvLmV4ZWModHJpbW1lZExpbmUpO1xuICAgICAgaWYgKG1hdGNoKSB7XG4gICAgICAgIGFwa1N0cmluZ3NbY3VycmVudFJlc291cmNlSWRdID0gbm9ybWFsaXplU3RyaW5nTWF0Y2gobWF0Y2hbMF0pO1xuICAgICAgfVxuICAgICAgY3VycmVudFJlc291cmNlSWQgPSBudWxsO1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgaWYgKGN1cnJlbnRSZXNvdXJjZUlkICYmIGlzSW5QbHVyYWxHcm91cCAmJiB0cmltbWVkTGluZS5pbmNsdWRlcygnOiAoc3RyaW5nJykpIHtcbiAgICAgIGNvbnN0IG1hdGNoID0gL1wiW15cIlxcXFxdKig/OlxcXFwuW15cIlxcXFxdKikqXCIvLmV4ZWModHJpbW1lZExpbmUpO1xuICAgICAgaWYgKG1hdGNoKSB7XG4gICAgICAgIGFwa1N0cmluZ3NbY3VycmVudFJlc291cmNlSWRdID0gW1xuICAgICAgICAgIC4uLihhcGtTdHJpbmdzW2N1cnJlbnRSZXNvdXJjZUlkXSB8fCBbXSksXG4gICAgICAgICAgbm9ybWFsaXplU3RyaW5nTWF0Y2gobWF0Y2hbMF0pLFxuICAgICAgICBdO1xuICAgICAgfVxuICAgICAgY29udGludWU7XG4gICAgfVxuICB9XG5cbiAgaWYgKF8uaXNFbXB0eShhcGtTdHJpbmdzKSkge1xuICAgIGxvZy53YXJuKGBObyBzdHJpbmdzIGhhdmUgYmVlbiBmb3VuZCBpbiAnJHthcHBQYXRofScgcmVzb3VyY2VzIGAgK1xuICAgICAgICAgICAgIGBmb3IgJyR7Y29uZmlnTWFya2VyfScgY29uZmlndXJhdGlvbmApO1xuICB9IGVsc2Uge1xuICAgIGxvZy5pbmZvKGBTdWNjZXNzZnVsbHkgZXh0cmFjdGVkICR7Xy5rZXlzKGFwa1N0cmluZ3MpLmxlbmd0aH0gc3RyaW5ncyBmcm9tICcke2FwcFBhdGh9JyByZXNvdXJjZXMgYCArXG4gICAgICAgICAgICAgYGZvciAnJHtjb25maWdNYXJrZXJ9JyBjb25maWd1cmF0aW9uYCk7XG4gIH1cblxuICBjb25zdCBsb2NhbFBhdGggPSBwYXRoLnJlc29sdmUob3V0LCAnc3RyaW5ncy5qc29uJyk7XG4gIGF3YWl0IG1rZGlycChvdXQpO1xuICBhd2FpdCBmcy53cml0ZUZpbGUobG9jYWxQYXRoLCBKU09OLnN0cmluZ2lmeShhcGtTdHJpbmdzLCBudWxsLCAyKSwgJ3V0Zi04Jyk7XG4gIHJldHVybiB7YXBrU3RyaW5ncywgbG9jYWxQYXRofTtcbn07XG5cbi8qKlxuICogR2V0IHRoZSBsYW5ndWFnZSBuYW1lIG9mIHRoZSBkZXZpY2UgdW5kZXIgdGVzdC5cbiAqXG4gKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBuYW1lIG9mIGRldmljZSBsYW5ndWFnZS5cbiAqL1xuYXBrVXRpbHNNZXRob2RzLmdldERldmljZUxhbmd1YWdlID0gYXN5bmMgZnVuY3Rpb24gZ2V0RGV2aWNlTGFuZ3VhZ2UgKCkge1xuICBsZXQgbGFuZ3VhZ2U7XG4gIGlmIChhd2FpdCB0aGlzLmdldEFwaUxldmVsKCkgPCAyMykge1xuICAgIGxhbmd1YWdlID0gYXdhaXQgdGhpcy5nZXREZXZpY2VTeXNMYW5ndWFnZSgpO1xuICAgIGlmICghbGFuZ3VhZ2UpIHtcbiAgICAgIGxhbmd1YWdlID0gYXdhaXQgdGhpcy5nZXREZXZpY2VQcm9kdWN0TGFuZ3VhZ2UoKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgbGFuZ3VhZ2UgPSAoYXdhaXQgdGhpcy5nZXREZXZpY2VMb2NhbGUoKSkuc3BsaXQoJy0nKVswXTtcbiAgfVxuICByZXR1cm4gbGFuZ3VhZ2U7XG59O1xuXG4vKipcbiAqIEdldCB0aGUgY291bnRyeSBuYW1lIG9mIHRoZSBkZXZpY2UgdW5kZXIgdGVzdC5cbiAqXG4gKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBuYW1lIG9mIGRldmljZSBjb3VudHJ5LlxuICovXG5hcGtVdGlsc01ldGhvZHMuZ2V0RGV2aWNlQ291bnRyeSA9IGFzeW5jIGZ1bmN0aW9uIGdldERldmljZUNvdW50cnkgKCkge1xuICAvLyB0aGlzIG1ldGhvZCBpcyBvbmx5IHVzZWQgaW4gQVBJIDwgMjNcbiAgbGV0IGNvdW50cnkgPSBhd2FpdCB0aGlzLmdldERldmljZVN5c0NvdW50cnkoKTtcbiAgaWYgKCFjb3VudHJ5KSB7XG4gICAgY291bnRyeSA9IGF3YWl0IHRoaXMuZ2V0RGV2aWNlUHJvZHVjdENvdW50cnkoKTtcbiAgfVxuICByZXR1cm4gY291bnRyeTtcbn07XG5cbi8qKlxuICogR2V0IHRoZSBsb2NhbGUgbmFtZSBvZiB0aGUgZGV2aWNlIHVuZGVyIHRlc3QuXG4gKlxuICogQHJldHVybiB7c3RyaW5nfSBUaGUgbmFtZSBvZiBkZXZpY2UgbG9jYWxlLlxuICovXG5hcGtVdGlsc01ldGhvZHMuZ2V0RGV2aWNlTG9jYWxlID0gYXN5bmMgZnVuY3Rpb24gZ2V0RGV2aWNlTG9jYWxlICgpIHtcbiAgLy8gdGhpcyBtZXRob2QgaXMgb25seSB1c2VkIGluIEFQSSA+PSAyM1xuICBsZXQgbG9jYWxlID0gYXdhaXQgdGhpcy5nZXREZXZpY2VTeXNMb2NhbGUoKTtcbiAgaWYgKCFsb2NhbGUpIHtcbiAgICBsb2NhbGUgPSBhd2FpdCB0aGlzLmdldERldmljZVByb2R1Y3RMb2NhbGUoKTtcbiAgfVxuICByZXR1cm4gbG9jYWxlO1xufTtcblxuLyoqXG4gKiBTZXQgdGhlIGxvY2FsZSBuYW1lIG9mIHRoZSBkZXZpY2UgdW5kZXIgdGVzdCBhbmQgdGhlIGZvcm1hdCBvZiB0aGUgbG9jYWxlIGlzIGVuLVVTLCBmb3IgZXhhbXBsZS5cbiAqIFRoaXMgbWV0aG9kIGNhbGwgc2V0RGV2aWNlTGFuZ3VhZ2VDb3VudHJ5LCBzbywgcGxlYXNlIHVzZSBzZXREZXZpY2VMYW5ndWFnZUNvdW50cnkgYXMgcG9zc2libGUuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGxvY2FsZSAtIE5hbWVzIG9mIHRoZSBkZXZpY2UgbGFuZ3VhZ2UgYW5kIHRoZSBjb3VudHJ5IGNvbm5lY3RlZCB3aXRoIGAtYC4gZS5nLiBlbi1VUy5cbiAqL1xuYXBrVXRpbHNNZXRob2RzLnNldERldmljZUxvY2FsZSA9IGFzeW5jIGZ1bmN0aW9uIHNldERldmljZUxvY2FsZSAobG9jYWxlKSB7XG4gIGNvbnN0IHZhbGlkYXRlTG9jYWxlID0gbmV3IFJlZ0V4cCgvW2EtekEtWl0rLVthLXpBLVowLTldKy8pO1xuICBpZiAoIXZhbGlkYXRlTG9jYWxlLnRlc3QobG9jYWxlKSkge1xuICAgIGxvZy53YXJuKGBzZXREZXZpY2VMb2NhbGUgcmVxdWlyZXMgdGhlIGZvbGxvd2luZyBmb3JtYXQ6IGVuLVVTIG9yIGphLUpQYCk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgbGV0IHNwbGl0X2xvY2FsZSA9IGxvY2FsZS5zcGxpdCgnLScpO1xuICBhd2FpdCB0aGlzLnNldERldmljZUxhbmd1YWdlQ291bnRyeShzcGxpdF9sb2NhbGVbMF0sIHNwbGl0X2xvY2FsZVsxXSk7XG59O1xuXG4vKipcbiAqIE1ha2Ugc3VyZSBjdXJyZW50IGRldmljZSBsb2NhbGUgaXMgZXhwZWN0ZWQgb3Igbm90LlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBsYW5ndWFnZSAtIExhbmd1YWdlLiBUaGUgbGFuZ3VhZ2UgZmllbGQgaXMgY2FzZSBpbnNlbnNpdGl2ZSwgYnV0IExvY2FsZSBhbHdheXMgY2Fub25pY2FsaXplcyB0byBsb3dlciBjYXNlLlxuICogQHBhcmFtIHtzdHJpbmd9IGNvdW50cnkgLSBDb3VudHJ5LiBUaGUgbGFuZ3VhZ2UgZmllbGQgaXMgY2FzZSBpbnNlbnNpdGl2ZSwgYnV0IExvY2FsZSBhbHdheXMgY2Fub25pY2FsaXplcyB0byBsb3dlciBjYXNlLlxuICogQHBhcmFtIHs/c3RyaW5nfSBzY3JpcHQgLSBTY3JpcHQuIFRoZSBzY3JpcHQgZmllbGQgaXMgY2FzZSBpbnNlbnNpdGl2ZSBidXQgTG9jYWxlIGFsd2F5cyBjYW5vbmljYWxpemVzIHRvIHRpdGxlIGNhc2UuXG4gKlxuICogQHJldHVybiB7Ym9vbGVhbn0gSWYgY3VycmVudCBsb2NhbGUgaXMgbGFuZ3VhZ2UgYW5kIGNvdW50cnkgYXMgYXJndW1lbnRzLCByZXR1cm4gdHJ1ZS5cbiAqL1xuYXBrVXRpbHNNZXRob2RzLmVuc3VyZUN1cnJlbnRMb2NhbGUgPSBhc3luYyBmdW5jdGlvbiBlbnN1cmVDdXJyZW50TG9jYWxlIChsYW5ndWFnZSwgY291bnRyeSwgc2NyaXB0ID0gbnVsbCkge1xuICBjb25zdCBoYXNMYW5ndWFnZSA9IF8uaXNTdHJpbmcobGFuZ3VhZ2UpO1xuICBjb25zdCBoYXNDb3VudHJ5ID0gXy5pc1N0cmluZyhjb3VudHJ5KTtcblxuICBpZiAoIWhhc0xhbmd1YWdlICYmICFoYXNDb3VudHJ5KSB7XG4gICAgbG9nLndhcm4oJ2Vuc3VyZUN1cnJlbnRMb2NhbGUgcmVxdWlyZXMgbGFuZ3VhZ2Ugb3IgY291bnRyeScpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8vIGdldCBsb3dlciBjYXNlIHZlcnNpb25zIG9mIHRoZSBzdHJpbmdzXG4gIGxhbmd1YWdlID0gKGxhbmd1YWdlIHx8ICcnKS50b0xvd2VyQ2FzZSgpO1xuICBjb3VudHJ5ID0gKGNvdW50cnkgfHwgJycpLnRvTG93ZXJDYXNlKCk7XG5cbiAgY29uc3QgYXBpTGV2ZWwgPSBhd2FpdCB0aGlzLmdldEFwaUxldmVsKCk7XG5cbiAgcmV0dXJuIGF3YWl0IHJldHJ5SW50ZXJ2YWwoNSwgMTAwMCwgYXN5bmMgKCkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBpZiAoYXBpTGV2ZWwgPCAyMykge1xuICAgICAgICBsZXQgY3VyTGFuZ3VhZ2UsIGN1ckNvdW50cnk7XG4gICAgICAgIGlmIChoYXNMYW5ndWFnZSkge1xuICAgICAgICAgIGN1ckxhbmd1YWdlID0gKGF3YWl0IHRoaXMuZ2V0RGV2aWNlTGFuZ3VhZ2UoKSkudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICBpZiAoIWhhc0NvdW50cnkgJiYgbGFuZ3VhZ2UgPT09IGN1ckxhbmd1YWdlKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGhhc0NvdW50cnkpIHtcbiAgICAgICAgICBjdXJDb3VudHJ5ID0gKGF3YWl0IHRoaXMuZ2V0RGV2aWNlQ291bnRyeSgpKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgIGlmICghaGFzTGFuZ3VhZ2UgJiYgY291bnRyeSA9PT0gY3VyQ291bnRyeSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChsYW5ndWFnZSA9PT0gY3VyTGFuZ3VhZ2UgJiYgY291bnRyeSA9PT0gY3VyQ291bnRyeSkge1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBjdXJMb2NhbGUgPSAoYXdhaXQgdGhpcy5nZXREZXZpY2VMb2NhbGUoKSkudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgLy8gemgtaGFucy1jbiA6IHpoLWNuXG4gICAgICAgIGNvbnN0IGxvY2FsZUNvZGUgPSBzY3JpcHQgPyBgJHtsYW5ndWFnZX0tJHtzY3JpcHQudG9Mb3dlckNhc2UoKX0tJHtjb3VudHJ5fWAgOiBgJHtsYW5ndWFnZX0tJHtjb3VudHJ5fWA7XG5cbiAgICAgICAgaWYgKGxvY2FsZUNvZGUgPT09IGN1ckxvY2FsZSkge1xuICAgICAgICAgIGxvZy5kZWJ1ZyhgUmVxdWVzdGVkIGxvY2FsZSBpcyBlcXVhbCB0byBjdXJyZW50IGxvY2FsZTogJyR7Y3VyTG9jYWxlfSdgKTtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgLy8gaWYgdGhlcmUgaGFzIGJlZW4gYW4gZXJyb3IsIHJlc3RhcnQgYWRiIGFuZCByZXRyeVxuICAgICAgbG9nLmVycm9yKGBVbmFibGUgdG8gY2hlY2sgZGV2aWNlIGxvY2FsaXphdGlvbjogJHtlcnIubWVzc2FnZX1gKTtcbiAgICAgIGxvZy5kZWJ1ZygnUmVzdGFydGluZyBBREIgYW5kIHJldHJ5aW5nLi4uJyk7XG4gICAgICBhd2FpdCB0aGlzLnJlc3RhcnRBZGIoKTtcbiAgICAgIHRocm93IGVycjtcbiAgICB9XG4gIH0pO1xufTtcblxuLyoqXG4gKiBTZXQgdGhlIGxvY2FsZSBuYW1lIG9mIHRoZSBkZXZpY2UgdW5kZXIgdGVzdC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gbGFuZ3VhZ2UgLSBMYW5ndWFnZS4gVGhlIGxhbmd1YWdlIGZpZWxkIGlzIGNhc2UgaW5zZW5zaXRpdmUsIGJ1dCBMb2NhbGUgYWx3YXlzIGNhbm9uaWNhbGl6ZXMgdG8gbG93ZXIgY2FzZS5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdDogW2EtekEtWl17Miw4fS4gZS5nLiBlbiwgamEgOiBodHRwczovL2RldmVsb3Blci5hbmRyb2lkLmNvbS9yZWZlcmVuY2UvamF2YS91dGlsL0xvY2FsZS5odG1sXG4gKiBAcGFyYW0ge3N0cmluZ30gY291bnRyeSAtIENvdW50cnkuIFRoZSBjb3VudHJ5IChyZWdpb24pIGZpZWxkIGlzIGNhc2UgaW5zZW5zaXRpdmUsIGJ1dCBMb2NhbGUgYWx3YXlzIGNhbm9uaWNhbGl6ZXMgdG8gdXBwZXIgY2FzZS5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdDogW2EtekEtWl17Mn0gfCBbMC05XXszfS4gZS5nLiBVUywgSlAgOiBodHRwczovL2RldmVsb3Blci5hbmRyb2lkLmNvbS9yZWZlcmVuY2UvamF2YS91dGlsL0xvY2FsZS5odG1sXG4gKiBAcGFyYW0gez9zdHJpbmd9IHNjcmlwdCAtIFNjcmlwdC4gVGhlIHNjcmlwdCBmaWVsZCBpcyBjYXNlIGluc2Vuc2l0aXZlIGJ1dCBMb2NhbGUgYWx3YXlzIGNhbm9uaWNhbGl6ZXMgdG8gdGl0bGUgY2FzZS5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdDogW2EtekEtWl17NH0uIGUuZy4gSGFucyBpbiB6aC1IYW5zLUNOIDogaHR0cHM6Ly9kZXZlbG9wZXIuYW5kcm9pZC5jb20vcmVmZXJlbmNlL2phdmEvdXRpbC9Mb2NhbGUuaHRtbFxuICovXG5hcGtVdGlsc01ldGhvZHMuc2V0RGV2aWNlTGFuZ3VhZ2VDb3VudHJ5ID0gYXN5bmMgZnVuY3Rpb24gc2V0RGV2aWNlTGFuZ3VhZ2VDb3VudHJ5IChsYW5ndWFnZSwgY291bnRyeSwgc2NyaXB0ID0gbnVsbCkge1xuICBsZXQgaGFzTGFuZ3VhZ2UgPSBsYW5ndWFnZSAmJiBfLmlzU3RyaW5nKGxhbmd1YWdlKTtcbiAgbGV0IGhhc0NvdW50cnkgPSBjb3VudHJ5ICYmIF8uaXNTdHJpbmcoY291bnRyeSk7XG4gIGlmICghaGFzTGFuZ3VhZ2UgfHwgIWhhc0NvdW50cnkpIHtcbiAgICBsb2cud2Fybihgc2V0RGV2aWNlTGFuZ3VhZ2VDb3VudHJ5IHJlcXVpcmVzIGxhbmd1YWdlIGFuZCBjb3VudHJ5IGF0IGxlYXN0YCk7XG4gICAgbG9nLndhcm4oYEdvdCBsYW5ndWFnZTogJyR7bGFuZ3VhZ2V9JyBhbmQgY291bnRyeTogJyR7Y291bnRyeX0nYCk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGxldCBhcGlMZXZlbCA9IGF3YWl0IHRoaXMuZ2V0QXBpTGV2ZWwoKTtcblxuICBsYW5ndWFnZSA9IChsYW5ndWFnZSB8fCAnJykudG9Mb3dlckNhc2UoKTtcbiAgY291bnRyeSA9IChjb3VudHJ5IHx8ICcnKS50b1VwcGVyQ2FzZSgpO1xuXG4gIGlmIChhcGlMZXZlbCA8IDIzKSB7XG4gICAgbGV0IGN1ckxhbmd1YWdlID0gKGF3YWl0IHRoaXMuZ2V0RGV2aWNlTGFuZ3VhZ2UoKSkudG9Mb3dlckNhc2UoKTtcbiAgICBsZXQgY3VyQ291bnRyeSA9IChhd2FpdCB0aGlzLmdldERldmljZUNvdW50cnkoKSkudG9VcHBlckNhc2UoKTtcblxuICAgIGlmIChsYW5ndWFnZSAhPT0gY3VyTGFuZ3VhZ2UgfHwgY291bnRyeSAhPT0gY3VyQ291bnRyeSkge1xuICAgICAgYXdhaXQgdGhpcy5zZXREZXZpY2VTeXNMb2NhbGVWaWFTZXR0aW5nQXBwKGxhbmd1YWdlLCBjb3VudHJ5KTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgbGV0IGN1ckxvY2FsZSA9IGF3YWl0IHRoaXMuZ2V0RGV2aWNlTG9jYWxlKCk7XG5cbiAgICAvLyB6aC1IYW5zLUNOIDogemgtQ05cbiAgICBjb25zdCBsb2NhbGVDb2RlID0gc2NyaXB0ID8gYCR7bGFuZ3VhZ2V9LSR7c2NyaXB0fS0ke2NvdW50cnl9YCA6IGAke2xhbmd1YWdlfS0ke2NvdW50cnl9YDtcbiAgICBsb2cuZGVidWcoYEN1cnJlbnQgbG9jYWxlOiAnJHtjdXJMb2NhbGV9JzsgcmVxdWVzdGVkIGxvY2FsZTogJyR7bG9jYWxlQ29kZX0nYCk7XG4gICAgaWYgKGxvY2FsZUNvZGUudG9Mb3dlckNhc2UoKSAhPT0gY3VyTG9jYWxlLnRvTG93ZXJDYXNlKCkpIHtcbiAgICAgIGF3YWl0IHRoaXMuc2V0RGV2aWNlU3lzTG9jYWxlVmlhU2V0dGluZ0FwcChsYW5ndWFnZSwgY291bnRyeSwgc2NyaXB0KTtcbiAgICB9XG4gIH1cbn07XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gQXBwSW5mb1xuICogQHByb3BlcnR5IHtzdHJpbmd9IG5hbWUgLSBQYWNrYWdlIG5hbWUsIGZvciBleGFtcGxlICdjb20uYWNtZS5hcHAnLlxuICogQHByb3BlcnR5IHtudW1iZXJ9IHZlcnNpb25Db2RlIC0gVmVyc2lvbiBjb2RlLlxuICogQHByb3BlcnR5IHtzdHJpbmd9IHZlcnNpb25OYW1lIC0gVmVyc2lvbiBuYW1lLCBmb3IgZXhhbXBsZSAnMS4wJy5cbiAqL1xuXG4vKipcbiAqIEdldCB0aGUgcGFja2FnZSBpbmZvIGZyb20gbG9jYWwgYXBrIGZpbGUuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGFwcFBhdGggLSBUaGUgZnVsbCBwYXRoIHRvIGV4aXN0aW5nIC5hcGsocykgcGFja2FnZSBvbiB0aGUgbG9jYWxcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZSBzeXN0ZW0uXG4gKiBAcmV0dXJuIHs/QXBwSW5mb30gVGhlIHBhcnNlZCBhcHBsaWNhdGlvbiBpbmZvcm1hdGlvbi5cbiAqL1xuYXBrVXRpbHNNZXRob2RzLmdldEFwa0luZm8gPSBhc3luYyBmdW5jdGlvbiBnZXRBcGtJbmZvIChhcHBQYXRoKSB7XG4gIGlmICghYXdhaXQgZnMuZXhpc3RzKGFwcFBhdGgpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgZmlsZSBhdCBwYXRoICR7YXBwUGF0aH0gZG9lcyBub3QgZXhpc3Qgb3IgaXMgbm90IGFjY2Vzc2libGVgKTtcbiAgfVxuXG4gIGlmIChhcHBQYXRoLmVuZHNXaXRoKEFQS1NfRVhURU5TSU9OKSkge1xuICAgIGFwcFBhdGggPSBhd2FpdCB0aGlzLmV4dHJhY3RCYXNlQXBrKGFwcFBhdGgpO1xuICB9XG5cbiAgYXdhaXQgdGhpcy5pbml0QWFwdCgpO1xuICB0cnkge1xuICAgIGNvbnN0IHtzdGRvdXR9ID0gYXdhaXQgZXhlYyh0aGlzLmJpbmFyaWVzLmFhcHQsIFsnZCcsICdiYWRnaW5nJywgYXBwUGF0aF0pO1xuICAgIGNvbnN0IG1hdGNoZXMgPSBuZXcgUmVnRXhwKC9wYWNrYWdlOiBuYW1lPScoW14nXSspJyB2ZXJzaW9uQ29kZT0nKFxcZCspJyB2ZXJzaW9uTmFtZT0nKFteJ10rKScvKS5leGVjKHN0ZG91dCk7XG4gICAgaWYgKG1hdGNoZXMpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG5hbWU6IG1hdGNoZXNbMV0sXG4gICAgICAgIHZlcnNpb25Db2RlOiBwYXJzZUludChtYXRjaGVzWzJdLCAxMCksXG4gICAgICAgIHZlcnNpb25OYW1lOiBtYXRjaGVzWzNdXG4gICAgICB9O1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbG9nLndhcm4oYEVycm9yIFwiJHtlcnIubWVzc2FnZX1cIiB3aGlsZSBnZXR0aW5nIGJhZGdpbmcgaW5mb2ApO1xuICB9XG4gIHJldHVybiB7fTtcbn07XG5cbi8qKlxuICogR2V0IHRoZSBwYWNrYWdlIGluZm8gZnJvbSB0aGUgaW5zdGFsbGVkIGFwcGxpY2F0aW9uLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBwa2cgLSBUaGUgbmFtZSBvZiB0aGUgaW5zdGFsbGVkIHBhY2thZ2UuXG4gKiBAcmV0dXJuIHs/QXBwSW5mb30gVGhlIHBhcnNlZCBhcHBsaWNhdGlvbiBpbmZvcm1hdGlvbi5cbiAqL1xuYXBrVXRpbHNNZXRob2RzLmdldFBhY2thZ2VJbmZvID0gYXN5bmMgZnVuY3Rpb24gZ2V0UGFja2FnZUluZm8gKHBrZykge1xuICBsb2cuZGVidWcoYEdldHRpbmcgcGFja2FnZSBpbmZvIGZvciAnJHtwa2d9J2ApO1xuICBsZXQgcmVzdWx0ID0ge25hbWU6IHBrZ307XG4gIHRyeSB7XG4gICAgY29uc3Qgc3Rkb3V0ID0gYXdhaXQgdGhpcy5zaGVsbChbJ2R1bXBzeXMnLCAncGFja2FnZScsIHBrZ10pO1xuICAgIGNvbnN0IHZlcnNpb25OYW1lTWF0Y2ggPSBuZXcgUmVnRXhwKC92ZXJzaW9uTmFtZT0oW1xcZCsuXSspLykuZXhlYyhzdGRvdXQpO1xuICAgIGlmICh2ZXJzaW9uTmFtZU1hdGNoKSB7XG4gICAgICByZXN1bHQudmVyc2lvbk5hbWUgPSB2ZXJzaW9uTmFtZU1hdGNoWzFdO1xuICAgIH1cbiAgICBjb25zdCB2ZXJzaW9uQ29kZU1hdGNoID0gbmV3IFJlZ0V4cCgvdmVyc2lvbkNvZGU9KFxcZCspLykuZXhlYyhzdGRvdXQpO1xuICAgIGlmICh2ZXJzaW9uQ29kZU1hdGNoKSB7XG4gICAgICByZXN1bHQudmVyc2lvbkNvZGUgPSBwYXJzZUludCh2ZXJzaW9uQ29kZU1hdGNoWzFdLCAxMCk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxvZy53YXJuKGBFcnJvciAnJHtlcnIubWVzc2FnZX0nIHdoaWxlIGR1bXBpbmcgcGFja2FnZSBpbmZvYCk7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn07XG5cbmFwa1V0aWxzTWV0aG9kcy5wdWxsQXBrID0gYXN5bmMgZnVuY3Rpb24gcHVsbEFwayAocGtnLCB0bXBEaXIpIHtcbiAgY29uc3QgcGtnUGF0aCA9IChhd2FpdCB0aGlzLmFkYkV4ZWMoWydzaGVsbCcsICdwbScsICdwYXRoJywgcGtnXSkpLnJlcGxhY2UoJ3BhY2thZ2U6JywgJycpO1xuICBjb25zdCB0bXBBcHAgPSBwYXRoLnJlc29sdmUodG1wRGlyLCBgJHtwa2d9LmFwa2ApO1xuICBhd2FpdCB0aGlzLnB1bGwocGtnUGF0aCwgdG1wQXBwKTtcbiAgbG9nLmRlYnVnKGBQdWxsZWQgYXBwIGZvciBwYWNrYWdlICcke3BrZ30nIHRvICcke3RtcEFwcH0nYCk7XG4gIHJldHVybiB0bXBBcHA7XG59O1xuXG5leHBvcnQgeyBSRU1PVEVfQ0FDSEVfUk9PVCB9O1xuZXhwb3J0IGRlZmF1bHQgYXBrVXRpbHNNZXRob2RzO1xuIl0sImZpbGUiOiJsaWIvdG9vbHMvYXBrLXV0aWxzLmpzIiwic291cmNlUm9vdCI6Ii4uLy4uLy4uIn0=
