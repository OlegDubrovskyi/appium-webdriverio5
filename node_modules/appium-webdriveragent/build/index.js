"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.checkForDependencies = checkForDependencies;
exports.PROJECT_FILE = exports.WDA_RUNNER_BUNDLE_ID = exports.WDA_BUNDLE_ID = exports.BOOTSTRAP_PATH = void 0;

require("source-map-support/register");

var _appiumSupport = require("appium-support");

var _nodeSimctl = require("node-simctl");

var _asyncbox = require("asyncbox");

var _lodash = _interopRequireDefault(require("lodash"));

var _teen_process = require("teen_process");

var _path = _interopRequireDefault(require("path"));

var _os = require("os");

var _utils = require("./lib/utils");

const log = _appiumSupport.logger.getLogger('WebDriverAgent');

const execLogger = {
  logNonEmptyLines(data, fn) {
    data = Buffer.isBuffer(data) ? data.toString() : data;

    for (const line of data.split(_os.EOL)) {
      if (line) {
        fn(line);
      }
    }
  },

  debug(data) {
    this.logNonEmptyLines(data, log.debug.bind(log));
  },

  error(data) {
    this.logNonEmptyLines(data, log.error.bind(log));
  }

};
const IOS = 'iOS';
const TVOS = 'tvOS';
const CARTHAGE_CMD = 'carthage';
const CARTFILE = 'Cartfile.resolved';
const CARTHAGE_ROOT = 'Carthage';
const BOOTSTRAP_PATH = __dirname.endsWith('build') ? _path.default.resolve(__dirname, '..') : __dirname;
exports.BOOTSTRAP_PATH = BOOTSTRAP_PATH;
const WDA_BUNDLE_ID = 'com.apple.test.WebDriverAgentRunner-Runner';
exports.WDA_BUNDLE_ID = WDA_BUNDLE_ID;
const WDA_RUNNER_BUNDLE_ID = 'com.facebook.WebDriverAgentRunner';
exports.WDA_RUNNER_BUNDLE_ID = WDA_RUNNER_BUNDLE_ID;
const PROJECT_FILE = 'project.pbxproj';
exports.PROJECT_FILE = PROJECT_FILE;

async function hasTvOSSims() {
  const devices = _lodash.default.flatten(Object.values((await (0, _nodeSimctl.getDevices)(null, TVOS))));

  return !_lodash.default.isEmpty(devices);
}

function getCartfileLocations() {
  const cartfile = _path.default.resolve(BOOTSTRAP_PATH, CARTFILE);

  const installedCartfile = _path.default.resolve(BOOTSTRAP_PATH, CARTHAGE_ROOT, CARTFILE);

  return {
    cartfile,
    installedCartfile
  };
}

async function needsUpdate(cartfile, installedCartfile) {
  return !(await (0, _utils.fileCompare)(cartfile, installedCartfile));
}

async function fetchDependencies(useSsl = false) {
  log.info('Fetching dependencies');

  if (!(await _appiumSupport.fs.which(CARTHAGE_CMD))) {
    log.errorAndThrow('Please make sure that you have Carthage installed (https://github.com/Carthage/Carthage)');
  }

  const {
    cartfile,
    installedCartfile
  } = getCartfileLocations();

  if (!(await needsUpdate(cartfile, installedCartfile))) {
    log.info('Dependencies up-to-date');
    return false;
  }

  let platforms = [IOS];

  if (await hasTvOSSims()) {
    platforms.push(TVOS);
  } else {
    log.debug('tvOS platform will not be included into Carthage bootstrap, because no Simulator devices have been created for it');
  }

  log.info(`Installing/updating dependencies for platforms ${platforms.map(p => `'${p}'`).join(', ')}`);
  let args = ['bootstrap'];

  if (useSsl) {
    args.push('--use-ssh');
  }

  args.push('--platform', platforms.join(','));

  try {
    await (0, _teen_process.exec)(CARTHAGE_CMD, args, {
      logger: execLogger,
      cwd: BOOTSTRAP_PATH
    });
  } catch (err) {
    await _appiumSupport.fs.rimraf(_path.default.resolve(BOOTSTRAP_PATH, CARTHAGE_ROOT));
    throw err;
  }

  await _appiumSupport.fs.copyFile(cartfile, installedCartfile);
  log.debug(`Finished fetching dependencies`);
  return true;
}

async function checkForDependencies(opts = {}) {
  return await fetchDependencies(opts.useSsl);
}

if (require.main === module) {
  (0, _asyncbox.asyncify)(checkForDependencies);
}require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbImxvZyIsImxvZ2dlciIsImdldExvZ2dlciIsImV4ZWNMb2dnZXIiLCJsb2dOb25FbXB0eUxpbmVzIiwiZGF0YSIsImZuIiwiQnVmZmVyIiwiaXNCdWZmZXIiLCJ0b1N0cmluZyIsImxpbmUiLCJzcGxpdCIsIkVPTCIsImRlYnVnIiwiYmluZCIsImVycm9yIiwiSU9TIiwiVFZPUyIsIkNBUlRIQUdFX0NNRCIsIkNBUlRGSUxFIiwiQ0FSVEhBR0VfUk9PVCIsIkJPT1RTVFJBUF9QQVRIIiwiX19kaXJuYW1lIiwiZW5kc1dpdGgiLCJwYXRoIiwicmVzb2x2ZSIsIldEQV9CVU5ETEVfSUQiLCJXREFfUlVOTkVSX0JVTkRMRV9JRCIsIlBST0pFQ1RfRklMRSIsImhhc1R2T1NTaW1zIiwiZGV2aWNlcyIsIl8iLCJmbGF0dGVuIiwiT2JqZWN0IiwidmFsdWVzIiwiaXNFbXB0eSIsImdldENhcnRmaWxlTG9jYXRpb25zIiwiY2FydGZpbGUiLCJpbnN0YWxsZWRDYXJ0ZmlsZSIsIm5lZWRzVXBkYXRlIiwiZmV0Y2hEZXBlbmRlbmNpZXMiLCJ1c2VTc2wiLCJpbmZvIiwiZnMiLCJ3aGljaCIsImVycm9yQW5kVGhyb3ciLCJwbGF0Zm9ybXMiLCJwdXNoIiwibWFwIiwicCIsImpvaW4iLCJhcmdzIiwiY3dkIiwiZXJyIiwicmltcmFmIiwiY29weUZpbGUiLCJjaGVja0ZvckRlcGVuZGVuY2llcyIsIm9wdHMiLCJyZXF1aXJlIiwibWFpbiIsIm1vZHVsZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBR0EsTUFBTUEsR0FBRyxHQUFHQyxzQkFBT0MsU0FBUCxDQUFpQixnQkFBakIsQ0FBWjs7QUFDQSxNQUFNQyxVQUFVLEdBQUc7QUFFakJDLEVBQUFBLGdCQUFnQixDQUFFQyxJQUFGLEVBQVFDLEVBQVIsRUFBWTtBQUMxQkQsSUFBQUEsSUFBSSxH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SWlCLE9BQU8sQ0FBQ0MsSUFBUixLQUFpQkMsTUFBckIsRUFBNkI7QUFDM0IsMEJBQVNKLG9CQUFUO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBmcywgbG9nZ2VyIH0gZnJvbSAnYXBwaXVtLXN1cHBvcnQnO1xuaW1wb3J0IHsgZ2V0RGV2aWNlcyB9IGZyb20gJ25vZGUtc2ltY3RsJztcbmltcG9ydCB7IGFzeW5jaWZ5IH0gZnJvbSAnYXN5bmNib3gnO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7IGV4ZWMgfSBmcm9tICd0ZWVuX3Byb2Nlc3MnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgeyBFT0wgfSBmcm9tICdvcyc7XG5pbXBvcnQgeyBmaWxlQ29tcGFyZSB9IGZyb20gJy4vbGliL3V0aWxzJztcblxuXG5jb25zdCBsb2cgPSBsb2dnZXIuZ2V0TG9nZ2VyKCdXZWJEcml2ZXJBZ2VudCcpO1xuY29uc3QgZXhlY0xvZ2dlciA9IHtcbiAgLy8gbG9nZ2VyIHRoYXQgZ2V0cyByaWQgb2YgZW1wdHkgbGluZXNcbiAgbG9nTm9uRW1wdHlMaW5lcyAoZGF0YSwgZm4pIHtcbiAgICBkYXRhID0gQnVmZmVyLmlzQnVmZmVyKGRhdGEpID8gZGF0YS50b1N0cmluZygpIDogZGF0YTtcbiAgICBmb3IgKGNvbnN0IGxpbmUgb2YgZGF0YS5zcGxpdChFT0wpKSB7XG4gICAgICBpZiAobGluZSkge1xuICAgICAgICBmbihsaW5lKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIGRlYnVnIChkYXRhKSB7XG4gICAgdGhpcy5sb2dOb25FbXB0eUxpbmVzKGRhdGEsIGxvZy5kZWJ1Zy5iaW5kKGxvZykpO1xuICB9LFxuICBlcnJvciAoZGF0YSkge1xuICAgIHRoaXMubG9nTm9uRW1wdHlMaW5lcyhkYXRhLCBsb2cuZXJyb3IuYmluZChsb2cpKTtcbiAgfSxcbn07XG5cbmNvbnN0IElPUyA9ICdpT1MnO1xuY29uc3QgVFZPUyA9ICd0dk9TJztcblxuY29uc3QgQ0FSVEhBR0VfQ01EID0gJ2NhcnRoYWdlJztcbmNvbnN0IENBUlRGSUxFID0gJ0NhcnRmaWxlLnJlc29sdmVkJztcbmNvbnN0IENBUlRIQUdFX1JPT1QgPSAnQ2FydGhhZ2UnO1xuXG5jb25zdCBCT09UU1RSQVBfUEFUSCA9IF9fZGlybmFtZS5lbmRzV2l0aCgnYnVpbGQnKVxuICA/IHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsICcuLicpXG4gIDogX19kaXJuYW1lO1xuY29uc3QgV0RBX0JVTkRMRV9JRCA9ICdjb20uYXBwbGUudGVzdC5XZWJEcml2ZXJBZ2VudFJ1bm5lci1SdW5uZXInO1xuY29uc3QgV0RBX1JVTk5FUl9CVU5ETEVfSUQgPSAnY29tLmZhY2Vib29rLldlYkRyaXZlckFnZW50UnVubmVyJztcbmNvbnN0IFBST0pFQ1RfRklMRSA9ICdwcm9qZWN0LnBieHByb2onO1xuXG5hc3luYyBmdW5jdGlvbiBoYXNUdk9TU2ltcyAoKSB7XG4gIGNvbnN0IGRldmljZXMgPSBfLmZsYXR0ZW4oT2JqZWN0LnZhbHVlcyhhd2FpdCBnZXREZXZpY2VzKG51bGwsIFRWT1MpKSk7XG4gIHJldHVybiAhXy5pc0VtcHR5KGRldmljZXMpO1xufVxuXG5mdW5jdGlvbiBnZXRDYXJ0ZmlsZUxvY2F0aW9ucyAoKSB7XG4gIGNvbnN0IGNhcnRmaWxlID0gcGF0aC5yZXNvbHZlKEJPT1RTVFJBUF9QQVRILCBDQVJURklMRSk7XG4gIGNvbnN0IGluc3RhbGxlZENhcnRmaWxlID0gcGF0aC5yZXNvbHZlKEJPT1RTVFJBUF9QQVRILCBDQVJUSEFHRV9ST09ULCBDQVJURklMRSk7XG5cbiAgcmV0dXJuIHtcbiAgICBjYXJ0ZmlsZSxcbiAgICBpbnN0YWxsZWRDYXJ0ZmlsZSxcbiAgfTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gbmVlZHNVcGRhdGUgKGNhcnRmaWxlLCBpbnN0YWxsZWRDYXJ0ZmlsZSkge1xuICByZXR1cm4gIWF3YWl0IGZpbGVDb21wYXJlKGNhcnRmaWxlLCBpbnN0YWxsZWRDYXJ0ZmlsZSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGZldGNoRGVwZW5kZW5jaWVzICh1c2VTc2wgPSBmYWxzZSkge1xuICBsb2cuaW5mbygnRmV0Y2hpbmcgZGVwZW5kZW5jaWVzJyk7XG4gIGlmICghYXdhaXQgZnMud2hpY2goQ0FSVEhBR0VfQ01EKSkge1xuICAgIGxvZy5lcnJvckFuZFRocm93KCdQbGVhc2UgbWFrZSBzdXJlIHRoYXQgeW91IGhhdmUgQ2FydGhhZ2UgaW5zdGFsbGVkIChodHRwczovL2dpdGh1Yi5jb20vQ2FydGhhZ2UvQ2FydGhhZ2UpJyk7XG4gIH1cblxuICAvLyBjaGVjayB0aGF0IHRoZSBkZXBlbmRlbmNpZXMgZG8gbm90IG5lZWQgdG8gYmUgdXBkYXRlZFxuICBjb25zdCB7XG4gICAgY2FydGZpbGUsXG4gICAgaW5zdGFsbGVkQ2FydGZpbGUsXG4gIH0gPSBnZXRDYXJ0ZmlsZUxvY2F0aW9ucygpO1xuXG4gIGlmICghYXdhaXQgbmVlZHNVcGRhdGUoY2FydGZpbGUsIGluc3RhbGxlZENhcnRmaWxlKSkge1xuICAgIC8vIGZpbGVzIGFyZSBpZGVudGljYWxcbiAgICBsb2cuaW5mbygnRGVwZW5kZW5jaWVzIHVwLXRvLWRhdGUnKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBsZXQgcGxhdGZvcm1zID0gW0lPU107XG4gIGlmIChhd2FpdCBoYXNUdk9TU2ltcygpKSB7XG4gICAgcGxhdGZvcm1zLnB1c2goVFZPUyk7XG4gIH0gZWxzZSB7XG4gICAgbG9nLmRlYnVnKCd0dk9TIHBsYXRmb3JtIHdpbGwgbm90IGJlIGluY2x1ZGVkIGludG8gQ2FydGhhZ2UgYm9vdHN0cmFwLCBiZWNhdXNlIG5vIFNpbXVsYXRvciBkZXZpY2VzIGhhdmUgYmVlbiBjcmVhdGVkIGZvciBpdCcpO1xuICB9XG5cbiAgbG9nLmluZm8oYEluc3RhbGxpbmcvdXBkYXRpbmcgZGVwZW5kZW5jaWVzIGZvciBwbGF0Zm9ybXMgJHtwbGF0Zm9ybXMubWFwKChwKSA9PiBgJyR7cH0nYCkuam9pbignLCAnKX1gKTtcblxuICBsZXQgYXJncyA9IFsnYm9vdHN0cmFwJ107XG4gIGlmICh1c2VTc2wpIHtcbiAgICBhcmdzLnB1c2goJy0tdXNlLXNzaCcpO1xuICB9XG4gIGFyZ3MucHVzaCgnLS1wbGF0Zm9ybScsIHBsYXRmb3Jtcy5qb2luKCcsJykpO1xuICB0cnkge1xuICAgIGF3YWl0IGV4ZWMoQ0FSVEhBR0VfQ01ELCBhcmdzLCB7XG4gICAgICBsb2dnZXI6IGV4ZWNMb2dnZXIsXG4gICAgICBjd2Q6IEJPT1RTVFJBUF9QQVRILFxuICAgIH0pO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICAvLyByZW1vdmUgdGhlIGNhcnRoYWdlIGRpcmVjdG9yeSwgb3IgZWxzZSBzdWJzZXF1ZW50IHJ1bnMgd2lsbCBzZWUgaXQgYW5kXG4gICAgLy8gYXNzdW1lIHRoZSBkZXBlbmRlbmNpZXMgYXJlIGFscmVhZHkgZG93bmxvYWRlZFxuICAgIGF3YWl0IGZzLnJpbXJhZihwYXRoLnJlc29sdmUoQk9PVFNUUkFQX1BBVEgsIENBUlRIQUdFX1JPT1QpKTtcbiAgICB0aHJvdyBlcnI7XG4gIH1cblxuICAvLyBwdXQgdGhlIHJlc29sdmVkIGNhcnRmaWxlIGludG8gdGhlIENhcnRoYWdlIGRpcmVjdG9yeVxuICBhd2FpdCBmcy5jb3B5RmlsZShjYXJ0ZmlsZSwgaW5zdGFsbGVkQ2FydGZpbGUpO1xuXG4gIGxvZy5kZWJ1ZyhgRmluaXNoZWQgZmV0Y2hpbmcgZGVwZW5kZW5jaWVzYCk7XG4gIHJldHVybiB0cnVlO1xufVxuXG5hc3luYyBmdW5jdGlvbiBjaGVja0ZvckRlcGVuZGVuY2llcyAob3B0cyA9IHt9KSB7XG4gIHJldHVybiBhd2FpdCBmZXRjaERlcGVuZGVuY2llcyhvcHRzLnVzZVNzbCk7XG59XG5cbmlmIChyZXF1aXJlLm1haW4gPT09IG1vZHVsZSkge1xuICBhc3luY2lmeShjaGVja0ZvckRlcGVuZGVuY2llcyk7XG59XG5cblxuZXhwb3J0IHtcbiAgY2hlY2tGb3JEZXBlbmRlbmNpZXMsIEJPT1RTVFJBUF9QQVRILCBXREFfQlVORExFX0lELFxuICBXREFfUlVOTkVSX0JVTkRMRV9JRCwgUFJPSkVDVF9GSUxFLFxufTtcbiJdLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiLi4ifQ==
